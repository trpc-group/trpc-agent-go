
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://trpc-group.github.io/trpc-agent-go/knowledge/">
      
      
        <link rel="prev" href="../session/">
      
      
        <link rel="next" href="../planner/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.17">
    
    
      
        <title>Knowledge - tRPC-Agent-Go</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#knowledge-usage-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="tRPC-Agent-Go" class="md-header__button md-logo" aria-label="tRPC-Agent-Go" data-md-component="logo">
      
  <img src="../assets/img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            tRPC-Agent-Go
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Knowledge
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../zh/knowledge/" hreflang="zh" class="md-select__link">
              中文
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/trpc-group/trpc-agent-go" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    trpc-group/trpc-agent-go
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Overview

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../agent/" class="md-tabs__link">
          
  
  
  Components

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../agui/" class="md-tabs__link">
          
  
  
  Server

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../observability/" class="md-tabs__link">
        
  
  
    
  
  Observability

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../ecosystem/" class="md-tabs__link">
        
  
  
    
  
  Ecosystem

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="tRPC-Agent-Go" class="md-nav__button md-logo" aria-label="tRPC-Agent-Go" data-md-component="logo">
      
  <img src="../assets/img/logo.png" alt="logo">

    </a>
    tRPC-Agent-Go
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/trpc-group/trpc-agent-go" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    trpc-group/trpc-agent-go
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Components
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Components
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Agent
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Agent
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multiagent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multi Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../team/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Team
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Graph Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../custom-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Custom Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dify/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dify Agent
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Runner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../callbacks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Callbacks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plugins
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../memory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Memory
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../artifact/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Artifact
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../skill/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Skill
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tool/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tool
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../session/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Session
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Knowledge
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Knowledge
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#usage-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agent-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Agent Integration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-start" class="md-nav__link">
    <span class="md-ellipsis">
      Quick Start
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quick Start">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Environment Requirements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Environment Variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#minimal-example" class="md-nav__link">
    <span class="md-ellipsis">
      Minimal Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Core Concepts
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-guide" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Guide
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage Guide">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integration-with-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with Agent
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integration with Agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#method-1-manual-tool-construction-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      Method 1: Manual Tool Construction (Recommended)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-2-automatic-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Method 2: Automatic Integration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vector-store" class="md-nav__link">
    <span class="md-ellipsis">
      Vector Store
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vector Store">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vector-store-configuration-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Vector Store Configuration Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vector Store Configuration Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memory-in-memory-vector-store" class="md-nav__link">
    <span class="md-ellipsis">
      Memory (In-memory Vector Store)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pgvector-postgresql-pgvector" class="md-nav__link">
    <span class="md-ellipsis">
      PGVector (PostgreSQL + pgvector)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcvector-tencent-cloud-vector-database" class="md-nav__link">
    <span class="md-ellipsis">
      TcVector (Tencent Cloud Vector Database)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elasticsearch" class="md-nav__link">
    <span class="md-ellipsis">
      Elasticsearch
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Elasticsearch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qdrant" class="md-nav__link">
    <span class="md-ellipsis">
      Qdrant
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#embedder" class="md-nav__link">
    <span class="md-ellipsis">
      Embedder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reranker" class="md-nav__link">
    <span class="md-ellipsis">
      Reranker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reranker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#topk-simple-truncation" class="md-nav__link">
    <span class="md-ellipsis">
      TopK (Simple Truncation)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cohere-saas-rerank" class="md-nav__link">
    <span class="md-ellipsis">
      Cohere (SaaS Rerank)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infinity-tei" class="md-nav__link">
    <span class="md-ellipsis">
      Infinity / TEI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-reranker-to-knowledge" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Reranker to Knowledge
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#document-source-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Document Source Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#batch-document-processing-and-concurrency" class="md-nav__link">
    <span class="md-ellipsis">
      Batch Document Processing and Concurrency
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filter-functionality" class="md-nav__link">
    <span class="md-ellipsis">
      Filter Functionality
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Filter Functionality">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-filters" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Filters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic Filters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agent-level-filters" class="md-nav__link">
    <span class="md-ellipsis">
      Agent-level Filters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#runner-level-filters" class="md-nav__link">
    <span class="md-ellipsis">
      Runner-level Filters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intelligent-filters-agentic-filter" class="md-nav__link">
    <span class="md-ellipsis">
      Intelligent Filters (Agentic Filter)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Intelligent Filters (Agentic Filter)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-intelligent-filters" class="md-nav__link">
    <span class="md-ellipsis">
      Enable Intelligent Filters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filter-layers" class="md-nav__link">
    <span class="md-ellipsis">
      Filter Layers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Filter Layers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-filter-combination" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Filter Combination
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complex-condition-filter-example" class="md-nav__link">
    <span class="md-ellipsis">
      Complex Condition Filter Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-filter-helper-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Common Filter Helper Functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metadata-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Metadata Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Metadata Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metadata-acquisition" class="md-nav__link">
    <span class="md-ellipsis">
      Metadata Acquisition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#source-metadata-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Source Metadata Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vector-database-filter-support" class="md-nav__link">
    <span class="md-ellipsis">
      Vector Database Filter Support
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vector Database Filter Support">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#postgresql-pgvector" class="md-nav__link">
    <span class="md-ellipsis">
      PostgreSQL + pgvector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcvector" class="md-nav__link">
    <span class="md-ellipsis">
      TcVector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qdrant_1" class="md-nav__link">
    <span class="md-ellipsis">
      Qdrant
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in-memory-storage" class="md-nav__link">
    <span class="md-ellipsis">
      In-memory Storage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#knowledge-base-management-functionality" class="md-nav__link">
    <span class="md-ellipsis">
      Knowledge Base Management Functionality
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Knowledge Base Management Functionality">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-source-sync-enablesourcesync" class="md-nav__link">
    <span class="md-ellipsis">
      Enable Source Sync (enableSourceSync)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-source-management" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Source Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#knowledge-base-status-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Knowledge Base Status Monitoring
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-features" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Features
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#queryenhancer" class="md-nav__link">
    <span class="md-ellipsis">
      QueryEnhancer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Optimization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-example" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#command-line-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Command Line Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-issues-and-handling-suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      Common Issues and Handling Suggestions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../planner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Planner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../event/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Event
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../evaluation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Evaluation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Server
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Server
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AG-UI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../a2a/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    A2A
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../observability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Observability
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ecosystem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ecosystem
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#usage-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agent-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Agent Integration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-start" class="md-nav__link">
    <span class="md-ellipsis">
      Quick Start
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quick Start">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Environment Requirements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Environment Variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#minimal-example" class="md-nav__link">
    <span class="md-ellipsis">
      Minimal Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Core Concepts
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-guide" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Guide
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage Guide">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integration-with-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with Agent
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integration with Agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#method-1-manual-tool-construction-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      Method 1: Manual Tool Construction (Recommended)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-2-automatic-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Method 2: Automatic Integration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vector-store" class="md-nav__link">
    <span class="md-ellipsis">
      Vector Store
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vector Store">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vector-store-configuration-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Vector Store Configuration Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vector Store Configuration Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memory-in-memory-vector-store" class="md-nav__link">
    <span class="md-ellipsis">
      Memory (In-memory Vector Store)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pgvector-postgresql-pgvector" class="md-nav__link">
    <span class="md-ellipsis">
      PGVector (PostgreSQL + pgvector)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcvector-tencent-cloud-vector-database" class="md-nav__link">
    <span class="md-ellipsis">
      TcVector (Tencent Cloud Vector Database)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elasticsearch" class="md-nav__link">
    <span class="md-ellipsis">
      Elasticsearch
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Elasticsearch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qdrant" class="md-nav__link">
    <span class="md-ellipsis">
      Qdrant
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#embedder" class="md-nav__link">
    <span class="md-ellipsis">
      Embedder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reranker" class="md-nav__link">
    <span class="md-ellipsis">
      Reranker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reranker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#topk-simple-truncation" class="md-nav__link">
    <span class="md-ellipsis">
      TopK (Simple Truncation)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cohere-saas-rerank" class="md-nav__link">
    <span class="md-ellipsis">
      Cohere (SaaS Rerank)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infinity-tei" class="md-nav__link">
    <span class="md-ellipsis">
      Infinity / TEI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-reranker-to-knowledge" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Reranker to Knowledge
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#document-source-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Document Source Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#batch-document-processing-and-concurrency" class="md-nav__link">
    <span class="md-ellipsis">
      Batch Document Processing and Concurrency
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filter-functionality" class="md-nav__link">
    <span class="md-ellipsis">
      Filter Functionality
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Filter Functionality">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-filters" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Filters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic Filters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agent-level-filters" class="md-nav__link">
    <span class="md-ellipsis">
      Agent-level Filters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#runner-level-filters" class="md-nav__link">
    <span class="md-ellipsis">
      Runner-level Filters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intelligent-filters-agentic-filter" class="md-nav__link">
    <span class="md-ellipsis">
      Intelligent Filters (Agentic Filter)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Intelligent Filters (Agentic Filter)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-intelligent-filters" class="md-nav__link">
    <span class="md-ellipsis">
      Enable Intelligent Filters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filter-layers" class="md-nav__link">
    <span class="md-ellipsis">
      Filter Layers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Filter Layers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-filter-combination" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Filter Combination
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complex-condition-filter-example" class="md-nav__link">
    <span class="md-ellipsis">
      Complex Condition Filter Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-filter-helper-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Common Filter Helper Functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metadata-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Metadata Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Metadata Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metadata-acquisition" class="md-nav__link">
    <span class="md-ellipsis">
      Metadata Acquisition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#source-metadata-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Source Metadata Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vector-database-filter-support" class="md-nav__link">
    <span class="md-ellipsis">
      Vector Database Filter Support
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vector Database Filter Support">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#postgresql-pgvector" class="md-nav__link">
    <span class="md-ellipsis">
      PostgreSQL + pgvector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcvector" class="md-nav__link">
    <span class="md-ellipsis">
      TcVector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qdrant_1" class="md-nav__link">
    <span class="md-ellipsis">
      Qdrant
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in-memory-storage" class="md-nav__link">
    <span class="md-ellipsis">
      In-memory Storage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#knowledge-base-management-functionality" class="md-nav__link">
    <span class="md-ellipsis">
      Knowledge Base Management Functionality
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Knowledge Base Management Functionality">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-source-sync-enablesourcesync" class="md-nav__link">
    <span class="md-ellipsis">
      Enable Source Sync (enableSourceSync)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-source-management" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Source Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#knowledge-base-status-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Knowledge Base Status Monitoring
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-features" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Features
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#queryenhancer" class="md-nav__link">
    <span class="md-ellipsis">
      QueryEnhancer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Optimization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-example" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#command-line-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Command Line Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-issues-and-handling-suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      Common Issues and Handling Suggestions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/trpc-group/trpc-agent-go/edit/main/docs/mkdocs/en/knowledge.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/trpc-group/trpc-agent-go/raw/main/docs/mkdocs/en/knowledge.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="knowledge-usage-documentation">Knowledge Usage Documentation</h1>
<h2 id="overview">Overview</h2>
<p>Knowledge is the knowledge management system in the tRPC-Agent-Go framework, providing Retrieval-Augmented Generation (RAG) capabilities for Agents. By integrating vector data, embedding models, and document processing components, the Knowledge system enables Agents to access and retrieve relevant knowledge information, thereby providing more accurate and well-founded responses.</p>
<h3 id="usage-pattern">Usage Pattern</h3>
<p>The usage of the Knowledge system follows this pattern:</p>
<ol>
<li><strong>Create Knowledge</strong>: Configure vector storage, Embedder, and knowledge sources</li>
<li><strong>Load Documents</strong>: Load and index documents from various sources</li>
<li><strong>Integrate with Agent</strong>: Use <code>WithKnowledge()</code> to integrate Knowledge into LLM Agent</li>
<li><strong>Agent Auto Retrieval</strong>: Agent automatically performs knowledge retrieval through built-in <code>knowledge_search</code> tool</li>
<li><strong>Knowledge Base Management</strong>: Enable intelligent synchronization mechanism through <code>enableSourceSync</code> to ensure data in vector storage always stays consistent with user-configured sources</li>
</ol>
<p>This pattern provides:</p>
<ul>
<li><strong>Intelligent Retrieval</strong>: Semantic search based on vector similarity</li>
<li><strong>Multi-source Support</strong>: Support for files, directories, URLs, and other knowledge sources</li>
<li><strong>Flexible Storage</strong>: Support for memory, PostgreSQL, TcVector, and other storage backends</li>
<li><strong>High Performance Processing</strong>: Concurrent processing and batch document loading</li>
<li><strong>Knowledge Filtering</strong>: Support static filtering and Agent intelligent filtering through metadata</li>
<li><strong>Extensible Architecture</strong>: Support for custom Embedders, Retrievers, and Rerankers</li>
<li><strong>Dynamic Management</strong>: Support runtime addition, removal, and updating of knowledge sources</li>
<li><strong>Data Consistency Guarantee</strong>: Enable intelligent synchronization mechanism through <code>enableSourceSync</code> to ensure vector storage data always stays consistent with user-configured sources, supporting incremental processing, change detection, and automatic orphan document cleanup</li>
</ul>
<h3 id="agent-integration">Agent Integration</h3>
<p>How the Knowledge system integrates with Agents:</p>
<ul>
<li><strong>Automatic Tool Registration</strong>: Use <code>WithKnowledge()</code> option to automatically add <code>knowledge_search</code> tool</li>
<li><strong>Intelligent Filter Tool</strong>: Use <code>WithEnableKnowledgeAgenticFilter(true)</code> to enable <code>knowledge_search_with_agentic_filter</code> tool</li>
<li><strong>Tool Invocation</strong>: Agents can call knowledge search tools to obtain relevant information</li>
<li><strong>Context Enhancement</strong>: Retrieved knowledge content is automatically added to Agent's context</li>
<li><strong>Metadata Filtering</strong>: Support precise search based on document metadata</li>
</ul>
<h2 id="quick-start">Quick Start</h2>
<blockquote>
<p><strong>Full Example</strong>: <a href="https://github.com/trpc-group/trpc-agent-go/tree/main/examples/knowledge/basic">examples/knowledge/basic</a></p>
</blockquote>
<h3 id="environment-requirements">Environment Requirements</h3>
<ul>
<li>Go 1.24.1 or later</li>
<li>Valid LLM API key (OpenAI compatible interface)</li>
<li>Vector database (optional, for production environment)</li>
</ul>
<h3 id="configure-environment-variables">Configure Environment Variables</h3>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1"># OpenAI API configuration.</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OPENAI_API_KEY</span><span class="o">=</span><span class="s2">&quot;your-openai-api-key&quot;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OPENAI_BASE_URL</span><span class="o">=</span><span class="s2">&quot;your-openai-base-url&quot;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="c1"># Embedding model configuration (optional, needs manual reading).</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OPENAI_EMBEDDING_MODEL</span><span class="o">=</span><span class="s2">&quot;text-embedding-3-small&quot;</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="minimal-example">Minimal Example</h3>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span>
<span class="normal"><a href="#__codelineno-1-33">33</a></span>
<span class="normal"><a href="#__codelineno-1-34">34</a></span>
<span class="normal"><a href="#__codelineno-1-35">35</a></span>
<span class="normal"><a href="#__codelineno-1-36">36</a></span>
<span class="normal"><a href="#__codelineno-1-37">37</a></span>
<span class="normal"><a href="#__codelineno-1-38">38</a></span>
<span class="normal"><a href="#__codelineno-1-39">39</a></span>
<span class="normal"><a href="#__codelineno-1-40">40</a></span>
<span class="normal"><a href="#__codelineno-1-41">41</a></span>
<span class="normal"><a href="#__codelineno-1-42">42</a></span>
<span class="normal"><a href="#__codelineno-1-43">43</a></span>
<span class="normal"><a href="#__codelineno-1-44">44</a></span>
<span class="normal"><a href="#__codelineno-1-45">45</a></span>
<span class="normal"><a href="#__codelineno-1-46">46</a></span>
<span class="normal"><a href="#__codelineno-1-47">47</a></span>
<span class="normal"><a href="#__codelineno-1-48">48</a></span>
<span class="normal"><a href="#__codelineno-1-49">49</a></span>
<span class="normal"><a href="#__codelineno-1-50">50</a></span>
<span class="normal"><a href="#__codelineno-1-51">51</a></span>
<span class="normal"><a href="#__codelineno-1-52">52</a></span>
<span class="normal"><a href="#__codelineno-1-53">53</a></span>
<span class="normal"><a href="#__codelineno-1-54">54</a></span>
<span class="normal"><a href="#__codelineno-1-55">55</a></span>
<span class="normal"><a href="#__codelineno-1-56">56</a></span>
<span class="normal"><a href="#__codelineno-1-57">57</a></span>
<span class="normal"><a href="#__codelineno-1-58">58</a></span>
<span class="normal"><a href="#__codelineno-1-59">59</a></span>
<span class="normal"><a href="#__codelineno-1-60">60</a></span>
<span class="normal"><a href="#__codelineno-1-61">61</a></span>
<span class="normal"><a href="#__codelineno-1-62">62</a></span>
<span class="normal"><a href="#__codelineno-1-63">63</a></span>
<span class="normal"><a href="#__codelineno-1-64">64</a></span>
<span class="normal"><a href="#__codelineno-1-65">65</a></span>
<span class="normal"><a href="#__codelineno-1-66">66</a></span>
<span class="normal"><a href="#__codelineno-1-67">67</a></span>
<span class="normal"><a href="#__codelineno-1-68">68</a></span>
<span class="normal"><a href="#__codelineno-1-69">69</a></span>
<span class="normal"><a href="#__codelineno-1-70">70</a></span>
<span class="normal"><a href="#__codelineno-1-71">71</a></span>
<span class="normal"><a href="#__codelineno-1-72">72</a></span>
<span class="normal"><a href="#__codelineno-1-73">73</a></span>
<span class="normal"><a href="#__codelineno-1-74">74</a></span>
<span class="normal"><a href="#__codelineno-1-75">75</a></span>
<span class="normal"><a href="#__codelineno-1-76">76</a></span>
<span class="normal"><a href="#__codelineno-1-77">77</a></span>
<span class="normal"><a href="#__codelineno-1-78">78</a></span>
<span class="normal"><a href="#__codelineno-1-79">79</a></span>
<span class="normal"><a href="#__codelineno-1-80">80</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">    </span><span class="s">&quot;context&quot;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/agent/llmagent&quot;</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge&quot;</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">    </span><span class="nx">openaiembedder</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/embedder/openai&quot;</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/source&quot;</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">    </span><span class="nx">dirsource</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/source/dir&quot;</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">    </span><span class="nx">filesource</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/source/file&quot;</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">    </span><span class="nx">knowledgetool</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/tool&quot;</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">    </span><span class="nx">vectorinmemory</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/vectorstore/inmemory&quot;</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/model&quot;</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/model/openai&quot;</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/runner&quot;</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/session/inmemory&quot;</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/tool&quot;</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20"></a>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21"></a>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="w">    </span><span class="c1">// Import PDF reader to register it (optional - has separate go.mod to avoid unnecessary dependencies).</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="w">    </span><span class="c1">// _ &quot;trpc.group/trpc-go/trpc-agent-go/knowledge/document/reader/pdf&quot;</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="p">)</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25"></a>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28"></a>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29"></a><span class="w">    </span><span class="c1">// 1. Create embedder.</span>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="w">    </span><span class="nx">embedder</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">openaiembedder</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31"></a><span class="w">        </span><span class="nx">openaiembedder</span><span class="p">.</span><span class="nx">WithModel</span><span class="p">(</span><span class="s">&quot;text-embedding-3-small&quot;</span><span class="p">),</span>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33"></a>
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34"></a><span class="w">    </span><span class="c1">// 2. Create vector store.</span>
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35"></a><span class="w">    </span><span class="nx">vectorStore</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vectorinmemory</span><span class="p">.</span><span class="nx">New</span><span class="p">()</span>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36"></a>
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37"></a><span class="w">    </span><span class="c1">// 3. Create knowledge sources.</span>
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="w">    </span><span class="nx">sources</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">source</span><span class="p">.</span><span class="nx">Source</span><span class="p">{</span>
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39"></a><span class="w">        </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">New</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;./data/llm.md&quot;</span><span class="p">}),</span>
</span><span id="__span-1-40"><a id="__codelineno-1-40" name="__codelineno-1-40"></a><span class="w">        </span><span class="nx">dirsource</span><span class="p">.</span><span class="nx">New</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;./dir&quot;</span><span class="p">}),</span>
</span><span id="__span-1-41"><a id="__codelineno-1-41" name="__codelineno-1-41"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-42"><a id="__codelineno-1-42" name="__codelineno-1-42"></a>
</span><span id="__span-1-43"><a id="__codelineno-1-43" name="__codelineno-1-43"></a><span class="w">    </span><span class="c1">// 4. Create Knowledge.</span>
</span><span id="__span-1-44"><a id="__codelineno-1-44" name="__codelineno-1-44"></a><span class="w">    </span><span class="nx">kb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-1-45"><a id="__codelineno-1-45" name="__codelineno-1-45"></a><span class="w">        </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithEmbedder</span><span class="p">(</span><span class="nx">embedder</span><span class="p">),</span>
</span><span id="__span-1-46"><a id="__codelineno-1-46" name="__codelineno-1-46"></a><span class="w">        </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithVectorStore</span><span class="p">(</span><span class="nx">vectorStore</span><span class="p">),</span>
</span><span id="__span-1-47"><a id="__codelineno-1-47" name="__codelineno-1-47"></a><span class="w">        </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithSources</span><span class="p">(</span><span class="nx">sources</span><span class="p">),</span>
</span><span id="__span-1-48"><a id="__codelineno-1-48" name="__codelineno-1-48"></a><span class="w">        </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithEnableSourceSync</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
</span><span id="__span-1-49"><a id="__codelineno-1-49" name="__codelineno-1-49"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-1-50"><a id="__codelineno-1-50" name="__codelineno-1-50"></a>
</span><span id="__span-1-51"><a id="__codelineno-1-51" name="__codelineno-1-51"></a><span class="w">    </span><span class="c1">// 5. Load documents.</span>
</span><span id="__span-1-52"><a id="__codelineno-1-52" name="__codelineno-1-52"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">kb</span><span class="p">.</span><span class="nx">Load</span><span class="p">(</span><span class="nx">ctx</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-53"><a id="__codelineno-1-53" name="__codelineno-1-53"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;Failed to load knowledge base: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-1-54"><a id="__codelineno-1-54" name="__codelineno-1-54"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-55"><a id="__codelineno-1-55" name="__codelineno-1-55"></a>
</span><span id="__span-1-56"><a id="__codelineno-1-56" name="__codelineno-1-56"></a><span class="w">    </span><span class="c1">// 6. Create search tool.</span>
</span><span id="__span-1-57"><a id="__codelineno-1-57" name="__codelineno-1-57"></a><span class="w">    </span><span class="nx">searchTool</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">knowledgetool</span><span class="p">.</span><span class="nx">NewKnowledgeSearchTool</span><span class="p">(</span>
</span><span id="__span-1-58"><a id="__codelineno-1-58" name="__codelineno-1-58"></a><span class="w">        </span><span class="nx">kb</span><span class="p">,</span>
</span><span id="__span-1-59"><a id="__codelineno-1-59" name="__codelineno-1-59"></a><span class="w">        </span><span class="nx">knowledgetool</span><span class="p">.</span><span class="nx">WithToolName</span><span class="p">(</span><span class="s">&quot;knowledge_search&quot;</span><span class="p">),</span>
</span><span id="__span-1-60"><a id="__codelineno-1-60" name="__codelineno-1-60"></a><span class="w">        </span><span class="nx">knowledgetool</span><span class="p">.</span><span class="nx">WithToolDescription</span><span class="p">(</span><span class="s">&quot;Search for relevant information in the knowledge base.&quot;</span><span class="p">),</span>
</span><span id="__span-1-61"><a id="__codelineno-1-61" name="__codelineno-1-61"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-1-62"><a id="__codelineno-1-62" name="__codelineno-1-62"></a>
</span><span id="__span-1-63"><a id="__codelineno-1-63" name="__codelineno-1-63"></a><span class="w">    </span><span class="c1">// 7. Create Agent and add tool.</span>
</span><span id="__span-1-64"><a id="__codelineno-1-64" name="__codelineno-1-64"></a><span class="w">    </span><span class="nx">modelInstance</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">openai</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;claude-4-sonnet-20250514&quot;</span><span class="p">)</span>
</span><span id="__span-1-65"><a id="__codelineno-1-65" name="__codelineno-1-65"></a><span class="w">    </span><span class="nx">llmAgent</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-1-66"><a id="__codelineno-1-66" name="__codelineno-1-66"></a><span class="w">        </span><span class="s">&quot;knowledge-assistant&quot;</span><span class="p">,</span>
</span><span id="__span-1-67"><a id="__codelineno-1-67" name="__codelineno-1-67"></a><span class="w">        </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithModel</span><span class="p">(</span><span class="nx">modelInstance</span><span class="p">),</span>
</span><span id="__span-1-68"><a id="__codelineno-1-68" name="__codelineno-1-68"></a><span class="w">        </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithTools</span><span class="p">([]</span><span class="nx">tool</span><span class="p">.</span><span class="nx">Tool</span><span class="p">{</span><span class="nx">searchTool</span><span class="p">}),</span>
</span><span id="__span-1-69"><a id="__codelineno-1-69" name="__codelineno-1-69"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-1-70"><a id="__codelineno-1-70" name="__codelineno-1-70"></a>
</span><span id="__span-1-71"><a id="__codelineno-1-71" name="__codelineno-1-71"></a><span class="w">    </span><span class="c1">// 8. Create Runner and execute.</span>
</span><span id="__span-1-72"><a id="__codelineno-1-72" name="__codelineno-1-72"></a><span class="w">    </span><span class="nx">sessionService</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">inmemory</span><span class="p">.</span><span class="nx">NewSessionService</span><span class="p">()</span>
</span><span id="__span-1-73"><a id="__codelineno-1-73" name="__codelineno-1-73"></a><span class="w">    </span><span class="nx">appRunner</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">runner</span><span class="p">.</span><span class="nx">NewRunner</span><span class="p">(</span><span class="s">&quot;knowledge-chat&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">llmAgent</span><span class="p">,</span><span class="w"> </span><span class="nx">runner</span><span class="p">.</span><span class="nx">WithSessionService</span><span class="p">(</span><span class="nx">sessionService</span><span class="p">))</span>
</span><span id="__span-1-74"><a id="__codelineno-1-74" name="__codelineno-1-74"></a>
</span><span id="__span-1-75"><a id="__codelineno-1-75" name="__codelineno-1-75"></a><span class="w">    </span><span class="nx">message</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">model</span><span class="p">.</span><span class="nx">NewUserMessage</span><span class="p">(</span><span class="s">&quot;Please tell me about LLM information&quot;</span><span class="p">)</span>
</span><span id="__span-1-76"><a id="__codelineno-1-76" name="__codelineno-1-76"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">appRunner</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user123&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;session456&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span>
</span><span id="__span-1-77"><a id="__codelineno-1-77" name="__codelineno-1-77"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-78"><a id="__codelineno-1-78" name="__codelineno-1-78"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;Failed to run agent: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-1-79"><a id="__codelineno-1-79" name="__codelineno-1-79"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-80"><a id="__codelineno-1-80" name="__codelineno-1-80"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<h2 id="core-concepts">Core Concepts</h2>
<p>The <a href="https://github.com/trpc-group/trpc-agent-go/tree/main/knowledge">knowledge module</a> is the knowledge management core of the tRPC-Agent-Go framework, providing complete RAG capabilities. The module adopts a modular design, supporting multiple document sources, vector storage backends, and embedding models.</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span>
<span class="normal"><a href="#__codelineno-2-21">21</a></span>
<span class="normal"><a href="#__codelineno-2-22">22</a></span>
<span class="normal"><a href="#__codelineno-2-23">23</a></span>
<span class="normal"><a href="#__codelineno-2-24">24</a></span>
<span class="normal"><a href="#__codelineno-2-25">25</a></span>
<span class="normal"><a href="#__codelineno-2-26">26</a></span>
<span class="normal"><a href="#__codelineno-2-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a>knowledge/
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a>├── knowledge.go          # Core interface definitions and main implementation.
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a>├── source/               # Document source management.
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a>│   ├── source.go        # Source interface definition.
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a>│   ├── file.go          # File source implementation.
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6"></a>│   ├── dir.go           # Directory source implementation.
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7"></a>│   ├── url.go           # URL source implementation.
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8"></a>│   └── auto.go          # Automatic source type detection.
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9"></a>├── vectorstore/          # Vector storage backend.
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10"></a>│   ├── vectorstore.go   # VectorStore interface definition.
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11"></a>│   ├── inmemory/        # In-memory vector storage (for development/testing).
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12"></a>│   ├── pgvector/        # PostgreSQL + pgvector implementation.
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13"></a>│   └── tcvector/        # Tencent Cloud vector database implementation.
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14"></a>├── embedder/             # Text embedding models.
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15"></a>│   ├── embedder.go      # Embedder interface definition.
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16"></a>│   ├── openai/          # OpenAI embedding model.
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17"></a>│   └── local/           # Local embedding model.
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18"></a>├── reranker/             # reranker layer.
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19"></a>│   ├── reranker.go      # Reranker interface definition.
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20"></a>│   ├── topk.go          # return topk result.
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21"></a>├── document/             # Document representation.
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22"></a>│   └── document.go      # Document structure definition.
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23"></a>├── query/                # Query enhancer.
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24"></a>│   ├── query.go         # QueryEnhancer interface definition.
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25"></a>│   └── passthrough.go   # Default passthrough enhancer.
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26"></a>└── loader/               # Document loader.
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27"></a>    └── loader.go        # Document loading logic.
</span></code></pre></div></td></tr></table></div>
<h2 id="usage-guide">Usage Guide</h2>
<h3 id="integration-with-agent">Integration with Agent</h3>
<p>The Knowledge system provides two ways to integrate with Agent: manual tool construction and automatic integration.</p>
<h4 id="method-1-manual-tool-construction-recommended">Method 1: Manual Tool Construction (Recommended)</h4>
<p>Use <code>NewKnowledgeSearchTool</code> to manually create search tools, allowing flexible configuration of tool name, description, and support for building multiple knowledge bases.</p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">    </span><span class="nx">knowledgetool</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/tool&quot;</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/tool&quot;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="p">)</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5"></a>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="c1">// Create search tool.</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="nx">searchTool</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">knowledgetool</span><span class="p">.</span><span class="nx">NewKnowledgeSearchTool</span><span class="p">(</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">    </span><span class="nx">kb</span><span class="p">,</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">    </span><span class="nx">knowledgetool</span><span class="p">.</span><span class="nx">WithToolName</span><span class="p">(</span><span class="s">&quot;knowledge_search&quot;</span><span class="p">),</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="w">    </span><span class="nx">knowledgetool</span><span class="p">.</span><span class="nx">WithToolDescription</span><span class="p">(</span><span class="s">&quot;Search for relevant information in the knowledge base.&quot;</span><span class="p">),</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="p">)</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12"></a>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="c1">// Create Agent and add tool.</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="nx">llmAgent</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="w">    </span><span class="s">&quot;knowledge-assistant&quot;</span><span class="p">,</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithModel</span><span class="p">(</span><span class="nx">modelInstance</span><span class="p">),</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithTools</span><span class="p">([]</span><span class="nx">tool</span><span class="p">.</span><span class="nx">Tool</span><span class="p">{</span><span class="nx">searchTool</span><span class="p">}),</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="method-2-automatic-integration">Method 2: Automatic Integration</h4>
<p>Use <code>llmagent.WithKnowledge(kb)</code> to integrate Knowledge into Agent. The framework automatically registers the <code>knowledge_search</code> tool.</p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span>
<span class="normal"><a href="#__codelineno-4-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="nx">llmAgent</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">    </span><span class="s">&quot;knowledge-assistant&quot;</span><span class="p">,</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithModel</span><span class="p">(</span><span class="nx">modelInstance</span><span class="p">),</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithKnowledge</span><span class="p">(</span><span class="nx">kb</span><span class="p">),</span><span class="w"> </span><span class="c1">// Automatically add knowledge_search tool.</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p><strong>Using NewAgenticFilterSearchTool to create intelligent filter search tool:</strong></p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span>
<span class="normal"><a href="#__codelineno-5-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/source&quot;</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">    </span><span class="nx">knowledgetool</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/tool&quot;</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="p">)</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5"></a>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="c1">// Get metadata information from sources (for intelligent filtering).</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="nx">sourcesMetadata</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">source</span><span class="p">.</span><span class="nx">GetAllMetadata</span><span class="p">(</span><span class="nx">sources</span><span class="p">)</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8"></a>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="c1">// Create intelligent filter search tool.</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="nx">filterSearchTool</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">knowledgetool</span><span class="p">.</span><span class="nx">NewAgenticFilterSearchTool</span><span class="p">(</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="w">    </span><span class="nx">kb</span><span class="p">,</span><span class="w">                    </span><span class="c1">// Knowledge instance</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="w">    </span><span class="nx">sourcesMetadata</span><span class="p">,</span><span class="w">       </span><span class="c1">// Metadata information</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="w">    </span><span class="nx">knowledgetool</span><span class="p">.</span><span class="nx">WithToolName</span><span class="p">(</span><span class="s">&quot;knowledge_search_with_filter&quot;</span><span class="p">),</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="w">    </span><span class="nx">knowledgetool</span><span class="p">.</span><span class="nx">WithToolDescription</span><span class="p">(</span><span class="s">&quot;Search the knowledge base with intelligent metadata filtering.&quot;</span><span class="p">),</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="p">)</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16"></a>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="nx">llmAgent</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="w">    </span><span class="s">&quot;knowledge-assistant&quot;</span><span class="p">,</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithModel</span><span class="p">(</span><span class="nx">modelInstance</span><span class="p">),</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithTools</span><span class="p">([]</span><span class="nx">tool</span><span class="p">.</span><span class="nx">Tool</span><span class="p">{</span><span class="nx">filterSearchTool</span><span class="p">}),</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="vector-store">Vector Store</h3>
<blockquote>
<p><strong>Example Code</strong>: <a href="https://github.com/trpc-group/trpc-agent-go/tree/main/examples/knowledge/vectorstores">examples/knowledge/vectorstores</a></p>
</blockquote>
<p>Vector storage can be configured through options in code. Configuration sources can be configuration files, command line parameters, or environment variables, which users can implement themselves.</p>
<p>trpc-agent-go supports multiple vector store implementations:</p>
<ul>
<li><strong>Memory</strong>: In-memory vector store, suitable for testing and small-scale data</li>
<li><strong>PGVector</strong>: PostgreSQL + pgvector extension based vector store, supports hybrid search - <a href="https://github.com/trpc-group/trpc-agent-go/tree/main/examples/knowledge/vectorstores/postgres">Example</a></li>
<li><strong>TcVector</strong>: Tencent Cloud Vector Database, supports remote embedding computation and hybrid search - <a href="https://github.com/trpc-group/trpc-agent-go/tree/main/examples/knowledge/vectorstores/tcvector">Example</a></li>
<li><strong>Elasticsearch</strong>: Supports v7/v8/v9 multi-version Elasticsearch vector store - <a href="https://github.com/trpc-group/trpc-agent-go/tree/main/examples/knowledge/vectorstores/elasticsearch">Example</a></li>
<li><strong>Milvus</strong>: High-performance vector database, supports billion-scale vector search - <a href="https://github.com/trpc-group/trpc-agent-go/tree/main/examples/knowledge/vectorstores/milvus">Example</a></li>
<li><strong>Qdrant</strong>: High-performance vector database with advanced filtering, supports cloud and self-hosted deployments - <a href="https://github.com/trpc-group/trpc-agent-go/tree/main/examples/knowledge/vectorstores/qdrant">Example</a></li>
</ul>
<h4 id="vector-store-configuration-examples">Vector Store Configuration Examples</h4>
<h5 id="memory-in-memory-vector-store">Memory (In-memory Vector Store)</h5>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w">    </span><span class="nx">vectorinmemory</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/vectorstore/inmemory&quot;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="p">)</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="c1">// In-memory implementation, suitable for testing and small-scale data</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="nx">memVS</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vectorinmemory</span><span class="p">.</span><span class="nx">New</span><span class="p">()</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7"></a>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="nx">kb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithVectorStore</span><span class="p">(</span><span class="nx">memVS</span><span class="p">),</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithEmbedder</span><span class="p">(</span><span class="nx">embedder</span><span class="p">),</span><span class="w"> </span><span class="c1">// Requires local embedder</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h5 id="pgvector-postgresql-pgvector">PGVector (PostgreSQL + pgvector)</h5>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">    </span><span class="nx">vectorpgvector</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/vectorstore/pgvector&quot;</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="p">)</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4"></a>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="c1">// PostgreSQL + pgvector</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="nx">pgVS</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vectorpgvector</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">    </span><span class="nx">vectorpgvector</span><span class="p">.</span><span class="nx">WithPGVectorClientDSN</span><span class="p">(</span><span class="s">&quot;postgres://postgres:your-password@127.0.0.1:5432/your-database?sslmode=disable&quot;</span><span class="p">),</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">    </span><span class="c1">// Set index dimension based on embedding model (text-embedding-3-small is 1536)</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">    </span><span class="nx">vectorpgvector</span><span class="p">.</span><span class="nx">WithIndexDimension</span><span class="p">(</span><span class="mi">1536</span><span class="p">),</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">    </span><span class="c1">// Enable/disable text retrieval vector, used with hybrid search weights</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="w">    </span><span class="nx">vectorpgvector</span><span class="p">.</span><span class="nx">WithEnableTSVector</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="w">    </span><span class="c1">// Adjust hybrid search weights (vector similarity weight vs text relevance weight)</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="w">    </span><span class="nx">vectorpgvector</span><span class="p">.</span><span class="nx">WithHybridSearchWeights</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3</span><span class="p">),</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="w">    </span><span class="c1">// If Chinese word segmentation extension is installed (like zhparser/jieba), set language to improve text recall</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="w">    </span><span class="nx">vectorpgvector</span><span class="p">.</span><span class="nx">WithLanguageExtension</span><span class="p">(</span><span class="s">&quot;english&quot;</span><span class="p">),</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="p">)</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="w">    </span><span class="c1">// Handle error</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="p">}</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20"></a>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21"></a><span class="nx">kb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithVectorStore</span><span class="p">(</span><span class="nx">pgVS</span><span class="p">),</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithEmbedder</span><span class="p">(</span><span class="nx">embedder</span><span class="p">),</span><span class="w"> </span><span class="c1">// Requires local embedder</span>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h5 id="tcvector-tencent-cloud-vector-database">TcVector (Tencent Cloud Vector Database)</h5>
<p>TcVector supports two embedding modes:</p>
<p><strong>1. Local Embedding Mode (Default)</strong></p>
<p>Use local embedder to compute vectors, then store to TcVector:</p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span>
<span class="normal"><a href="#__codelineno-8-18">18</a></span>
<span class="normal"><a href="#__codelineno-8-19">19</a></span>
<span class="normal"><a href="#__codelineno-8-20">20</a></span>
<span class="normal"><a href="#__codelineno-8-21">21</a></span>
<span class="normal"><a href="#__codelineno-8-22">22</a></span>
<span class="normal"><a href="#__codelineno-8-23">23</a></span>
<span class="normal"><a href="#__codelineno-8-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="w">    </span><span class="nx">vectortcvector</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/vectorstore/tcvector&quot;</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="p">)</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4"></a>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="nx">docBuilder</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">tcDoc</span><span class="w"> </span><span class="nx">tcvectordb</span><span class="p">.</span><span class="nx">Document</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">document</span><span class="p">.</span><span class="nx">Document</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="kt">float64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">document</span><span class="p">.</span><span class="nx">Document</span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="nx">tcDoc</span><span class="p">.</span><span class="nx">Id</span><span class="p">},</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="p">}</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8"></a>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="c1">// Local embedding mode</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="nx">tcVS</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="w">    </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">WithURL</span><span class="p">(</span><span class="s">&quot;https://your-tcvector-endpoint&quot;</span><span class="p">),</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="w">    </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">WithUsername</span><span class="p">(</span><span class="s">&quot;your-username&quot;</span><span class="p">),</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="w">    </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">WithPassword</span><span class="p">(</span><span class="s">&quot;your-password&quot;</span><span class="p">),</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14"></a><span class="w">    </span><span class="c1">// Optional custom method to build documents for retrieval. Falls back to the default if not provided</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15"></a><span class="w">    </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">WithDocBuilder</span><span class="p">(</span><span class="nx">docBuilder</span><span class="p">),</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16"></a><span class="p">)</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18"></a><span class="w">    </span><span class="c1">// Handle error</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19"></a><span class="p">}</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20"></a>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21"></a><span class="nx">kb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithVectorStore</span><span class="p">(</span><span class="nx">tcVS</span><span class="p">),</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithEmbedder</span><span class="p">(</span><span class="nx">embedder</span><span class="p">),</span><span class="w"> </span><span class="c1">// Requires local embedder</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p><strong>2. Remote Embedding Mode</strong></p>
<p>Use TcVector cloud-side embedding computation, no local embedder needed, saves resources:</p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span>
<span class="normal"><a href="#__codelineno-9-15">15</a></span>
<span class="normal"><a href="#__codelineno-9-16">16</a></span>
<span class="normal"><a href="#__codelineno-9-17">17</a></span>
<span class="normal"><a href="#__codelineno-9-18">18</a></span>
<span class="normal"><a href="#__codelineno-9-19">19</a></span>
<span class="normal"><a href="#__codelineno-9-20">20</a></span>
<span class="normal"><a href="#__codelineno-9-21">21</a></span>
<span class="normal"><a href="#__codelineno-9-22">22</a></span>
<span class="normal"><a href="#__codelineno-9-23">23</a></span>
<span class="normal"><a href="#__codelineno-9-24">24</a></span>
<span class="normal"><a href="#__codelineno-9-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="w">    </span><span class="nx">vectortcvector</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/vectorstore/tcvector&quot;</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="p">)</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4"></a>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="c1">// Remote embedding mode</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="nx">tcVS</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="w">    </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">WithURL</span><span class="p">(</span><span class="s">&quot;https://your-tcvector-endpoint&quot;</span><span class="p">),</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="w">    </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">WithUsername</span><span class="p">(</span><span class="s">&quot;your-username&quot;</span><span class="p">),</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="w">    </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">WithPassword</span><span class="p">(</span><span class="s">&quot;your-password&quot;</span><span class="p">),</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="w">    </span><span class="c1">// Enable remote embedding computation</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="w">    </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">WithEnableRemoteEmbedding</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="w">    </span><span class="c1">// Specify TcVector embedding model (e.g., bge-base-zh)</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="w">    </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">WithRemoteEmbeddingModel</span><span class="p">(</span><span class="s">&quot;bge-base-zh&quot;</span><span class="p">),</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14"></a><span class="w">    </span><span class="c1">// If hybrid search is needed, enable TSVector</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15"></a><span class="w">    </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">WithEnableTSVector</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16"></a><span class="p">)</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18"></a><span class="w">    </span><span class="c1">// Handle error</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19"></a><span class="p">}</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20"></a>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21"></a><span class="nx">kb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithVectorStore</span><span class="p">(</span><span class="nx">tcVS</span><span class="p">),</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23"></a><span class="w">    </span><span class="c1">// Note: When using remote embedding, no need to configure embedder</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24"></a><span class="w">    </span><span class="c1">// knowledge.WithEmbedder(embedder), // Not needed</span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="elasticsearch">Elasticsearch</h4>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span>
<span class="normal"><a href="#__codelineno-10-16">16</a></span>
<span class="normal"><a href="#__codelineno-10-17">17</a></span>
<span class="normal"><a href="#__codelineno-10-18">18</a></span>
<span class="normal"><a href="#__codelineno-10-19">19</a></span>
<span class="normal"><a href="#__codelineno-10-20">20</a></span>
<span class="normal"><a href="#__codelineno-10-21">21</a></span>
<span class="normal"><a href="#__codelineno-10-22">22</a></span>
<span class="normal"><a href="#__codelineno-10-23">23</a></span>
<span class="normal"><a href="#__codelineno-10-24">24</a></span>
<span class="normal"><a href="#__codelineno-10-25">25</a></span>
<span class="normal"><a href="#__codelineno-10-26">26</a></span>
<span class="normal"><a href="#__codelineno-10-27">27</a></span>
<span class="normal"><a href="#__codelineno-10-28">28</a></span>
<span class="normal"><a href="#__codelineno-10-29">29</a></span>
<span class="normal"><a href="#__codelineno-10-30">30</a></span>
<span class="normal"><a href="#__codelineno-10-31">31</a></span>
<span class="normal"><a href="#__codelineno-10-32">32</a></span>
<span class="normal"><a href="#__codelineno-10-33">33</a></span>
<span class="normal"><a href="#__codelineno-10-34">34</a></span>
<span class="normal"><a href="#__codelineno-10-35">35</a></span>
<span class="normal"><a href="#__codelineno-10-36">36</a></span>
<span class="normal"><a href="#__codelineno-10-37">37</a></span>
<span class="normal"><a href="#__codelineno-10-38">38</a></span>
<span class="normal"><a href="#__codelineno-10-39">39</a></span>
<span class="normal"><a href="#__codelineno-10-40">40</a></span>
<span class="normal"><a href="#__codelineno-10-41">41</a></span>
<span class="normal"><a href="#__codelineno-10-42">42</a></span>
<span class="normal"><a href="#__codelineno-10-43">43</a></span>
<span class="normal"><a href="#__codelineno-10-44">44</a></span>
<span class="normal"><a href="#__codelineno-10-45">45</a></span>
<span class="normal"><a href="#__codelineno-10-46">46</a></span>
<span class="normal"><a href="#__codelineno-10-47">47</a></span>
<span class="normal"><a href="#__codelineno-10-48">48</a></span>
<span class="normal"><a href="#__codelineno-10-49">49</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="nx">docBuilder</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">hitSource</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">RawMessage</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">document</span><span class="p">.</span><span class="nx">Document</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="kt">float64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">source</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">        </span><span class="nx">ID</span><span class="w">        </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;id&quot;`</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">        </span><span class="nx">Title</span><span class="w">     </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;title&quot;`</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">        </span><span class="nx">Content</span><span class="w">   </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;content&quot;`</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">        </span><span class="nx">Page</span><span class="w">      </span><span class="kt">int</span><span class="w">       </span><span class="s">`json:&quot;page&quot;`</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="w">        </span><span class="nx">Author</span><span class="w">    </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;author&quot;`</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="w">        </span><span class="nx">CreatedAt</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w"> </span><span class="s">`json:&quot;created_at&quot;`</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="w">        </span><span class="nx">UpdatedAt</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w"> </span><span class="s">`json:&quot;updated_at&quot;`</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="w">        </span><span class="nx">Embedding</span><span class="w"> </span><span class="p">[]</span><span class="kt">float64</span><span class="w"> </span><span class="s">`json:&quot;embedding&quot;`</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">hitSource</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">source</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="w">    </span><span class="c1">// Create document.</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16"></a><span class="w">    </span><span class="nx">doc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">document</span><span class="p">.</span><span class="nx">Document</span><span class="p">{</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17"></a><span class="w">        </span><span class="nx">ID</span><span class="p">:</span><span class="w">        </span><span class="nx">source</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18"></a><span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w">      </span><span class="nx">source</span><span class="p">.</span><span class="nx">Title</span><span class="p">,</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19"></a><span class="w">        </span><span class="nx">Content</span><span class="p">:</span><span class="w">   </span><span class="nx">source</span><span class="p">.</span><span class="nx">Content</span><span class="p">,</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20"></a><span class="w">        </span><span class="nx">CreatedAt</span><span class="p">:</span><span class="w"> </span><span class="nx">source</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="p">,</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21"></a><span class="w">        </span><span class="nx">UpdatedAt</span><span class="p">:</span><span class="w"> </span><span class="nx">source</span><span class="p">.</span><span class="nx">UpdatedAt</span><span class="p">,</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22"></a><span class="w">        </span><span class="nx">Metadata</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">any</span><span class="p">{</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23"></a><span class="w">            </span><span class="s">&quot;page&quot;</span><span class="p">:</span><span class="w">   </span><span class="nx">source</span><span class="p">.</span><span class="nx">Page</span><span class="p">,</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24"></a><span class="w">            </span><span class="s">&quot;author&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">source</span><span class="p">.</span><span class="nx">Author</span><span class="p">,</span>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">doc</span><span class="p">,</span><span class="w"> </span><span class="nx">source</span><span class="p">.</span><span class="nx">Embedding</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28"></a><span class="p">}</span>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29"></a>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30"></a><span class="c1">// Create Elasticsearch vector store with multi-version support (v7, v8, v9)</span>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31"></a><span class="nx">esVS</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vectorelasticsearch</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32"></a><span class="w">    </span><span class="nx">vectorelasticsearch</span><span class="p">.</span><span class="nx">WithAddresses</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;http://localhost:9200&quot;</span><span class="p">}),</span>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33"></a><span class="w">    </span><span class="nx">vectorelasticsearch</span><span class="p">.</span><span class="nx">WithUsername</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;ELASTICSEARCH_USERNAME&quot;</span><span class="p">)),</span>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34"></a><span class="w">    </span><span class="nx">vectorelasticsearch</span><span class="p">.</span><span class="nx">WithPassword</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;ELASTICSEARCH_PASSWORD&quot;</span><span class="p">)),</span>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35"></a><span class="w">    </span><span class="nx">vectorelasticsearch</span><span class="p">.</span><span class="nx">WithAPIKey</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;ELASTICSEARCH_API_KEY&quot;</span><span class="p">)),</span>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36"></a><span class="w">    </span><span class="nx">vectorelasticsearch</span><span class="p">.</span><span class="nx">WithIndexName</span><span class="p">(</span><span class="nx">getEnvOrDefault</span><span class="p">(</span><span class="s">&quot;ELASTICSEARCH_INDEX_NAME&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;trpc_agent_documents&quot;</span><span class="p">)),</span>
</span><span id="__span-10-37"><a id="__codelineno-10-37" name="__codelineno-10-37"></a><span class="w">    </span><span class="nx">vectorelasticsearch</span><span class="p">.</span><span class="nx">WithMaxRetries</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
</span><span id="__span-10-38"><a id="__codelineno-10-38" name="__codelineno-10-38"></a><span class="w">    </span><span class="c1">// Version options: &quot;v7&quot;, &quot;v8&quot;, &quot;v9&quot; (default &quot;v9&quot;)</span>
</span><span id="__span-10-39"><a id="__codelineno-10-39" name="__codelineno-10-39"></a><span class="w">    </span><span class="nx">vectorelasticsearch</span><span class="p">.</span><span class="nx">WithVersion</span><span class="p">(</span><span class="s">&quot;v9&quot;</span><span class="p">),</span>
</span><span id="__span-10-40"><a id="__codelineno-10-40" name="__codelineno-10-40"></a><span class="w">    </span><span class="c1">// Optional custom method to build documents for retrieval. Falls back to the default if not provided.</span>
</span><span id="__span-10-41"><a id="__codelineno-10-41" name="__codelineno-10-41"></a><span class="w">    </span><span class="nx">vectorelasticsearch</span><span class="p">.</span><span class="nx">WithDocBuilder</span><span class="p">(</span><span class="nx">docBuilder</span><span class="p">),</span>
</span><span id="__span-10-42"><a id="__codelineno-10-42" name="__codelineno-10-42"></a><span class="p">)</span>
</span><span id="__span-10-43"><a id="__codelineno-10-43" name="__codelineno-10-43"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-44"><a id="__codelineno-10-44" name="__codelineno-10-44"></a><span class="w">    </span><span class="c1">// Handle error.</span>
</span><span id="__span-10-45"><a id="__codelineno-10-45" name="__codelineno-10-45"></a><span class="p">}</span>
</span><span id="__span-10-46"><a id="__codelineno-10-46" name="__codelineno-10-46"></a>
</span><span id="__span-10-47"><a id="__codelineno-10-47" name="__codelineno-10-47"></a><span class="nx">kb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-10-48"><a id="__codelineno-10-48" name="__codelineno-10-48"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithVectorStore</span><span class="p">(</span><span class="nx">esVS</span><span class="p">),</span>
</span><span id="__span-10-49"><a id="__codelineno-10-49" name="__codelineno-10-49"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h5 id="qdrant">Qdrant</h5>
<p><a href="https://qdrant.tech/">Qdrant</a> is a high-performance vector database with advanced filtering capabilities, supporting both cloud and self-hosted deployments.</p>
<p><strong>Architecture</strong></p>
<p>The Qdrant integration is split into two modules.</p>
<ul>
<li><strong><code>storage/qdrant</code></strong>: Low-level client management (connection, registry, client builder)</li>
<li><strong><code>knowledge/vectorstore/qdrant</code></strong>: High-level vectorstore implementation for Knowledge</li>
</ul>
<p><strong>Basic Configuration</strong></p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span>
<span class="normal"><a href="#__codelineno-11-17">17</a></span>
<span class="normal"><a href="#__codelineno-11-18">18</a></span>
<span class="normal"><a href="#__codelineno-11-19">19</a></span>
<span class="normal"><a href="#__codelineno-11-20">20</a></span>
<span class="normal"><a href="#__codelineno-11-21">21</a></span>
<span class="normal"><a href="#__codelineno-11-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/vectorstore/qdrant&quot;</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="p">)</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4"></a>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="c1">// Local Qdrant instance (default: localhost:6334)</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="nx">qdrantVS</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="w">    </span><span class="c1">// Handle error</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="p">}</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10"></a>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="c1">// Custom configuration</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="nx">qdrantVS</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithHost</span><span class="p">(</span><span class="s">&quot;qdrant.example.com&quot;</span><span class="p">),</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithPort</span><span class="p">(</span><span class="mi">6334</span><span class="p">),</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithCollectionName</span><span class="p">(</span><span class="s">&quot;my_documents&quot;</span><span class="p">),</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithDimension</span><span class="p">(</span><span class="mi">1536</span><span class="p">),</span><span class="w">  </span><span class="c1">// Must match embedding model</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17"></a><span class="p">)</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18"></a>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19"></a><span class="nx">kb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithVectorStore</span><span class="p">(</span><span class="nx">qdrantVS</span><span class="p">),</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithEmbedder</span><span class="p">(</span><span class="nx">embedder</span><span class="p">),</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p><strong>Qdrant Cloud Configuration</strong></p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span>
<span class="normal"><a href="#__codelineno-12-6">6</a></span>
<span class="normal"><a href="#__codelineno-12-7">7</a></span>
<span class="normal"><a href="#__codelineno-12-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="nx">qdrantVS</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithHost</span><span class="p">(</span><span class="s">&quot;xyz-abc.cloud.qdrant.io&quot;</span><span class="p">),</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithPort</span><span class="p">(</span><span class="mi">6334</span><span class="p">),</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithAPIKey</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;QDRANT_API_KEY&quot;</span><span class="p">)),</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithTLS</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span><span class="w">  </span><span class="c1">// Required for Qdrant Cloud</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithCollectionName</span><span class="p">(</span><span class="s">&quot;my_documents&quot;</span><span class="p">),</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithDimension</span><span class="p">(</span><span class="mi">1536</span><span class="p">),</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p><strong>Using the Storage Module (Advanced)</strong></p>
<p>The <code>storage/qdrant</code> module (<code>trpc.group/trpc-go/trpc-agent-go/storage/qdrant</code>) provides low-level client management, separate from the vectorstore implementation. You have two options:</p>
<ol>
<li><strong>Use vectorstore options directly</strong>: Configure connection on the vectorstore</li>
</ol>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="nx">vs</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithHost</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">),</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithPort</span><span class="p">(</span><span class="mi">6334</span><span class="p">),</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li><strong>Use storage module</strong>: Create a client and pass it for reuse across multiple vectorstores</li>
</ol>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span>
<span class="normal"><a href="#__codelineno-14-4">4</a></span>
<span class="normal"><a href="#__codelineno-14-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="nx">client</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">qdrantstorage</span><span class="p">.</span><span class="nx">NewClient</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="w">    </span><span class="nx">qdrantstorage</span><span class="p">.</span><span class="nx">WithHost</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">),</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">    </span><span class="nx">qdrantstorage</span><span class="p">.</span><span class="nx">WithPort</span><span class="p">(</span><span class="mi">6334</span><span class="p">),</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="p">)</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="nx">vs</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithClient</span><span class="p">(</span><span class="nx">client</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
<p>The storage module also provides a <strong>registry pattern</strong> to register named instances (e.g., "test", "prod") at startup and retrieve them by name throughout your application.</p>
<p><strong>Hybrid Search with BM25</strong></p>
<p>Qdrant supports hybrid search combining dense vector similarity and BM25 keyword matching using Reciprocal Rank Fusion (RRF):</p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span>
<span class="normal"><a href="#__codelineno-15-4">4</a></span>
<span class="normal"><a href="#__codelineno-15-5">5</a></span>
<span class="normal"><a href="#__codelineno-15-6">6</a></span>
<span class="normal"><a href="#__codelineno-15-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="nx">qdrantVS</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithHost</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">),</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithPort</span><span class="p">(</span><span class="mi">6334</span><span class="p">),</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithCollectionName</span><span class="p">(</span><span class="s">&quot;my_documents&quot;</span><span class="p">),</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithDimension</span><span class="p">(</span><span class="mi">1536</span><span class="p">),</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithBM25</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span><span class="w">  </span><span class="c1">// Enable BM25 hybrid search</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>When BM25 is enabled, the vectorstore creates a collection with both dense and sparse vectors. You can then use different search modes:</p>
<ul>
<li><strong>Vector search</strong> (default): Dense vector similarity search</li>
<li><strong>Keyword search</strong>: BM25 sparse vector search (requires <code>WithBM25(true)</code>)</li>
<li><strong>Hybrid search</strong>: Combines dense and sparse results using RRF fusion (requires <code>WithBM25(true)</code>)</li>
<li><strong>Filter search</strong>: Metadata-only filtering without vector similarity</li>
</ul>
<blockquote>
<p><strong>Important Notes on BM25 Collections:</strong></p>
<ul>
<li><strong>Collection compatibility</strong>: BM25-enabled and non-BM25 collections have different vector configurations. You cannot create a vectorstore with <code>WithBM25(true)</code> on an existing non-BM25 collection, or vice versa. The vectorstore validates the collection configuration on startup and returns an error if there's a mismatch.</li>
<li><strong>Fallback behavior</strong>: If you attempt keyword or hybrid search without BM25 enabled, keyword search will return an error, and hybrid search will fall back to vector-only search (with a warning log if a logger is configured).</li>
<li><strong>Consistent configuration</strong>: Always use the same BM25 setting when connecting to an existing collection. If you indexed documents with <code>WithBM25(true)</code>, you must use <code>WithBM25(true)</code> when creating a new vectorstore instance on that collection.</li>
</ul>
</blockquote>
<p><strong>Configuration Options</strong></p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>WithClient(client)</code></td>
<td><code>nil</code></td>
<td>Use a pre-created client (from storage module)</td>
</tr>
<tr>
<td><code>WithHost(host)</code></td>
<td><code>"localhost"</code></td>
<td>Qdrant server hostname</td>
</tr>
<tr>
<td><code>WithPort(port)</code></td>
<td><code>6334</code></td>
<td>Qdrant gRPC port (1-65535)</td>
</tr>
<tr>
<td><code>WithAPIKey(key)</code></td>
<td><code>""</code></td>
<td>API key for Qdrant Cloud authentication</td>
</tr>
<tr>
<td><code>WithTLS(enabled)</code></td>
<td><code>false</code></td>
<td>Enable TLS (required for Qdrant Cloud)</td>
</tr>
<tr>
<td><code>WithCollectionName(name)</code></td>
<td><code>"trpc_agent_documents"</code></td>
<td>Collection name</td>
</tr>
<tr>
<td><code>WithDimension(dim)</code></td>
<td><code>1536</code></td>
<td>Vector dimension (must match embedding model)</td>
</tr>
<tr>
<td><code>WithDistance(d)</code></td>
<td><code>DistanceCosine</code></td>
<td>Distance metric (Cosine, Euclid, Dot, Manhattan)</td>
</tr>
<tr>
<td><code>WithMaxResults(max)</code></td>
<td><code>10</code></td>
<td>Default number of search results</td>
</tr>
<tr>
<td><code>WithBM25(enabled)</code></td>
<td><code>false</code></td>
<td>Enable BM25 sparse vectors for hybrid/keyword search</td>
</tr>
<tr>
<td><code>WithPrefetchMultiplier(n)</code></td>
<td><code>3</code></td>
<td>Prefetch multiplier for hybrid search fusion</td>
</tr>
<tr>
<td><code>WithOnDiskVectors(enabled)</code></td>
<td><code>false</code></td>
<td>Store vectors on disk (for large datasets)</td>
</tr>
<tr>
<td><code>WithOnDiskPayload(enabled)</code></td>
<td><code>false</code></td>
<td>Store payloads on disk</td>
</tr>
<tr>
<td><code>WithHNSWConfig(m, efConstruct)</code></td>
<td><code>16, 128</code></td>
<td>HNSW index parameters (higher = better recall, more memory)</td>
</tr>
<tr>
<td><code>WithMaxRetries(n)</code></td>
<td><code>3</code></td>
<td>Max retry attempts for transient gRPC errors</td>
</tr>
<tr>
<td><code>WithBaseRetryDelay(d)</code></td>
<td><code>100ms</code></td>
<td>Initial retry delay</td>
</tr>
<tr>
<td><code>WithMaxRetryDelay(d)</code></td>
<td><code>5s</code></td>
<td>Maximum retry delay</td>
</tr>
</tbody>
</table>
<h3 id="embedder">Embedder</h3>
<p>Embedder is responsible for converting text to vector representations and is a core component of the Knowledge system. Currently, the framework mainly supports OpenAI embedding models:</p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="w">    </span><span class="nx">openaiembedder</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/embedder/openai&quot;</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="p">)</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4"></a>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="c1">// OpenAI Embedder configuration.</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="nx">embedder</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">openaiembedder</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="w">    </span><span class="nx">openaiembedder</span><span class="p">.</span><span class="nx">WithModel</span><span class="p">(</span><span class="s">&quot;text-embedding-3-small&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// Embedding model, can also be set via OPENAI_EMBEDDING_MODEL environment variable.</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="p">)</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9"></a>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="c1">// Pass to Knowledge.</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="nx">kb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithEmbedder</span><span class="p">(</span><span class="nx">embedder</span><span class="p">),</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p><strong>Supported embedding models</strong>:</p>
<ul>
<li>OpenAI embedding models (text-embedding-3-small, etc.)</li>
<li>Other OpenAI API compatible embedding services</li>
<li>Gemini embedding model (via <code>knowledge/embedder/gemini</code>)</li>
<li>Ollama embedding model (via <code>knowledge/embedder/ollama</code>)</li>
<li>huggingface text_embedding_interface model (via <code>knowledge/embedder/huggingface</code>）</li>
</ul>
<blockquote>
<p><strong>Note</strong>:</p>
<ul>
<li>Retriever and Reranker are currently implemented internally by Knowledge, users don't need to configure them separately. Knowledge automatically handles document retrieval and result ranking.</li>
<li>The <code>OPENAI_EMBEDDING_MODEL</code> environment variable needs to be manually read in code, the framework won't read it automatically. Refer to the <code>getEnvOrDefault("OPENAI_EMBEDDING_MODEL", "")</code> implementation in the example code.</li>
</ul>
</blockquote>
<h3 id="reranker">Reranker</h3>
<blockquote>
<p>📁 <strong>Example Code</strong>: <a href="https://github.com/trpc-group/trpc-agent-go/tree/main/examples/knowledge/reranker">examples/knowledge/reranker</a></p>
</blockquote>
<p>Reranker is responsible for the precise ranking of search results. trpc-agent-go supports multiple Reranker implementations:</p>
<h4 id="topk-simple-truncation">TopK (Simple Truncation)</h4>
<p>The most basic Reranker, which simply truncates the Top K results based on retrieval scores:</p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span>
<span class="normal"><a href="#__codelineno-17-3">3</a></span>
<span class="normal"><a href="#__codelineno-17-4">4</a></span>
<span class="normal"><a href="#__codelineno-17-5">5</a></span>
<span class="normal"><a href="#__codelineno-17-6">6</a></span>
<span class="normal"><a href="#__codelineno-17-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/reranker/topk&quot;</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="p">)</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4"></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="nx">rerank</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">topk</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="w">    </span><span class="nx">topk</span><span class="p">.</span><span class="nx">WithK</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="c1">// Specify the number of results to return after reranking</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="cohere-saas-rerank">Cohere (SaaS Rerank)</h4>
<p>Uses Cohere's official API for reranking, typically providing better results than simple vector retrieval:</p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/reranker/cohere&quot;</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="p">)</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4"></a>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="c1">// API key provided via WithAPIKey option</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="nx">rerank</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cohere</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="w">    </span><span class="nx">cohere</span><span class="p">.</span><span class="nx">WithAPIKey</span><span class="p">(</span><span class="s">&quot;your-api-key&quot;</span><span class="p">),</span><span class="w">       </span><span class="c1">// Required: API key</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="w">    </span><span class="nx">cohere</span><span class="p">.</span><span class="nx">WithModel</span><span class="p">(</span><span class="s">&quot;rerank-english-v3.0&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// Specify model</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="w">    </span><span class="nx">cohere</span><span class="p">.</span><span class="nx">WithTopN</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="w">                      </span><span class="c1">// Final number of results</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="infinity-tei">Infinity / TEI</h4>
<p><strong>Terminology</strong></p>
<ul>
<li><strong>Infinity</strong>: Open-source high-performance inference engine supporting multiple Reranker models</li>
<li><strong>TEI (Text Embeddings Inference)</strong>: Official Hugging Face inference engine optimized for Embeddings and Reranking</li>
</ul>
<p>The Infinity Reranker implementation in trpc-agent-go can connect to any service compatible with the standard Rerank API, including self-hosted services using Infinity/TEI, Hugging Face Inference Endpoints, etc.</p>
<p><strong>Usage</strong></p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/reranker/infinity&quot;</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="p">)</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4"></a>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="c1">// Connect to self-hosted or managed Rerank service</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="nx">reranker</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">infinity</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="w">    </span><span class="nx">infinity</span><span class="p">.</span><span class="nx">WithEndpoint</span><span class="p">(</span><span class="s">&quot;http://localhost:7997/rerank&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// Required: Service endpoint</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="w">    </span><span class="nx">infinity</span><span class="p">.</span><span class="nx">WithModel</span><span class="p">(</span><span class="s">&quot;BAAI/bge-reranker-v2-m3&quot;</span><span class="p">),</span><span class="w">         </span><span class="c1">// Optional: Model name</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="w">    </span><span class="nx">infinity</span><span class="p">.</span><span class="nx">WithTopN</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="w">                                   </span><span class="c1">// Optional: Result count</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="p">)</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;Failed to create reranker: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>For detailed deployment methods and examples, see the <code>examples/knowledge/reranker/infinity/</code> directory.</p>
<h4 id="configure-reranker-to-knowledge">Configure Reranker to Knowledge</h4>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span>
<span class="normal"><a href="#__codelineno-20-2">2</a></span>
<span class="normal"><a href="#__codelineno-20-3">3</a></span>
<span class="normal"><a href="#__codelineno-20-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="nx">kb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithReranker</span><span class="p">(</span><span class="nx">rerank</span><span class="p">),</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="w">    </span><span class="c1">// ... other configurations</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="document-source-configuration">Document Source Configuration</h3>
<blockquote>
<p>📁 <strong>Example Code</strong>: <a href="https://github.com/trpc-group/trpc-agent-go/tree/main/examples/knowledge/sources">examples/knowledge/sources</a></p>
</blockquote>
<p>The source module provides multiple document source types, each supporting rich configuration options:</p>
<ul>
<li><strong>File source (file)</strong>: Single file processing - <a href="https://github.com/trpc-group/trpc-agent-go/tree/main/examples/knowledge/sources/file-source">Example</a></li>
<li><strong>Directory source (dir)</strong>: Batch directory processing - <a href="https://github.com/trpc-group/trpc-agent-go/tree/main/examples/knowledge/sources/directory-source">Example</a></li>
<li><strong>URL source (url)</strong>: Get content from web pages - <a href="https://github.com/trpc-group/trpc-agent-go/tree/main/examples/knowledge/sources/url-source">Example</a></li>
<li><strong>Auto source (auto)</strong>: Intelligent type recognition - <a href="https://github.com/trpc-group/trpc-agent-go/tree/main/examples/knowledge/sources/auto-source">Example</a></li>
</ul>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span>
<span class="normal"><a href="#__codelineno-21-12">12</a></span>
<span class="normal"><a href="#__codelineno-21-13">13</a></span>
<span class="normal"><a href="#__codelineno-21-14">14</a></span>
<span class="normal"><a href="#__codelineno-21-15">15</a></span>
<span class="normal"><a href="#__codelineno-21-16">16</a></span>
<span class="normal"><a href="#__codelineno-21-17">17</a></span>
<span class="normal"><a href="#__codelineno-21-18">18</a></span>
<span class="normal"><a href="#__codelineno-21-19">19</a></span>
<span class="normal"><a href="#__codelineno-21-20">20</a></span>
<span class="normal"><a href="#__codelineno-21-21">21</a></span>
<span class="normal"><a href="#__codelineno-21-22">22</a></span>
<span class="normal"><a href="#__codelineno-21-23">23</a></span>
<span class="normal"><a href="#__codelineno-21-24">24</a></span>
<span class="normal"><a href="#__codelineno-21-25">25</a></span>
<span class="normal"><a href="#__codelineno-21-26">26</a></span>
<span class="normal"><a href="#__codelineno-21-27">27</a></span>
<span class="normal"><a href="#__codelineno-21-28">28</a></span>
<span class="normal"><a href="#__codelineno-21-29">29</a></span>
<span class="normal"><a href="#__codelineno-21-30">30</a></span>
<span class="normal"><a href="#__codelineno-21-31">31</a></span>
<span class="normal"><a href="#__codelineno-21-32">32</a></span>
<span class="normal"><a href="#__codelineno-21-33">33</a></span>
<span class="normal"><a href="#__codelineno-21-34">34</a></span>
<span class="normal"><a href="#__codelineno-21-35">35</a></span>
<span class="normal"><a href="#__codelineno-21-36">36</a></span>
<span class="normal"><a href="#__codelineno-21-37">37</a></span>
<span class="normal"><a href="#__codelineno-21-38">38</a></span>
<span class="normal"><a href="#__codelineno-21-39">39</a></span>
<span class="normal"><a href="#__codelineno-21-40">40</a></span>
<span class="normal"><a href="#__codelineno-21-41">41</a></span>
<span class="normal"><a href="#__codelineno-21-42">42</a></span>
<span class="normal"><a href="#__codelineno-21-43">43</a></span>
<span class="normal"><a href="#__codelineno-21-44">44</a></span>
<span class="normal"><a href="#__codelineno-21-45">45</a></span>
<span class="normal"><a href="#__codelineno-21-46">46</a></span>
<span class="normal"><a href="#__codelineno-21-47">47</a></span>
<span class="normal"><a href="#__codelineno-21-48">48</a></span>
<span class="normal"><a href="#__codelineno-21-49">49</a></span>
<span class="normal"><a href="#__codelineno-21-50">50</a></span>
<span class="normal"><a href="#__codelineno-21-51">51</a></span>
<span class="normal"><a href="#__codelineno-21-52">52</a></span>
<span class="normal"><a href="#__codelineno-21-53">53</a></span>
<span class="normal"><a href="#__codelineno-21-54">54</a></span>
<span class="normal"><a href="#__codelineno-21-55">55</a></span>
<span class="normal"><a href="#__codelineno-21-56">56</a></span>
<span class="normal"><a href="#__codelineno-21-57">57</a></span>
<span class="normal"><a href="#__codelineno-21-58">58</a></span>
<span class="normal"><a href="#__codelineno-21-59">59</a></span>
<span class="normal"><a href="#__codelineno-21-60">60</a></span>
<span class="normal"><a href="#__codelineno-21-61">61</a></span>
<span class="normal"><a href="#__codelineno-21-62">62</a></span>
<span class="normal"><a href="#__codelineno-21-63">63</a></span>
<span class="normal"><a href="#__codelineno-21-64">64</a></span>
<span class="normal"><a href="#__codelineno-21-65">65</a></span>
<span class="normal"><a href="#__codelineno-21-66">66</a></span>
<span class="normal"><a href="#__codelineno-21-67">67</a></span>
<span class="normal"><a href="#__codelineno-21-68">68</a></span>
<span class="normal"><a href="#__codelineno-21-69">69</a></span>
<span class="normal"><a href="#__codelineno-21-70">70</a></span>
<span class="normal"><a href="#__codelineno-21-71">71</a></span>
<span class="normal"><a href="#__codelineno-21-72">72</a></span>
<span class="normal"><a href="#__codelineno-21-73">73</a></span>
<span class="normal"><a href="#__codelineno-21-74">74</a></span>
<span class="normal"><a href="#__codelineno-21-75">75</a></span>
<span class="normal"><a href="#__codelineno-21-76">76</a></span>
<span class="normal"><a href="#__codelineno-21-77">77</a></span>
<span class="normal"><a href="#__codelineno-21-78">78</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge&quot;</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">    </span><span class="nx">openaiembedder</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/embedder/openai&quot;</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/source&quot;</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="w">    </span><span class="nx">filesource</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/source/file&quot;</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="w">    </span><span class="nx">dirsource</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/source/dir&quot;</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="w">    </span><span class="nx">urlsource</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/source/url&quot;</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="w">    </span><span class="nx">autosource</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/source/auto&quot;</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="w">    </span><span class="nx">vectorinmemory</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/vectorstore/inmemory&quot;</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="p">)</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11"></a>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="c1">// File source: Single file processing, supports .txt, .md, .go, .json, etc. formats.</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13"></a><span class="nx">fileSrc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14"></a><span class="w">    </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;./data/llm.md&quot;</span><span class="p">},</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15"></a><span class="w">    </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">WithChunkSize</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span><span class="w">      </span><span class="c1">// Chunk size.</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16"></a><span class="w">    </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">WithChunkOverlap</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span><span class="w">    </span><span class="c1">// Chunk overlap.</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17"></a><span class="w">    </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">WithName</span><span class="p">(</span><span class="s">&quot;LLM Doc&quot;</span><span class="p">),</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18"></a><span class="w">    </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;documentation&quot;</span><span class="p">),</span>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19"></a><span class="p">)</span>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20"></a>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21"></a><span class="c1">// Directory source: Batch directory processing, supports recursion and filtering.</span>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22"></a><span class="nx">dirSrc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">dirsource</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23"></a><span class="w">    </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;./docs&quot;</span><span class="p">},</span>
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24"></a><span class="w">    </span><span class="nx">dirsource</span><span class="p">.</span><span class="nx">WithRecursive</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span><span class="w">                           </span><span class="c1">// Recursively process subdirectories.</span>
</span><span id="__span-21-25"><a id="__codelineno-21-25" name="__codelineno-21-25"></a><span class="w">    </span><span class="nx">dirsource</span><span class="p">.</span><span class="nx">WithFileExtensions</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;.md&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.txt&quot;</span><span class="p">}),</span><span class="w">   </span><span class="c1">// File extension filtering.</span>
</span><span id="__span-21-26"><a id="__codelineno-21-26" name="__codelineno-21-26"></a><span class="w">    </span><span class="nx">dirsource</span><span class="p">.</span><span class="nx">WithExcludePatterns</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;*.tmp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;*.log&quot;</span><span class="p">}),</span><span class="w"> </span><span class="c1">// Exclusion patterns.</span>
</span><span id="__span-21-27"><a id="__codelineno-21-27" name="__codelineno-21-27"></a><span class="w">    </span><span class="nx">dirsource</span><span class="p">.</span><span class="nx">WithChunkSize</span><span class="p">(</span><span class="mi">800</span><span class="p">),</span>
</span><span id="__span-21-28"><a id="__codelineno-21-28" name="__codelineno-21-28"></a><span class="w">    </span><span class="nx">dirsource</span><span class="p">.</span><span class="nx">WithName</span><span class="p">(</span><span class="s">&quot;Documentation&quot;</span><span class="p">),</span>
</span><span id="__span-21-29"><a id="__codelineno-21-29" name="__codelineno-21-29"></a><span class="p">)</span>
</span><span id="__span-21-30"><a id="__codelineno-21-30" name="__codelineno-21-30"></a>
</span><span id="__span-21-31"><a id="__codelineno-21-31" name="__codelineno-21-31"></a><span class="c1">// URL source: Get content from web pages and APIs.</span>
</span><span id="__span-21-32"><a id="__codelineno-21-32" name="__codelineno-21-32"></a><span class="nx">urlSrc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">urlsource</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-21-33"><a id="__codelineno-21-33" name="__codelineno-21-33"></a><span class="w">    </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;https://en.wikipedia.org/wiki/Artificial_intelligence&quot;</span><span class="p">},</span>
</span><span id="__span-21-34"><a id="__codelineno-21-34" name="__codelineno-21-34"></a><span class="w">    </span><span class="nx">urlsource</span><span class="p">.</span><span class="nx">WithTimeout</span><span class="p">(</span><span class="mi">30</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">),</span><span class="w">           </span><span class="c1">// Request timeout.</span>
</span><span id="__span-21-35"><a id="__codelineno-21-35" name="__codelineno-21-35"></a><span class="w">    </span><span class="nx">urlsource</span><span class="p">.</span><span class="nx">WithUserAgent</span><span class="p">(</span><span class="s">&quot;MyBot/1.0&quot;</span><span class="p">),</span><span class="w">           </span><span class="c1">// Custom User-Agent.</span>
</span><span id="__span-21-36"><a id="__codelineno-21-36" name="__codelineno-21-36"></a><span class="w">    </span><span class="nx">urlsource</span><span class="p">.</span><span class="nx">WithMaxContentLength</span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">),</span><span class="w">       </span><span class="c1">// Maximum content length (1MB).</span>
</span><span id="__span-21-37"><a id="__codelineno-21-37" name="__codelineno-21-37"></a><span class="w">    </span><span class="nx">urlsource</span><span class="p">.</span><span class="nx">WithName</span><span class="p">(</span><span class="s">&quot;Web Content&quot;</span><span class="p">),</span>
</span><span id="__span-21-38"><a id="__codelineno-21-38" name="__codelineno-21-38"></a><span class="p">)</span>
</span><span id="__span-21-39"><a id="__codelineno-21-39" name="__codelineno-21-39"></a>
</span><span id="__span-21-40"><a id="__codelineno-21-40" name="__codelineno-21-40"></a><span class="c1">// URL source advanced configuration: Separate content fetching and document identification</span>
</span><span id="__span-21-41"><a id="__codelineno-21-41" name="__codelineno-21-41"></a><span class="nx">urlSrcAlias</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">urlsource</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-21-42"><a id="__codelineno-21-42" name="__codelineno-21-42"></a><span class="w">    </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;https://trpc-go.com/docs/api.md&quot;</span><span class="p">},</span><span class="w">     </span><span class="c1">// Identifier URL (for document ID and metadata)</span>
</span><span id="__span-21-43"><a id="__codelineno-21-43" name="__codelineno-21-43"></a><span class="w">    </span><span class="nx">urlsource</span><span class="p">.</span><span class="nx">WithContentFetchingURL</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;https://github.com/trpc-group/trpc-go/raw/main/docs/api.md&quot;</span><span class="p">}),</span><span class="w"> </span><span class="c1">// Actual content fetching URL</span>
</span><span id="__span-21-44"><a id="__codelineno-21-44" name="__codelineno-21-44"></a><span class="w">    </span><span class="nx">urlsource</span><span class="p">.</span><span class="nx">WithName</span><span class="p">(</span><span class="s">&quot;TRPC API Docs&quot;</span><span class="p">),</span>
</span><span id="__span-21-45"><a id="__codelineno-21-45" name="__codelineno-21-45"></a><span class="w">    </span><span class="nx">urlsource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;source&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;github&quot;</span><span class="p">),</span>
</span><span id="__span-21-46"><a id="__codelineno-21-46" name="__codelineno-21-46"></a><span class="p">)</span>
</span><span id="__span-21-47"><a id="__codelineno-21-47" name="__codelineno-21-47"></a><span class="c1">// Note: When using WithContentFetchingURL, the identifier URL should preserve the file information from the content fetching URL, for example:</span>
</span><span id="__span-21-48"><a id="__codelineno-21-48" name="__codelineno-21-48"></a><span class="c1">// Correct: Identifier URL is https://trpc-go.com/docs/api.md, fetch URL is https://github.com/.../docs/api.md</span>
</span><span id="__span-21-49"><a id="__codelineno-21-49" name="__codelineno-21-49"></a><span class="c1">// Incorrect: Identifier URL is https://trpc-go.com, which loses document path information</span>
</span><span id="__span-21-50"><a id="__codelineno-21-50" name="__codelineno-21-50"></a>
</span><span id="__span-21-51"><a id="__codelineno-21-51" name="__codelineno-21-51"></a><span class="c1">// Auto source: Intelligent type recognition, automatically select processor.</span>
</span><span id="__span-21-52"><a id="__codelineno-21-52" name="__codelineno-21-52"></a><span class="nx">autoSrc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">autosource</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-21-53"><a id="__codelineno-21-53" name="__codelineno-21-53"></a><span class="w">    </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
</span><span id="__span-21-54"><a id="__codelineno-21-54" name="__codelineno-21-54"></a><span class="w">        </span><span class="s">&quot;Cloud computing provides on-demand access to computing resources.&quot;</span><span class="p">,</span>
</span><span id="__span-21-55"><a id="__codelineno-21-55" name="__codelineno-21-55"></a><span class="w">        </span><span class="s">&quot;https://docs.example.com/api&quot;</span><span class="p">,</span>
</span><span id="__span-21-56"><a id="__codelineno-21-56" name="__codelineno-21-56"></a><span class="w">        </span><span class="s">&quot;./config.yaml&quot;</span><span class="p">,</span>
</span><span id="__span-21-57"><a id="__codelineno-21-57" name="__codelineno-21-57"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-21-58"><a id="__codelineno-21-58" name="__codelineno-21-58"></a><span class="w">    </span><span class="nx">autosource</span><span class="p">.</span><span class="nx">WithName</span><span class="p">(</span><span class="s">&quot;Mixed Sources&quot;</span><span class="p">),</span>
</span><span id="__span-21-59"><a id="__codelineno-21-59" name="__codelineno-21-59"></a><span class="w">    </span><span class="nx">autosource</span><span class="p">.</span><span class="nx">WithFallbackChunkSize</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span>
</span><span id="__span-21-60"><a id="__codelineno-21-60" name="__codelineno-21-60"></a><span class="p">)</span>
</span><span id="__span-21-61"><a id="__codelineno-21-61" name="__codelineno-21-61"></a>
</span><span id="__span-21-62"><a id="__codelineno-21-62" name="__codelineno-21-62"></a><span class="c1">// Combine usage.</span>
</span><span id="__span-21-63"><a id="__codelineno-21-63" name="__codelineno-21-63"></a><span class="nx">sources</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">source</span><span class="p">.</span><span class="nx">Source</span><span class="p">{</span><span class="nx">fileSrc</span><span class="p">,</span><span class="w"> </span><span class="nx">dirSrc</span><span class="p">,</span><span class="w"> </span><span class="nx">urlSrc</span><span class="p">,</span><span class="w"> </span><span class="nx">autoSrc</span><span class="p">}</span>
</span><span id="__span-21-64"><a id="__codelineno-21-64" name="__codelineno-21-64"></a>
</span><span id="__span-21-65"><a id="__codelineno-21-65" name="__codelineno-21-65"></a><span class="nx">embedder</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">openaiembedder</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">openaiembedder</span><span class="p">.</span><span class="nx">WithModel</span><span class="p">(</span><span class="s">&quot;text-embedding-3-small&quot;</span><span class="p">))</span>
</span><span id="__span-21-66"><a id="__codelineno-21-66" name="__codelineno-21-66"></a><span class="nx">vectorStore</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vectorinmemory</span><span class="p">.</span><span class="nx">New</span><span class="p">()</span>
</span><span id="__span-21-67"><a id="__codelineno-21-67" name="__codelineno-21-67"></a>
</span><span id="__span-21-68"><a id="__codelineno-21-68" name="__codelineno-21-68"></a><span class="c1">// Pass to Knowledge.</span>
</span><span id="__span-21-69"><a id="__codelineno-21-69" name="__codelineno-21-69"></a><span class="nx">kb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-21-70"><a id="__codelineno-21-70" name="__codelineno-21-70"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithEmbedder</span><span class="p">(</span><span class="nx">embedder</span><span class="p">),</span>
</span><span id="__span-21-71"><a id="__codelineno-21-71" name="__codelineno-21-71"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithVectorStore</span><span class="p">(</span><span class="nx">vectorStore</span><span class="p">),</span>
</span><span id="__span-21-72"><a id="__codelineno-21-72" name="__codelineno-21-72"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithSources</span><span class="p">(</span><span class="nx">sources</span><span class="p">),</span>
</span><span id="__span-21-73"><a id="__codelineno-21-73" name="__codelineno-21-73"></a><span class="p">)</span>
</span><span id="__span-21-74"><a id="__codelineno-21-74" name="__codelineno-21-74"></a>
</span><span id="__span-21-75"><a id="__codelineno-21-75" name="__codelineno-21-75"></a><span class="c1">// Load all sources.</span>
</span><span id="__span-21-76"><a id="__codelineno-21-76" name="__codelineno-21-76"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">kb</span><span class="p">.</span><span class="nx">Load</span><span class="p">(</span><span class="nx">ctx</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-77"><a id="__codelineno-21-77" name="__codelineno-21-77"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;Failed to load knowledge base: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-21-78"><a id="__codelineno-21-78" name="__codelineno-21-78"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="batch-document-processing-and-concurrency">Batch Document Processing and Concurrency</h3>
<p>Knowledge supports batch document processing and concurrent loading, which can significantly improve processing performance for large amounts of documents:</p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span>
<span class="normal"><a href="#__codelineno-22-2">2</a></span>
<span class="normal"><a href="#__codelineno-22-3">3</a></span>
<span class="normal"><a href="#__codelineno-22-4">4</a></span>
<span class="normal"><a href="#__codelineno-22-5">5</a></span>
<span class="normal"><a href="#__codelineno-22-6">6</a></span>
<span class="normal"><a href="#__codelineno-22-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">kb</span><span class="p">.</span><span class="nx">Load</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithShowProgress</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span><span class="w">      </span><span class="c1">// Print progress logs.</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithProgressStepSize</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="w">    </span><span class="c1">// Progress step size.</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithShowStats</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span><span class="w">         </span><span class="c1">// Print statistics.</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithSourceConcurrency</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">    </span><span class="c1">// Source-level concurrency.</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithDocConcurrency</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span><span class="w">      </span><span class="c1">// Document-level concurrency.</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p>Note on performance and rate limits:</p>
<ul>
<li>Higher concurrency increases embedder API request rates (OpenAI/Gemini) and may hit rate limits.</li>
<li>Tune <code>WithSourceConcurrency()</code> and <code>WithDocConcurrency()</code> based on throughput, cost, and limits.</li>
<li>Defaults are balanced for most scenarios; increase for speed, decrease to avoid throttling.</li>
</ul>
</blockquote>
<h2 id="filter-functionality">Filter Functionality</h2>
<blockquote>
<p>📁 <strong>Example Code</strong>: <a href="https://github.com/trpc-group/trpc-agent-go/tree/main/examples/knowledge/features/metadata-filter">examples/knowledge/features/metadata-filter</a></p>
</blockquote>
<p>The Knowledge system provides powerful filter functionality that allows precise search based on document metadata. This includes both static filters and intelligent filters.</p>
<blockquote>
<p><strong>Important: Filter Field Naming Convention</strong></p>
<p>When using filters, <strong>metadata fields should use the <code>metadata.</code> prefix</strong>:
- The <code>metadata.</code> prefix distinguishes metadata fields from system fields (e.g., <code>id</code>, <code>name</code>, <code>content</code>)
- Whether using <code>WithKnowledgeFilter()</code>, <code>tool.WithFilter()</code>, or <code>searchfilter.Equal()</code>, metadata fields should include the <code>metadata.</code> prefix
- If you customized the metadata field name via <code>WithMetadataField()</code>, still use the <code>metadata.</code> prefix; the framework will automatically convert it to the actual field name
- Custom table columns added via <code>WithDocBuilder</code> (e.g., <code>status</code>, <code>priority</code>) use the field name directly without prefix</p>
</blockquote>
<h3 id="basic-filters">Basic Filters</h3>
<p>Basic filters support two configuration methods: Agent-level fixed filters and Runner-level runtime filters.</p>
<h4 id="agent-level-filters">Agent-level Filters</h4>
<p>Preset fixed search filter conditions when creating an Agent:</p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="c1">// Create Agent with fixed filters</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="nx">llmAgent</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">    </span><span class="s">&quot;knowledge-assistant&quot;</span><span class="p">,</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithModel</span><span class="p">(</span><span class="nx">modelInstance</span><span class="p">),</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithKnowledge</span><span class="p">(</span><span class="nx">kb</span><span class="p">),</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithKnowledgeFilter</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="w">        </span><span class="s">&quot;metadata.category&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;documentation&quot;</span><span class="p">,</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="w">        </span><span class="s">&quot;metadata.topic&quot;</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;programming&quot;</span><span class="p">,</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="w">    </span><span class="p">}),</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="runner-level-filters">Runner-level Filters</h4>
<p>Dynamically pass filters when calling <code>runner.Run()</code>, suitable for scenarios that require filtering based on different request contexts:</p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span>
<span class="normal"><a href="#__codelineno-24-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/agent&quot;</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2"></a>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="c1">// Pass filters at runtime</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="nx">eventCh</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">runner</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="w">    </span><span class="nx">ctx</span><span class="p">,</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="w">    </span><span class="nx">userID</span><span class="p">,</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="w">    </span><span class="nx">sessionID</span><span class="p">,</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="w">    </span><span class="nx">message</span><span class="p">,</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="w">    </span><span class="nx">agent</span><span class="p">.</span><span class="nx">WithKnowledgeFilter</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="w">        </span><span class="s">&quot;metadata.user_level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;premium&quot;</span><span class="p">,</span><span class="w">     </span><span class="c1">// Filter by user level</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11"></a><span class="w">        </span><span class="s">&quot;metadata.region&quot;</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;china&quot;</span><span class="p">,</span><span class="w">       </span><span class="c1">// Filter by region</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12"></a><span class="w">        </span><span class="s">&quot;metadata.language&quot;</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;zh&quot;</span><span class="p">,</span><span class="w">          </span><span class="c1">// Filter by language</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="w">    </span><span class="p">}),</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p><strong>Important</strong>: Agent-level filters have higher priority than Runner-level filters, and values with the same key will be overridden by Agent-level:</p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span>
<span class="normal"><a href="#__codelineno-25-12">12</a></span>
<span class="normal"><a href="#__codelineno-25-13">13</a></span>
<span class="normal"><a href="#__codelineno-25-14">14</a></span>
<span class="normal"><a href="#__codelineno-25-15">15</a></span>
<span class="normal"><a href="#__codelineno-25-16">16</a></span>
<span class="normal"><a href="#__codelineno-25-17">17</a></span>
<span class="normal"><a href="#__codelineno-25-18">18</a></span>
<span class="normal"><a href="#__codelineno-25-19">19</a></span>
<span class="normal"><a href="#__codelineno-25-20">20</a></span>
<span class="normal"><a href="#__codelineno-25-21">21</a></span>
<span class="normal"><a href="#__codelineno-25-22">22</a></span>
<span class="normal"><a href="#__codelineno-25-23">23</a></span>
<span class="normal"><a href="#__codelineno-25-24">24</a></span>
<span class="normal"><a href="#__codelineno-25-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="c1">// Agent-level filter</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="nx">llmAgent</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="w">    </span><span class="s">&quot;assistant&quot;</span><span class="p">,</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithKnowledge</span><span class="p">(</span><span class="nx">kb</span><span class="p">),</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithKnowledgeFilter</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="w">        </span><span class="s">&quot;metadata.category&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;general&quot;</span><span class="p">,</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="w">        </span><span class="s">&quot;metadata.source&quot;</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;internal&quot;</span><span class="p">,</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="w">    </span><span class="p">}),</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9"></a><span class="p">)</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10"></a>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="c1">// Runner-level filter&#39;s same keys will be overridden by Agent-level</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12"></a><span class="nx">eventCh</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">runner</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13"></a><span class="w">    </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">,</span><span class="w"> </span><span class="nx">sessionID</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14"></a><span class="w">    </span><span class="nx">agent</span><span class="p">.</span><span class="nx">WithKnowledgeFilter</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15"></a><span class="w">        </span><span class="s">&quot;metadata.source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;external&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1">// Will be overridden by Agent-level &quot;internal&quot;</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16"></a><span class="w">        </span><span class="s">&quot;metadata.topic&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;api&quot;</span><span class="p">,</span><span class="w">       </span><span class="c1">// Add new filter condition (not in Agent-level)</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17"></a><span class="w">    </span><span class="p">}),</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18"></a><span class="p">)</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19"></a>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20"></a><span class="c1">// Final effective filter:</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21"></a><span class="c1">// {</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22"></a><span class="c1">//     &quot;metadata.category&quot;: &quot;general&quot;,   // From Agent-level</span>
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23"></a><span class="c1">//     &quot;metadata.source&quot;:   &quot;internal&quot;,  // From Agent-level (overrode Runner-level &quot;external&quot;)</span>
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24"></a><span class="c1">//     &quot;metadata.topic&quot;:    &quot;api&quot;,       // From Runner-level (added)</span>
</span><span id="__span-25-25"><a id="__codelineno-25-25" name="__codelineno-25-25"></a><span class="c1">// }</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="intelligent-filters-agentic-filter">Intelligent Filters (Agentic Filter)</h3>
<blockquote>
<p>📁 <strong>Example Code</strong>: <a href="https://github.com/trpc-group/trpc-agent-go/tree/main/examples/knowledge/features/agentic-filter">examples/knowledge/features/agentic-filter</a></p>
</blockquote>
<p>Intelligent filters are an advanced feature of the Knowledge system that allows LLM Agents to dynamically select appropriate filter conditions based on user queries.</p>
<h4 id="enable-intelligent-filters">Enable Intelligent Filters</h4>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span>
<span class="normal"><a href="#__codelineno-26-14">14</a></span>
<span class="normal"><a href="#__codelineno-26-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/source&quot;</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="p">)</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4"></a>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="c1">// Get metadata information from all sources</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="nx">sourcesMetadata</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">source</span><span class="p">.</span><span class="nx">GetAllMetadata</span><span class="p">(</span><span class="nx">sources</span><span class="p">)</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7"></a>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="c1">// Create Agent with intelligent filter support</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="nx">llmAgent</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="w">    </span><span class="s">&quot;knowledge-assistant&quot;</span><span class="p">,</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithModel</span><span class="p">(</span><span class="nx">modelInstance</span><span class="p">),</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithKnowledge</span><span class="p">(</span><span class="nx">kb</span><span class="p">),</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithEnableKnowledgeAgenticFilter</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span><span class="w">           </span><span class="c1">// Enable intelligent filters</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithKnowledgeAgenticFilterInfo</span><span class="p">(</span><span class="nx">sourcesMetadata</span><span class="p">),</span><span class="w"> </span><span class="c1">// Provide available filter information</span>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="filter-layers">Filter Layers</h4>
<p>The Knowledge system supports multi-layer filters, all implemented using FilterCondition and combined with <strong>AND logic</strong>. The system does not distinguish priority; all layer filters are merged equally.</p>
<p><strong>Filter Layers</strong>:</p>
<ol>
<li>
<p><strong>Agent-level Filters</strong>:</p>
<ul>
<li>Metadata filters set via <code>llmagent.WithKnowledgeFilter()</code></li>
<li>Complex condition filters set via <code>llmagent.WithKnowledgeConditionedFilter()</code></li>
</ul>
</li>
<li>
<p><strong>Tool-level Filters</strong>:</p>
<ul>
<li>Metadata filters set via <code>tool.WithFilter()</code></li>
<li>Complex condition filters set via <code>tool.WithConditionedFilter()</code></li>
<li>Note: Agent-level filters are actually implemented through Tool-level filters</li>
</ul>
</li>
<li>
<p><strong>Runner-level Filters</strong>:</p>
<ul>
<li>Metadata filters passed via <code>agent.WithKnowledgeFilter()</code> in <code>runner.Run()</code></li>
<li>Complex condition filters passed via <code>agent.WithKnowledgeConditionedFilter()</code> in <code>runner.Run()</code></li>
</ul>
</li>
<li>
<p><strong>LLM Intelligent Filters</strong>:</p>
<ul>
<li>Filters dynamically generated by LLM based on user queries (complex condition filters only)</li>
</ul>
</li>
</ol>
<blockquote>
<p><strong>Important Notes</strong>:
- All filters are combined with <strong>AND logic</strong>, meaning documents must satisfy all filter conditions at all levels
- There is no priority override relationship; all filters are equal constraints
- Each level supports both metadata filters and complex condition filters (except LLM, which only supports complex conditions)</p>
</blockquote>
<h5 id="example-filter-combination">Example: Filter Combination</h5>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-27-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-27-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-27-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-27-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-27-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-27-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-27-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-27-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-27-10">10</a></span>
<span class="normal"><a href="#__codelineno-27-11">11</a></span>
<span class="normal"><a href="#__codelineno-27-12">12</a></span>
<span class="normal"><a href="#__codelineno-27-13">13</a></span>
<span class="normal"><a href="#__codelineno-27-14">14</a></span>
<span class="normal"><a href="#__codelineno-27-15">15</a></span>
<span class="normal"><a href="#__codelineno-27-16">16</a></span>
<span class="normal"><a href="#__codelineno-27-17">17</a></span>
<span class="normal"><a href="#__codelineno-27-18">18</a></span>
<span class="normal"><a href="#__codelineno-27-19">19</a></span>
<span class="normal"><a href="#__codelineno-27-20">20</a></span>
<span class="normal"><a href="#__codelineno-27-21">21</a></span>
<span class="normal"><a href="#__codelineno-27-22">22</a></span>
<span class="normal"><a href="#__codelineno-27-23">23</a></span>
<span class="normal"><a href="#__codelineno-27-24">24</a></span>
<span class="normal"><a href="#__codelineno-27-25">25</a></span>
<span class="normal"><a href="#__codelineno-27-26">26</a></span>
<span class="normal"><a href="#__codelineno-27-27">27</a></span>
<span class="normal"><a href="#__codelineno-27-28">28</a></span>
<span class="normal"><a href="#__codelineno-27-29">29</a></span>
<span class="normal"><a href="#__codelineno-27-30">30</a></span>
<span class="normal"><a href="#__codelineno-27-31">31</a></span>
<span class="normal"><a href="#__codelineno-27-32">32</a></span>
<span class="normal"><a href="#__codelineno-27-33">33</a></span>
<span class="normal"><a href="#__codelineno-27-34">34</a></span>
<span class="normal"><a href="#__codelineno-27-35">35</a></span>
<span class="normal"><a href="#__codelineno-27-36">36</a></span>
<span class="normal"><a href="#__codelineno-27-37">37</a></span>
<span class="normal"><a href="#__codelineno-27-38">38</a></span>
<span class="normal"><a href="#__codelineno-27-39">39</a></span>
<span class="normal"><a href="#__codelineno-27-40">40</a></span>
<span class="normal"><a href="#__codelineno-27-41">41</a></span>
<span class="normal"><a href="#__codelineno-27-42">42</a></span>
<span class="normal"><a href="#__codelineno-27-43">43</a></span>
<span class="normal"><a href="#__codelineno-27-44">44</a></span>
<span class="normal"><a href="#__codelineno-27-45">45</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/searchfilter&quot;</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2"></a>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="c1">// 1. Agent-level filters</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="nx">llmAgent</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="w">    </span><span class="s">&quot;knowledge-assistant&quot;</span><span class="p">,</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithModel</span><span class="p">(</span><span class="nx">modelInstance</span><span class="p">),</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithKnowledge</span><span class="p">(</span><span class="nx">kb</span><span class="p">),</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="w">    </span><span class="c1">// Agent-level metadata filter</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithKnowledgeFilter</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10"></a><span class="w">        </span><span class="s">&quot;metadata.source&quot;</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;official&quot;</span><span class="p">,</span><span class="w">      </span><span class="c1">// Official source</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11"></a><span class="w">        </span><span class="s">&quot;metadata.category&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;documentation&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Documentation category</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12"></a><span class="w">    </span><span class="p">}),</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13"></a><span class="w">    </span><span class="c1">// Agent-level complex condition filter (metadata fields use metadata. prefix)</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithKnowledgeConditionedFilter</span><span class="p">(</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15"></a><span class="w">        </span><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="s">&quot;metadata.status&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;published&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// Published status</span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16"></a><span class="w">    </span><span class="p">),</span>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17"></a><span class="p">)</span>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18"></a>
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19"></a><span class="c1">// 2. Runner-level filters</span>
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20"></a><span class="nx">eventCh</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">runner</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span>
</span><span id="__span-27-21"><a id="__codelineno-27-21" name="__codelineno-27-21"></a><span class="w">    </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">,</span><span class="w"> </span><span class="nx">sessionID</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span>
</span><span id="__span-27-22"><a id="__codelineno-27-22" name="__codelineno-27-22"></a><span class="w">    </span><span class="c1">// Runner-level metadata filter</span>
</span><span id="__span-27-23"><a id="__codelineno-27-23" name="__codelineno-27-23"></a><span class="w">    </span><span class="nx">agent</span><span class="p">.</span><span class="nx">WithKnowledgeFilter</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
</span><span id="__span-27-24"><a id="__codelineno-27-24" name="__codelineno-27-24"></a><span class="w">        </span><span class="s">&quot;metadata.region&quot;</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;china&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1">// China region</span>
</span><span id="__span-27-25"><a id="__codelineno-27-25" name="__codelineno-27-25"></a><span class="w">        </span><span class="s">&quot;metadata.language&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;zh&quot;</span><span class="p">,</span><span class="w">     </span><span class="c1">// Chinese language</span>
</span><span id="__span-27-26"><a id="__codelineno-27-26" name="__codelineno-27-26"></a><span class="w">    </span><span class="p">}),</span>
</span><span id="__span-27-27"><a id="__codelineno-27-27" name="__codelineno-27-27"></a><span class="w">    </span><span class="c1">// Runner-level complex condition filter</span>
</span><span id="__span-27-28"><a id="__codelineno-27-28" name="__codelineno-27-28"></a><span class="w">    </span><span class="nx">agent</span><span class="p">.</span><span class="nx">WithKnowledgeConditionedFilter</span><span class="p">(</span>
</span><span id="__span-27-29"><a id="__codelineno-27-29" name="__codelineno-27-29"></a><span class="w">        </span><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">GreaterThan</span><span class="p">(</span><span class="s">&quot;metadata.priority&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="c1">// Priority greater than 5</span>
</span><span id="__span-27-30"><a id="__codelineno-27-30" name="__codelineno-27-30"></a><span class="w">    </span><span class="p">),</span>
</span><span id="__span-27-31"><a id="__codelineno-27-31" name="__codelineno-27-31"></a><span class="p">)</span>
</span><span id="__span-27-32"><a id="__codelineno-27-32" name="__codelineno-27-32"></a>
</span><span id="__span-27-33"><a id="__codelineno-27-33" name="__codelineno-27-33"></a><span class="c1">// 3. LLM intelligent filter (dynamically generated by LLM)</span>
</span><span id="__span-27-34"><a id="__codelineno-27-34" name="__codelineno-27-34"></a><span class="c1">// Example: User asks &quot;find API related docs&quot;, LLM might generate {&quot;field&quot;: &quot;metadata.topic&quot;, &quot;value&quot;: &quot;api&quot;}</span>
</span><span id="__span-27-35"><a id="__codelineno-27-35" name="__codelineno-27-35"></a>
</span><span id="__span-27-36"><a id="__codelineno-27-36" name="__codelineno-27-36"></a><span class="c1">// Final effective filter conditions (all combined with AND):</span>
</span><span id="__span-27-37"><a id="__codelineno-27-37" name="__codelineno-27-37"></a><span class="c1">// metadata.source = &quot;official&quot; AND </span>
</span><span id="__span-27-38"><a id="__codelineno-27-38" name="__codelineno-27-38"></a><span class="c1">// metadata.category = &quot;documentation&quot; AND </span>
</span><span id="__span-27-39"><a id="__codelineno-27-39" name="__codelineno-27-39"></a><span class="c1">// metadata.status = &quot;published&quot; AND</span>
</span><span id="__span-27-40"><a id="__codelineno-27-40" name="__codelineno-27-40"></a><span class="c1">// metadata.region = &quot;china&quot; AND </span>
</span><span id="__span-27-41"><a id="__codelineno-27-41" name="__codelineno-27-41"></a><span class="c1">// metadata.language = &quot;zh&quot; AND </span>
</span><span id="__span-27-42"><a id="__codelineno-27-42" name="__codelineno-27-42"></a><span class="c1">// metadata.priority &gt; 5 AND</span>
</span><span id="__span-27-43"><a id="__codelineno-27-43" name="__codelineno-27-43"></a><span class="c1">// metadata.topic = &quot;api&quot;</span>
</span><span id="__span-27-44"><a id="__codelineno-27-44" name="__codelineno-27-44"></a><span class="c1">//</span>
</span><span id="__span-27-45"><a id="__codelineno-27-45" name="__codelineno-27-45"></a><span class="c1">// i.e., must satisfy all conditions at all levels</span>
</span></code></pre></div></td></tr></table></div>
<h5 id="complex-condition-filter-example">Complex Condition Filter Example</h5>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-28-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-28-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-28-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-28-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-28-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-28-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-28-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-28-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-28-10">10</a></span>
<span class="normal"><a href="#__codelineno-28-11">11</a></span>
<span class="normal"><a href="#__codelineno-28-12">12</a></span>
<span class="normal"><a href="#__codelineno-28-13">13</a></span>
<span class="normal"><a href="#__codelineno-28-14">14</a></span>
<span class="normal"><a href="#__codelineno-28-15">15</a></span>
<span class="normal"><a href="#__codelineno-28-16">16</a></span>
<span class="normal"><a href="#__codelineno-28-17">17</a></span>
<span class="normal"><a href="#__codelineno-28-18">18</a></span>
<span class="normal"><a href="#__codelineno-28-19">19</a></span>
<span class="normal"><a href="#__codelineno-28-20">20</a></span>
<span class="normal"><a href="#__codelineno-28-21">21</a></span>
<span class="normal"><a href="#__codelineno-28-22">22</a></span>
<span class="normal"><a href="#__codelineno-28-23">23</a></span>
<span class="normal"><a href="#__codelineno-28-24">24</a></span>
<span class="normal"><a href="#__codelineno-28-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="c1">// Manually create Tool with complex condition filters</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="nx">searchTool</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tool</span><span class="p">.</span><span class="nx">NewKnowledgeSearchTool</span><span class="p">(</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="w">    </span><span class="nx">kb</span><span class="p">,</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="w">    </span><span class="c1">// Agent-level metadata filter</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="w">    </span><span class="nx">tool</span><span class="p">.</span><span class="nx">WithFilter</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="w">        </span><span class="s">&quot;metadata.source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;official&quot;</span><span class="p">,</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="w">    </span><span class="p">}),</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="w">    </span><span class="c1">// Agent-level complex condition filter (metadata fields use metadata. prefix)</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9"></a><span class="w">    </span><span class="nx">tool</span><span class="p">.</span><span class="nx">WithConditionedFilter</span><span class="p">(</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10"></a><span class="w">        </span><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">Or</span><span class="p">(</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11"></a><span class="w">            </span><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="s">&quot;metadata.topic&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;programming&quot;</span><span class="p">),</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12"></a><span class="w">            </span><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="s">&quot;metadata.topic&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;llm&quot;</span><span class="p">),</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13"></a><span class="w">        </span><span class="p">),</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14"></a><span class="w">    </span><span class="p">),</span>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15"></a><span class="p">)</span>
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16"></a>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17"></a><span class="nx">llmAgent</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18"></a><span class="w">    </span><span class="s">&quot;knowledge-assistant&quot;</span><span class="p">,</span>
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithModel</span><span class="p">(</span><span class="nx">modelInstance</span><span class="p">),</span>
</span><span id="__span-28-20"><a id="__codelineno-28-20" name="__codelineno-28-20"></a><span class="w">    </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithTools</span><span class="p">(</span><span class="nx">searchTool</span><span class="p">),</span><span class="w">  </span><span class="c1">// Manually pass Tool</span>
</span><span id="__span-28-21"><a id="__codelineno-28-21" name="__codelineno-28-21"></a><span class="p">)</span>
</span><span id="__span-28-22"><a id="__codelineno-28-22" name="__codelineno-28-22"></a>
</span><span id="__span-28-23"><a id="__codelineno-28-23" name="__codelineno-28-23"></a><span class="c1">// Final filter conditions:</span>
</span><span id="__span-28-24"><a id="__codelineno-28-24" name="__codelineno-28-24"></a><span class="c1">// metadata.source = &quot;official&quot; AND (metadata.topic = &quot;programming&quot; OR metadata.topic = &quot;llm&quot;)</span>
</span><span id="__span-28-25"><a id="__codelineno-28-25" name="__codelineno-28-25"></a><span class="c1">// i.e., must be official source AND topic is either programming or LLM</span>
</span></code></pre></div></td></tr></table></div>
<h5 id="common-filter-helper-functions">Common Filter Helper Functions</h5>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-29-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-29-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-29-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-29-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-29-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-29-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-29-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-29-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-29-10">10</a></span>
<span class="normal"><a href="#__codelineno-29-11">11</a></span>
<span class="normal"><a href="#__codelineno-29-12">12</a></span>
<span class="normal"><a href="#__codelineno-29-13">13</a></span>
<span class="normal"><a href="#__codelineno-29-14">14</a></span>
<span class="normal"><a href="#__codelineno-29-15">15</a></span>
<span class="normal"><a href="#__codelineno-29-16">16</a></span>
<span class="normal"><a href="#__codelineno-29-17">17</a></span>
<span class="normal"><a href="#__codelineno-29-18">18</a></span>
<span class="normal"><a href="#__codelineno-29-19">19</a></span>
<span class="normal"><a href="#__codelineno-29-20">20</a></span>
<span class="normal"><a href="#__codelineno-29-21">21</a></span>
<span class="normal"><a href="#__codelineno-29-22">22</a></span>
<span class="normal"><a href="#__codelineno-29-23">23</a></span>
<span class="normal"><a href="#__codelineno-29-24">24</a></span>
<span class="normal"><a href="#__codelineno-29-25">25</a></span>
<span class="normal"><a href="#__codelineno-29-26">26</a></span>
<span class="normal"><a href="#__codelineno-29-27">27</a></span>
<span class="normal"><a href="#__codelineno-29-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="c1">// Comparison operators (Note: metadata fields need metadata. prefix)</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="s">&quot;metadata.topic&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w">              </span><span class="c1">// metadata.topic = value</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">NotEqual</span><span class="p">(</span><span class="s">&quot;metadata.status&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w">          </span><span class="c1">// metadata.status != value</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">GreaterThan</span><span class="p">(</span><span class="s">&quot;metadata.priority&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w">     </span><span class="c1">// metadata.priority &gt; value</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">GreaterThanOrEqual</span><span class="p">(</span><span class="s">&quot;metadata.score&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="c1">// metadata.score &gt;= value</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">LessThan</span><span class="p">(</span><span class="s">&quot;metadata.age&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w">             </span><span class="c1">// metadata.age &lt; value</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">LessThanOrEqual</span><span class="p">(</span><span class="s">&quot;metadata.level&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span><span class="w">    </span><span class="c1">// metadata.level &lt;= value</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8"></a><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">In</span><span class="p">(</span><span class="s">&quot;metadata.category&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="o">...</span><span class="p">)</span><span class="w">          </span><span class="c1">// metadata.category IN (...)</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">NotIn</span><span class="p">(</span><span class="s">&quot;metadata.type&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="o">...</span><span class="p">)</span><span class="w">           </span><span class="c1">// metadata.type NOT IN (...)</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">Like</span><span class="p">(</span><span class="s">&quot;metadata.title&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">pattern</span><span class="p">)</span><span class="w">             </span><span class="c1">// metadata.title LIKE pattern</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11"></a><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">Between</span><span class="p">(</span><span class="s">&quot;metadata.date&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">min</span><span class="p">,</span><span class="w"> </span><span class="nx">max</span><span class="p">)</span><span class="w">          </span><span class="c1">// metadata.date BETWEEN min AND max</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12"></a>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13"></a><span class="c1">// Custom table columns (added via WithDocBuilder) don&#39;t need prefix</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14"></a><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">NotEqual</span><span class="p">(</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;deleted&quot;</span><span class="p">)</span><span class="w">               </span><span class="c1">// status != &quot;deleted&quot;</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15"></a><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">GreaterThanOrEqual</span><span class="p">(</span><span class="s">&quot;priority&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w">           </span><span class="c1">// priority &gt;= 3</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16"></a>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17"></a><span class="c1">// Logical operators</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18"></a><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">And</span><span class="p">(</span><span class="nx">conditions</span><span class="o">...</span><span class="p">)</span><span class="w">               </span><span class="c1">// AND combination</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19"></a><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">Or</span><span class="p">(</span><span class="nx">conditions</span><span class="o">...</span><span class="p">)</span><span class="w">                </span><span class="c1">// OR combination</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20"></a>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21"></a><span class="c1">// Nested example: (metadata.status = &#39;published&#39;) AND (metadata.category = &#39;doc&#39; OR metadata.category = &#39;tutorial&#39;)</span>
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22"></a><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">And</span><span class="p">(</span>
</span><span id="__span-29-23"><a id="__codelineno-29-23" name="__codelineno-29-23"></a><span class="w">    </span><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="s">&quot;metadata.status&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;published&quot;</span><span class="p">),</span>
</span><span id="__span-29-24"><a id="__codelineno-29-24" name="__codelineno-29-24"></a><span class="w">    </span><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">Or</span><span class="p">(</span>
</span><span id="__span-29-25"><a id="__codelineno-29-25" name="__codelineno-29-25"></a><span class="w">        </span><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="s">&quot;metadata.category&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;documentation&quot;</span><span class="p">),</span>
</span><span id="__span-29-26"><a id="__codelineno-29-26" name="__codelineno-29-26"></a><span class="w">        </span><span class="nx">searchfilter</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="s">&quot;metadata.category&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;tutorial&quot;</span><span class="p">),</span>
</span><span id="__span-29-27"><a id="__codelineno-29-27" name="__codelineno-29-27"></a><span class="w">    </span><span class="p">),</span>
</span><span id="__span-29-28"><a id="__codelineno-29-28" name="__codelineno-29-28"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="metadata-configuration">Metadata Configuration</h3>
<p>To make intelligent filters work properly, you need to add rich metadata when creating document sources:</p>
<h4 id="metadata-acquisition">Metadata Acquisition</h4>
<p>The Knowledge system provides utility functions to collect metadata information from sources:</p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span>
<span class="normal"><a href="#__codelineno-30-3">3</a></span>
<span class="normal"><a href="#__codelineno-30-4">4</a></span>
<span class="normal"><a href="#__codelineno-30-5">5</a></span>
<span class="normal"><a href="#__codelineno-30-6">6</a></span>
<span class="normal"><a href="#__codelineno-30-7">7</a></span>
<span class="normal"><a href="#__codelineno-30-8">8</a></span>
<span class="normal"><a href="#__codelineno-30-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/source&quot;</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2"></a>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="c1">// Get all metadata key-value pairs from all sources</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="c1">// Returns map[string][]any containing all possible metadata values</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="nx">sourcesMetadata</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">source</span><span class="p">.</span><span class="nx">GetAllMetadata</span><span class="p">(</span><span class="nx">sources</span><span class="p">)</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6"></a>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="c1">// Get all metadata keys from all sources</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8"></a><span class="c1">// Returns []string containing all metadata field names</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9"></a><span class="nx">metadataKeys</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">source</span><span class="p">.</span><span class="nx">GetAllMetadataKeys</span><span class="p">(</span><span class="nx">sources</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="source-metadata-configuration">Source Metadata Configuration</h4>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-31-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-31-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-31-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-31-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-31-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-31-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-31-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-31-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-31-10">10</a></span>
<span class="normal"><a href="#__codelineno-31-11">11</a></span>
<span class="normal"><a href="#__codelineno-31-12">12</a></span>
<span class="normal"><a href="#__codelineno-31-13">13</a></span>
<span class="normal"><a href="#__codelineno-31-14">14</a></span>
<span class="normal"><a href="#__codelineno-31-15">15</a></span>
<span class="normal"><a href="#__codelineno-31-16">16</a></span>
<span class="normal"><a href="#__codelineno-31-17">17</a></span>
<span class="normal"><a href="#__codelineno-31-18">18</a></span>
<span class="normal"><a href="#__codelineno-31-19">19</a></span>
<span class="normal"><a href="#__codelineno-31-20">20</a></span>
<span class="normal"><a href="#__codelineno-31-21">21</a></span>
<span class="normal"><a href="#__codelineno-31-22">22</a></span>
<span class="normal"><a href="#__codelineno-31-23">23</a></span>
<span class="normal"><a href="#__codelineno-31-24">24</a></span>
<span class="normal"><a href="#__codelineno-31-25">25</a></span>
<span class="normal"><a href="#__codelineno-31-26">26</a></span>
<span class="normal"><a href="#__codelineno-31-27">27</a></span>
<span class="normal"><a href="#__codelineno-31-28">28</a></span>
<span class="normal"><a href="#__codelineno-31-29">29</a></span>
<span class="normal"><a href="#__codelineno-31-30">30</a></span>
<span class="normal"><a href="#__codelineno-31-31">31</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="nx">sources</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">source</span><span class="p">.</span><span class="nx">Source</span><span class="p">{</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="w">    </span><span class="c1">// File source metadata configuration</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="w">    </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="w">        </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;./docs/api.md&quot;</span><span class="p">},</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="w">        </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">WithName</span><span class="p">(</span><span class="s">&quot;API Documentation&quot;</span><span class="p">),</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="w">        </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;category&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;documentation&quot;</span><span class="p">),</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="w">        </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;topic&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;api&quot;</span><span class="p">),</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="w">        </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;service_type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;gateway&quot;</span><span class="p">),</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9"></a><span class="w">        </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;protocol&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;trpc-go&quot;</span><span class="p">),</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10"></a><span class="w">        </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;version&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;v1.0&quot;</span><span class="p">),</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11"></a><span class="w">    </span><span class="p">),</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12"></a>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13"></a><span class="w">    </span><span class="c1">// Directory source metadata configuration</span>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14"></a><span class="w">    </span><span class="nx">dirsource</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15"></a><span class="w">        </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;./tutorials&quot;</span><span class="p">},</span>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16"></a><span class="w">        </span><span class="nx">dirsource</span><span class="p">.</span><span class="nx">WithName</span><span class="p">(</span><span class="s">&quot;Tutorials&quot;</span><span class="p">),</span>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17"></a><span class="w">        </span><span class="nx">dirsource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;category&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;tutorial&quot;</span><span class="p">),</span>
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18"></a><span class="w">        </span><span class="nx">dirsource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;difficulty&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;beginner&quot;</span><span class="p">),</span>
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19"></a><span class="w">        </span><span class="nx">dirsource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;topic&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;programming&quot;</span><span class="p">),</span>
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20"></a><span class="w">    </span><span class="p">),</span>
</span><span id="__span-31-21"><a id="__codelineno-31-21" name="__codelineno-31-21"></a>
</span><span id="__span-31-22"><a id="__codelineno-31-22" name="__codelineno-31-22"></a><span class="w">    </span><span class="c1">// URL source metadata configuration</span>
</span><span id="__span-31-23"><a id="__codelineno-31-23" name="__codelineno-31-23"></a><span class="w">    </span><span class="nx">urlsource</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-31-24"><a id="__codelineno-31-24" name="__codelineno-31-24"></a><span class="w">        </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;https://example.com/wiki/rpc&quot;</span><span class="p">},</span>
</span><span id="__span-31-25"><a id="__codelineno-31-25" name="__codelineno-31-25"></a><span class="w">        </span><span class="nx">urlsource</span><span class="p">.</span><span class="nx">WithName</span><span class="p">(</span><span class="s">&quot;RPC Wiki&quot;</span><span class="p">),</span>
</span><span id="__span-31-26"><a id="__codelineno-31-26" name="__codelineno-31-26"></a><span class="w">        </span><span class="nx">urlsource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;category&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;encyclopedia&quot;</span><span class="p">),</span>
</span><span id="__span-31-27"><a id="__codelineno-31-27" name="__codelineno-31-27"></a><span class="w">        </span><span class="nx">urlsource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;source_type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;web&quot;</span><span class="p">),</span>
</span><span id="__span-31-28"><a id="__codelineno-31-28" name="__codelineno-31-28"></a><span class="w">        </span><span class="nx">urlsource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;topic&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;rpc&quot;</span><span class="p">),</span>
</span><span id="__span-31-29"><a id="__codelineno-31-29" name="__codelineno-31-29"></a><span class="w">        </span><span class="nx">urlsource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;language&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;zh&quot;</span><span class="p">),</span>
</span><span id="__span-31-30"><a id="__codelineno-31-30" name="__codelineno-31-30"></a><span class="w">    </span><span class="p">),</span>
</span><span id="__span-31-31"><a id="__codelineno-31-31" name="__codelineno-31-31"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="vector-database-filter-support">Vector Database Filter Support</h3>
<p>Different vector databases have varying levels of filter support:</p>
<h4 id="postgresql-pgvector">PostgreSQL + pgvector</h4>
<ul>
<li>✅ Supports all metadata field filtering</li>
<li>✅ Supports complex query conditions</li>
<li>✅ Supports JSONB field indexing</li>
</ul>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span>
<span class="normal"><a href="#__codelineno-32-2">2</a></span>
<span class="normal"><a href="#__codelineno-32-3">3</a></span>
<span class="normal"><a href="#__codelineno-32-4">4</a></span>
<span class="normal"><a href="#__codelineno-32-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="nx">vectorStore</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vectorpgvector</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="w">    </span><span class="nx">vectorpgvector</span><span class="p">.</span><span class="nx">WithHost</span><span class="p">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">),</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="w">    </span><span class="nx">vectorpgvector</span><span class="p">.</span><span class="nx">WithPort</span><span class="p">(</span><span class="mi">5432</span><span class="p">),</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="w">    </span><span class="c1">// ... other configurations</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="tcvector">TcVector</h4>
<ul>
<li>✅ Supports all metadata filtering</li>
<li>✅ v0.4.0+ new collections automatically support JSON index (requires TCVector service support)</li>
<li>⚡ Optional: Use <code>WithFilterIndexFields</code> to build additional indexes for frequently queried fields</li>
</ul>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-33-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-33-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-33-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-33-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-33-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-33-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-33-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-33-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-33-10">10</a></span>
<span class="normal"><a href="#__codelineno-33-11">11</a></span>
<span class="normal"><a href="#__codelineno-33-12">12</a></span>
<span class="normal"><a href="#__codelineno-33-13">13</a></span>
<span class="normal"><a href="#__codelineno-33-14">14</a></span>
<span class="normal"><a href="#__codelineno-33-15">15</a></span>
<span class="normal"><a href="#__codelineno-33-16">16</a></span>
<span class="normal"><a href="#__codelineno-33-17">17</a></span>
<span class="normal"><a href="#__codelineno-33-18">18</a></span>
<span class="normal"><a href="#__codelineno-33-19">19</a></span>
<span class="normal"><a href="#__codelineno-33-20">20</a></span>
<span class="normal"><a href="#__codelineno-33-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="c1">// v0.4.0+ new collections (TCVector service supports JSON index)</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="nx">vectorStore</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="w">    </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">WithURL</span><span class="p">(</span><span class="s">&quot;https://your-endpoint&quot;</span><span class="p">),</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="w">    </span><span class="c1">// ... other configurations</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="p">)</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="c1">// All metadata fields are queryable via JSON index, no need to predefine</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7"></a>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="c1">// Optional: Build additional indexes for high-frequency fields to optimize performance</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="nx">metadataKeys</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">source</span><span class="p">.</span><span class="nx">GetAllMetadataKeys</span><span class="p">(</span><span class="nx">sources</span><span class="p">)</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10"></a><span class="nx">vectorStore</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11"></a><span class="w">    </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">WithURL</span><span class="p">(</span><span class="s">&quot;https://your-endpoint&quot;</span><span class="p">),</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12"></a><span class="w">    </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">WithFilterIndexFields</span><span class="p">(</span><span class="nx">metadataKeys</span><span class="p">),</span><span class="w"> </span><span class="c1">// Optional: build additional indexes</span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13"></a><span class="w">    </span><span class="c1">// ... other configurations</span>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14"></a><span class="p">)</span>
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15"></a>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16"></a><span class="c1">// Collections before v0.4.0 or TCVector service without JSON index support</span>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17"></a><span class="nx">vectorStore</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18"></a><span class="w">    </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">WithURL</span><span class="p">(</span><span class="s">&quot;https://your-endpoint&quot;</span><span class="p">),</span>
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19"></a><span class="w">    </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">WithFilterIndexFields</span><span class="p">(</span><span class="nx">metadataKeys</span><span class="p">),</span><span class="w"> </span><span class="c1">// Required: predefine filter fields</span>
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20"></a><span class="w">    </span><span class="c1">// ... other configurations</span>
</span><span id="__span-33-21"><a id="__codelineno-33-21" name="__codelineno-33-21"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p><strong>Notes:</strong>
- <strong>v0.4.0+ new collections</strong>: Automatically create metadata JSON index, all fields queryable
- <strong>Legacy collections</strong>: Only fields in <code>WithFilterIndexFields</code> are queryable</p>
<h4 id="qdrant_1">Qdrant</h4>
<ul>
<li>✅ Supports all metadata field filtering</li>
<li>✅ Supports complex query conditions (AND, OR, comparison operators)</li>
<li>✅ Supports IN, NOT IN, LIKE, BETWEEN operators</li>
<li>✅ Automatic retry for transient errors</li>
</ul>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span>
<span class="normal"><a href="#__codelineno-34-2">2</a></span>
<span class="normal"><a href="#__codelineno-34-3">3</a></span>
<span class="normal"><a href="#__codelineno-34-4">4</a></span>
<span class="normal"><a href="#__codelineno-34-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="nx">vectorStore</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithHost</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">),</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithPort</span><span class="p">(</span><span class="mi">6334</span><span class="p">),</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="w">    </span><span class="c1">// ... other configurations</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="in-memory-storage">In-memory Storage</h4>
<ul>
<li>✅ Supports all filter functionality</li>
<li>⚠️ Only suitable for development and testing</li>
</ul>
<h3 id="knowledge-base-management-functionality">Knowledge Base Management Functionality</h3>
<blockquote>
<p>📁 <strong>Example Code</strong>: <a href="https://github.com/trpc-group/trpc-agent-go/tree/main/examples/knowledge/features/management">examples/knowledge/features/management</a></p>
</blockquote>
<p>The Knowledge system provides powerful knowledge base management functionality, supporting dynamic source management and intelligent synchronization mechanisms.</p>
<h4 id="enable-source-sync-enablesourcesync">Enable Source Sync (enableSourceSync)</h4>
<p>By enabling <code>enableSourceSync</code>, the knowledge base will always keep vector storage data consistent with configured sources. If you're not using custom methods to manage the knowledge base, it's recommended to enable this option:</p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span>
<span class="normal"><a href="#__codelineno-35-2">2</a></span>
<span class="normal"><a href="#__codelineno-35-3">3</a></span>
<span class="normal"><a href="#__codelineno-35-4">4</a></span>
<span class="normal"><a href="#__codelineno-35-5">5</a></span>
<span class="normal"><a href="#__codelineno-35-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="nx">kb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithEmbedder</span><span class="p">(</span><span class="nx">embedder</span><span class="p">),</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithVectorStore</span><span class="p">(</span><span class="nx">vectorStore</span><span class="p">),</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithSources</span><span class="p">(</span><span class="nx">sources</span><span class="p">),</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithEnableSourceSync</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span><span class="w"> </span><span class="c1">// Enable incremental sync</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p><strong>How the synchronization mechanism works</strong>:</p>
<ol>
<li><strong>Pre-loading preparation</strong>: Refresh document information cache, establish synchronization state tracking</li>
<li><strong>Process tracking</strong>: Record processed documents to avoid duplicate processing</li>
<li><strong>Post-loading cleanup</strong>: Automatically clean up orphaned documents that no longer exist</li>
</ol>
<p><strong>Advantages of enabling synchronization</strong>:</p>
<ul>
<li><strong>Data consistency</strong>: Ensure vector storage is completely synchronized with source configuration</li>
<li><strong>Incremental updates</strong>: Only process changed documents, improving performance</li>
<li><strong>Orphan cleanup</strong>: Automatically delete documents from removed sources</li>
<li><strong>State tracking</strong>: Real-time monitoring of synchronization status and processing progress</li>
</ul>
<h4 id="dynamic-source-management">Dynamic Source Management</h4>
<p>Knowledge supports runtime dynamic management of knowledge sources, ensuring data in vector storage always stays consistent with user-configured sources:</p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-36-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-36-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-36-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span>
<span class="normal"><a href="#__codelineno-36-11">11</a></span>
<span class="normal"><a href="#__codelineno-36-12">12</a></span>
<span class="normal"><a href="#__codelineno-36-13">13</a></span>
<span class="normal"><a href="#__codelineno-36-14">14</a></span>
<span class="normal"><a href="#__codelineno-36-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="c1">// Add new knowledge source - data will stay consistent with configured sources</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="nx">newSource</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">New</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;./new-docs/api.md&quot;</span><span class="p">})</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">kb</span><span class="p">.</span><span class="nx">AddSource</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">newSource</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Failed to add source: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="p">}</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6"></a>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="c1">// Reload specified knowledge source - automatically detect changes and sync</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">kb</span><span class="p">.</span><span class="nx">ReloadSource</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">newSource</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Failed to reload source: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="p">}</span>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11"></a>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12"></a><span class="c1">// Remove specified knowledge source - precisely delete related documents</span>
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">kb</span><span class="p">.</span><span class="nx">RemoveSource</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;API Documentation&quot;</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Failed to remove source: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p><strong>Core features of dynamic management</strong>:</p>
<ul>
<li><strong>Data consistency guarantee</strong>: Vector storage data always stays consistent with user-configured sources</li>
<li><strong>Intelligent incremental sync</strong>: Only process changed documents, avoiding duplicate processing</li>
<li><strong>Precise source control</strong>: Support precise addition/removal/reload by source name</li>
<li><strong>Orphan document cleanup</strong>: Automatically clean up documents that no longer belong to any configured source</li>
<li><strong>Hot update support</strong>: Update knowledge base without restarting the application</li>
</ul>
<h4 id="knowledge-base-status-monitoring">Knowledge Base Status Monitoring</h4>
<p>Knowledge provides rich status monitoring functionality to help users understand the synchronization status of currently configured sources:</p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-37-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-37-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-37-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-37-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-37-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-37-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-37-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-37-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-37-10">10</a></span>
<span class="normal"><a href="#__codelineno-37-11">11</a></span>
<span class="normal"><a href="#__codelineno-37-12">12</a></span>
<span class="normal"><a href="#__codelineno-37-13">13</a></span>
<span class="normal"><a href="#__codelineno-37-14">14</a></span>
<span class="normal"><a href="#__codelineno-37-15">15</a></span>
<span class="normal"><a href="#__codelineno-37-16">16</a></span>
<span class="normal"><a href="#__codelineno-37-17">17</a></span>
<span class="normal"><a href="#__codelineno-37-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="c1">// Show all document information</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="nx">docInfos</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">kb</span><span class="p">.</span><span class="nx">ShowDocumentInfo</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Failed to show document info: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="w">    </span><span class="k">return</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="p">}</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7"></a>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="c1">// Also supports querying specific sources or metadata</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9"></a><span class="c1">// docInfos, err := kb.ShowDocumentInfo(ctx, &quot;source_name_1&quot;, &quot;source_name_2&quot;)</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10"></a><span class="c1">// This will only return document metadata for the specified source names</span>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11"></a>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12"></a><span class="c1">// Iterate through document information</span>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">docInfo</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">docInfos</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Document ID: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">docInfo</span><span class="p">.</span><span class="nx">DocumentID</span><span class="p">)</span>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Source: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">docInfo</span><span class="p">.</span><span class="nx">SourceName</span><span class="p">)</span>
</span><span id="__span-37-16"><a id="__codelineno-37-16" name="__codelineno-37-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;URI: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">docInfo</span><span class="p">.</span><span class="nx">URI</span><span class="p">)</span>
</span><span id="__span-37-17"><a id="__codelineno-37-17" name="__codelineno-37-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Chunk Index: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">docInfo</span><span class="p">.</span><span class="nx">ChunkIndex</span><span class="p">)</span>
</span><span id="__span-37-18"><a id="__codelineno-37-18" name="__codelineno-37-18"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p><strong>Status monitoring output example</strong>:</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span>
<span class="normal"><a href="#__codelineno-38-2">2</a></span>
<span class="normal"><a href="#__codelineno-38-3">3</a></span>
<span class="normal"><a href="#__codelineno-38-4">4</a></span>
<span class="normal"><a href="#__codelineno-38-5">5</a></span>
<span class="normal"><a href="#__codelineno-38-6">6</a></span>
<span class="normal"><a href="#__codelineno-38-7">7</a></span>
<span class="normal"><a href="#__codelineno-38-8">8</a></span>
<span class="normal"><a href="#__codelineno-38-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1"></a>Document ID: a1b2c3d4e5f6...
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2"></a>Source: Technical Documentation
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3"></a>URI: /docs/api/authentication.md
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4"></a>Chunk Index: 0
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5"></a>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6"></a>Document ID: f6e5d4c3b2a1...
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7"></a>Source: Technical Documentation
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8"></a>URI: /docs/api/authentication.md
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9"></a>Chunk Index: 1
</span></code></pre></div></td></tr></table></div>
<h2 id="advanced-features">Advanced Features</h2>
<h3 id="queryenhancer">QueryEnhancer</h3>
<p>QueryEnhancer is used to preprocess and optimize user queries before searching. Currently, the framework only provides a default implementation:</p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">1</a></span>
<span class="normal"><a href="#__codelineno-39-2">2</a></span>
<span class="normal"><a href="#__codelineno-39-3">3</a></span>
<span class="normal"><a href="#__codelineno-39-4">4</a></span>
<span class="normal"><a href="#__codelineno-39-5">5</a></span>
<span class="normal"><a href="#__codelineno-39-6">6</a></span>
<span class="normal"><a href="#__codelineno-39-7">7</a></span>
<span class="normal"><a href="#__codelineno-39-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge&quot;</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/query&quot;</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="p">)</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5"></a>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6"></a><span class="nx">kb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithQueryEnhancer</span><span class="p">(</span><span class="nx">query</span><span class="p">.</span><span class="nx">NewPassthroughEnhancer</span><span class="p">()),</span><span class="w"> </span><span class="c1">// Default enhancer, returns query as-is.</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p><strong>Note</strong>: QueryEnhancer is not a required component. If not specified, Knowledge will directly use the original query for search. This option only needs to be configured when custom query preprocessing logic is required.</p>
</blockquote>
<h3 id="performance-optimization">Performance Optimization</h3>
<p>The Knowledge system provides various performance optimization strategies, including concurrent processing, vector storage optimization, and caching mechanisms:</p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1">1</a></span>
<span class="normal"><a href="#__codelineno-40-2">2</a></span>
<span class="normal"><a href="#__codelineno-40-3">3</a></span>
<span class="normal"><a href="#__codelineno-40-4">4</a></span>
<span class="normal"><a href="#__codelineno-40-5">5</a></span>
<span class="normal"><a href="#__codelineno-40-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="c1">// Adjust concurrency based on system resources.</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="nx">kb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithSources</span><span class="p">(</span><span class="nx">sources</span><span class="p">),</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithSourceConcurrency</span><span class="p">(</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">NumCPU</span><span class="p">()),</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithDocConcurrency</span><span class="p">(</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">NumCPU</span><span class="p">()</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h2 id="complete-example">Complete Example</h2>
<blockquote>
<p>📁 <strong>All Examples</strong>: <a href="https://github.com/trpc-group/trpc-agent-go/tree/main/examples/knowledge">examples/knowledge</a></p>
</blockquote>
<p>The following is a complete example showing how to create an Agent with Knowledge access capabilities:</p>
<div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1">  1</a></span>
<span class="normal"><a href="#__codelineno-41-2">  2</a></span>
<span class="normal"><a href="#__codelineno-41-3">  3</a></span>
<span class="normal"><a href="#__codelineno-41-4">  4</a></span>
<span class="normal"><a href="#__codelineno-41-5">  5</a></span>
<span class="normal"><a href="#__codelineno-41-6">  6</a></span>
<span class="normal"><a href="#__codelineno-41-7">  7</a></span>
<span class="normal"><a href="#__codelineno-41-8">  8</a></span>
<span class="normal"><a href="#__codelineno-41-9">  9</a></span>
<span class="normal"><a href="#__codelineno-41-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-41-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-41-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-41-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-41-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-41-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-41-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-41-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-41-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-41-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-41-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-41-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-41-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-41-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-41-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-41-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-41-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-41-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-41-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-41-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-41-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-41-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-41-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-41-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-41-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-41-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-41-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-41-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-41-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-41-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-41-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-41-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-41-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-41-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-41-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-41-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-41-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-41-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-41-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-41-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-41-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-41-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-41-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-41-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-41-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-41-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-41-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-41-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-41-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-41-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-41-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-41-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-41-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-41-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-41-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-41-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-41-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-41-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-41-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-41-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-41-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-41-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-41-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-41-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-41-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-41-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-41-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-41-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-41-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-41-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-41-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-41-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-41-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-41-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-41-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-41-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-41-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-41-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-41-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-41-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-41-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-41-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-41-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-41-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-41-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-41-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-41-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-41-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-41-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-41-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-41-100">100</a></span>
<span class="normal"><a href="#__codelineno-41-101">101</a></span>
<span class="normal"><a href="#__codelineno-41-102">102</a></span>
<span class="normal"><a href="#__codelineno-41-103">103</a></span>
<span class="normal"><a href="#__codelineno-41-104">104</a></span>
<span class="normal"><a href="#__codelineno-41-105">105</a></span>
<span class="normal"><a href="#__codelineno-41-106">106</a></span>
<span class="normal"><a href="#__codelineno-41-107">107</a></span>
<span class="normal"><a href="#__codelineno-41-108">108</a></span>
<span class="normal"><a href="#__codelineno-41-109">109</a></span>
<span class="normal"><a href="#__codelineno-41-110">110</a></span>
<span class="normal"><a href="#__codelineno-41-111">111</a></span>
<span class="normal"><a href="#__codelineno-41-112">112</a></span>
<span class="normal"><a href="#__codelineno-41-113">113</a></span>
<span class="normal"><a href="#__codelineno-41-114">114</a></span>
<span class="normal"><a href="#__codelineno-41-115">115</a></span>
<span class="normal"><a href="#__codelineno-41-116">116</a></span>
<span class="normal"><a href="#__codelineno-41-117">117</a></span>
<span class="normal"><a href="#__codelineno-41-118">118</a></span>
<span class="normal"><a href="#__codelineno-41-119">119</a></span>
<span class="normal"><a href="#__codelineno-41-120">120</a></span>
<span class="normal"><a href="#__codelineno-41-121">121</a></span>
<span class="normal"><a href="#__codelineno-41-122">122</a></span>
<span class="normal"><a href="#__codelineno-41-123">123</a></span>
<span class="normal"><a href="#__codelineno-41-124">124</a></span>
<span class="normal"><a href="#__codelineno-41-125">125</a></span>
<span class="normal"><a href="#__codelineno-41-126">126</a></span>
<span class="normal"><a href="#__codelineno-41-127">127</a></span>
<span class="normal"><a href="#__codelineno-41-128">128</a></span>
<span class="normal"><a href="#__codelineno-41-129">129</a></span>
<span class="normal"><a href="#__codelineno-41-130">130</a></span>
<span class="normal"><a href="#__codelineno-41-131">131</a></span>
<span class="normal"><a href="#__codelineno-41-132">132</a></span>
<span class="normal"><a href="#__codelineno-41-133">133</a></span>
<span class="normal"><a href="#__codelineno-41-134">134</a></span>
<span class="normal"><a href="#__codelineno-41-135">135</a></span>
<span class="normal"><a href="#__codelineno-41-136">136</a></span>
<span class="normal"><a href="#__codelineno-41-137">137</a></span>
<span class="normal"><a href="#__codelineno-41-138">138</a></span>
<span class="normal"><a href="#__codelineno-41-139">139</a></span>
<span class="normal"><a href="#__codelineno-41-140">140</a></span>
<span class="normal"><a href="#__codelineno-41-141">141</a></span>
<span class="normal"><a href="#__codelineno-41-142">142</a></span>
<span class="normal"><a href="#__codelineno-41-143">143</a></span>
<span class="normal"><a href="#__codelineno-41-144">144</a></span>
<span class="normal"><a href="#__codelineno-41-145">145</a></span>
<span class="normal"><a href="#__codelineno-41-146">146</a></span>
<span class="normal"><a href="#__codelineno-41-147">147</a></span>
<span class="normal"><a href="#__codelineno-41-148">148</a></span>
<span class="normal"><a href="#__codelineno-41-149">149</a></span>
<span class="normal"><a href="#__codelineno-41-150">150</a></span>
<span class="normal"><a href="#__codelineno-41-151">151</a></span>
<span class="normal"><a href="#__codelineno-41-152">152</a></span>
<span class="normal"><a href="#__codelineno-41-153">153</a></span>
<span class="normal"><a href="#__codelineno-41-154">154</a></span>
<span class="normal"><a href="#__codelineno-41-155">155</a></span>
<span class="normal"><a href="#__codelineno-41-156">156</a></span>
<span class="normal"><a href="#__codelineno-41-157">157</a></span>
<span class="normal"><a href="#__codelineno-41-158">158</a></span>
<span class="normal"><a href="#__codelineno-41-159">159</a></span>
<span class="normal"><a href="#__codelineno-41-160">160</a></span>
<span class="normal"><a href="#__codelineno-41-161">161</a></span>
<span class="normal"><a href="#__codelineno-41-162">162</a></span>
<span class="normal"><a href="#__codelineno-41-163">163</a></span>
<span class="normal"><a href="#__codelineno-41-164">164</a></span>
<span class="normal"><a href="#__codelineno-41-165">165</a></span>
<span class="normal"><a href="#__codelineno-41-166">166</a></span>
<span class="normal"><a href="#__codelineno-41-167">167</a></span>
<span class="normal"><a href="#__codelineno-41-168">168</a></span>
<span class="normal"><a href="#__codelineno-41-169">169</a></span>
<span class="normal"><a href="#__codelineno-41-170">170</a></span>
<span class="normal"><a href="#__codelineno-41-171">171</a></span>
<span class="normal"><a href="#__codelineno-41-172">172</a></span>
<span class="normal"><a href="#__codelineno-41-173">173</a></span>
<span class="normal"><a href="#__codelineno-41-174">174</a></span>
<span class="normal"><a href="#__codelineno-41-175">175</a></span>
<span class="normal"><a href="#__codelineno-41-176">176</a></span>
<span class="normal"><a href="#__codelineno-41-177">177</a></span>
<span class="normal"><a href="#__codelineno-41-178">178</a></span>
<span class="normal"><a href="#__codelineno-41-179">179</a></span>
<span class="normal"><a href="#__codelineno-41-180">180</a></span>
<span class="normal"><a href="#__codelineno-41-181">181</a></span>
<span class="normal"><a href="#__codelineno-41-182">182</a></span>
<span class="normal"><a href="#__codelineno-41-183">183</a></span>
<span class="normal"><a href="#__codelineno-41-184">184</a></span>
<span class="normal"><a href="#__codelineno-41-185">185</a></span>
<span class="normal"><a href="#__codelineno-41-186">186</a></span>
<span class="normal"><a href="#__codelineno-41-187">187</a></span>
<span class="normal"><a href="#__codelineno-41-188">188</a></span>
<span class="normal"><a href="#__codelineno-41-189">189</a></span>
<span class="normal"><a href="#__codelineno-41-190">190</a></span>
<span class="normal"><a href="#__codelineno-41-191">191</a></span>
<span class="normal"><a href="#__codelineno-41-192">192</a></span>
<span class="normal"><a href="#__codelineno-41-193">193</a></span>
<span class="normal"><a href="#__codelineno-41-194">194</a></span>
<span class="normal"><a href="#__codelineno-41-195">195</a></span>
<span class="normal"><a href="#__codelineno-41-196">196</a></span>
<span class="normal"><a href="#__codelineno-41-197">197</a></span>
<span class="normal"><a href="#__codelineno-41-198">198</a></span>
<span class="normal"><a href="#__codelineno-41-199">199</a></span>
<span class="normal"><a href="#__codelineno-41-200">200</a></span>
<span class="normal"><a href="#__codelineno-41-201">201</a></span>
<span class="normal"><a href="#__codelineno-41-202">202</a></span>
<span class="normal"><a href="#__codelineno-41-203">203</a></span>
<span class="normal"><a href="#__codelineno-41-204">204</a></span>
<span class="normal"><a href="#__codelineno-41-205">205</a></span>
<span class="normal"><a href="#__codelineno-41-206">206</a></span>
<span class="normal"><a href="#__codelineno-41-207">207</a></span>
<span class="normal"><a href="#__codelineno-41-208">208</a></span>
<span class="normal"><a href="#__codelineno-41-209">209</a></span>
<span class="normal"><a href="#__codelineno-41-210">210</a></span>
<span class="normal"><a href="#__codelineno-41-211">211</a></span>
<span class="normal"><a href="#__codelineno-41-212">212</a></span>
<span class="normal"><a href="#__codelineno-41-213">213</a></span>
<span class="normal"><a href="#__codelineno-41-214">214</a></span>
<span class="normal"><a href="#__codelineno-41-215">215</a></span>
<span class="normal"><a href="#__codelineno-41-216">216</a></span>
<span class="normal"><a href="#__codelineno-41-217">217</a></span>
<span class="normal"><a href="#__codelineno-41-218">218</a></span>
<span class="normal"><a href="#__codelineno-41-219">219</a></span>
<span class="normal"><a href="#__codelineno-41-220">220</a></span>
<span class="normal"><a href="#__codelineno-41-221">221</a></span>
<span class="normal"><a href="#__codelineno-41-222">222</a></span>
<span class="normal"><a href="#__codelineno-41-223">223</a></span>
<span class="normal"><a href="#__codelineno-41-224">224</a></span>
<span class="normal"><a href="#__codelineno-41-225">225</a></span>
<span class="normal"><a href="#__codelineno-41-226">226</a></span>
<span class="normal"><a href="#__codelineno-41-227">227</a></span>
<span class="normal"><a href="#__codelineno-41-228">228</a></span>
<span class="normal"><a href="#__codelineno-41-229">229</a></span>
<span class="normal"><a href="#__codelineno-41-230">230</a></span>
<span class="normal"><a href="#__codelineno-41-231">231</a></span>
<span class="normal"><a href="#__codelineno-41-232">232</a></span>
<span class="normal"><a href="#__codelineno-41-233">233</a></span>
<span class="normal"><a href="#__codelineno-41-234">234</a></span>
<span class="normal"><a href="#__codelineno-41-235">235</a></span>
<span class="normal"><a href="#__codelineno-41-236">236</a></span>
<span class="normal"><a href="#__codelineno-41-237">237</a></span>
<span class="normal"><a href="#__codelineno-41-238">238</a></span>
<span class="normal"><a href="#__codelineno-41-239">239</a></span>
<span class="normal"><a href="#__codelineno-41-240">240</a></span>
<span class="normal"><a href="#__codelineno-41-241">241</a></span>
<span class="normal"><a href="#__codelineno-41-242">242</a></span>
<span class="normal"><a href="#__codelineno-41-243">243</a></span>
<span class="normal"><a href="#__codelineno-41-244">244</a></span>
<span class="normal"><a href="#__codelineno-41-245">245</a></span>
<span class="normal"><a href="#__codelineno-41-246">246</a></span>
<span class="normal"><a href="#__codelineno-41-247">247</a></span>
<span class="normal"><a href="#__codelineno-41-248">248</a></span>
<span class="normal"><a href="#__codelineno-41-249">249</a></span>
<span class="normal"><a href="#__codelineno-41-250">250</a></span>
<span class="normal"><a href="#__codelineno-41-251">251</a></span>
<span class="normal"><a href="#__codelineno-41-252">252</a></span>
<span class="normal"><a href="#__codelineno-41-253">253</a></span>
<span class="normal"><a href="#__codelineno-41-254">254</a></span>
<span class="normal"><a href="#__codelineno-41-255">255</a></span>
<span class="normal"><a href="#__codelineno-41-256">256</a></span>
<span class="normal"><a href="#__codelineno-41-257">257</a></span>
<span class="normal"><a href="#__codelineno-41-258">258</a></span>
<span class="normal"><a href="#__codelineno-41-259">259</a></span>
<span class="normal"><a href="#__codelineno-41-260">260</a></span>
<span class="normal"><a href="#__codelineno-41-261">261</a></span>
<span class="normal"><a href="#__codelineno-41-262">262</a></span>
<span class="normal"><a href="#__codelineno-41-263">263</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2"></a>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="w">    </span><span class="s">&quot;context&quot;</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="w">    </span><span class="s">&quot;flag&quot;</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8"></a><span class="w">    </span><span class="s">&quot;strconv&quot;</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9"></a>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/agent/llmagent&quot;</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge&quot;</span>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/model&quot;</span>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/model/openai&quot;</span>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/runner&quot;</span>
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/session/inmemory&quot;</span>
</span><span id="__span-41-16"><a id="__codelineno-41-16" name="__codelineno-41-16"></a>
</span><span id="__span-41-17"><a id="__codelineno-41-17" name="__codelineno-41-17"></a><span class="w">    </span><span class="c1">// Embedder.</span>
</span><span id="__span-41-18"><a id="__codelineno-41-18" name="__codelineno-41-18"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/embedder&quot;</span>
</span><span id="__span-41-19"><a id="__codelineno-41-19" name="__codelineno-41-19"></a><span class="w">    </span><span class="nx">geminiembedder</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/embedder/gemini&quot;</span>
</span><span id="__span-41-20"><a id="__codelineno-41-20" name="__codelineno-41-20"></a><span class="w">    </span><span class="nx">openaiembedder</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/embedder/openai&quot;</span>
</span><span id="__span-41-21"><a id="__codelineno-41-21" name="__codelineno-41-21"></a><span class="w">    </span><span class="nx">ollamaembedder</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/embedder/ollama&quot;</span>
</span><span id="__span-41-22"><a id="__codelineno-41-22" name="__codelineno-41-22"></a><span class="w">    </span><span class="nx">huggingfaceembedder</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/embedder/huggingface&quot;</span>
</span><span id="__span-41-23"><a id="__codelineno-41-23" name="__codelineno-41-23"></a>
</span><span id="__span-41-24"><a id="__codelineno-41-24" name="__codelineno-41-24"></a><span class="w">    </span><span class="c1">// Source.</span>
</span><span id="__span-41-25"><a id="__codelineno-41-25" name="__codelineno-41-25"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/source&quot;</span>
</span><span id="__span-41-26"><a id="__codelineno-41-26" name="__codelineno-41-26"></a><span class="w">    </span><span class="nx">autosource</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/source/auto&quot;</span>
</span><span id="__span-41-27"><a id="__codelineno-41-27" name="__codelineno-41-27"></a><span class="w">    </span><span class="nx">dirsource</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/source/dir&quot;</span>
</span><span id="__span-41-28"><a id="__codelineno-41-28" name="__codelineno-41-28"></a><span class="w">    </span><span class="nx">filesource</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/source/file&quot;</span>
</span><span id="__span-41-29"><a id="__codelineno-41-29" name="__codelineno-41-29"></a><span class="w">    </span><span class="nx">urlsource</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/source/url&quot;</span>
</span><span id="__span-41-30"><a id="__codelineno-41-30" name="__codelineno-41-30"></a>
</span><span id="__span-41-31"><a id="__codelineno-41-31" name="__codelineno-41-31"></a><span class="w">    </span><span class="c1">// Vector Store.</span>
</span><span id="__span-41-32"><a id="__codelineno-41-32" name="__codelineno-41-32"></a><span class="w">    </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/vectorstore&quot;</span>
</span><span id="__span-41-33"><a id="__codelineno-41-33" name="__codelineno-41-33"></a><span class="w">    </span><span class="nx">vectorinmemory</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/vectorstore/inmemory&quot;</span>
</span><span id="__span-41-34"><a id="__codelineno-41-34" name="__codelineno-41-34"></a><span class="w">    </span><span class="nx">vectorpgvector</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/vectorstore/pgvector&quot;</span>
</span><span id="__span-41-35"><a id="__codelineno-41-35" name="__codelineno-41-35"></a><span class="w">    </span><span class="nx">vectorqdrant</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/vectorstore/qdrant&quot;</span>
</span><span id="__span-41-36"><a id="__codelineno-41-36" name="__codelineno-41-36"></a><span class="w">    </span><span class="nx">vectortcvector</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/vectorstore/tcvector&quot;</span>
</span><span id="__span-41-37"><a id="__codelineno-41-37" name="__codelineno-41-37"></a>
</span><span id="__span-41-38"><a id="__codelineno-41-38" name="__codelineno-41-38"></a><span class="w">    </span><span class="c1">// Import PDF reader to register it (optional - has separate go.mod to avoid unnecessary dependencies).</span>
</span><span id="__span-41-39"><a id="__codelineno-41-39" name="__codelineno-41-39"></a><span class="w">    </span><span class="c1">// _ &quot;trpc.group/trpc-go/trpc-agent-go/knowledge/document/reader/pdf&quot;</span>
</span><span id="__span-41-40"><a id="__codelineno-41-40" name="__codelineno-41-40"></a><span class="p">)</span>
</span><span id="__span-41-41"><a id="__codelineno-41-41" name="__codelineno-41-41"></a>
</span><span id="__span-41-42"><a id="__codelineno-41-42" name="__codelineno-41-42"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-43"><a id="__codelineno-41-43" name="__codelineno-41-43"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-41-44"><a id="__codelineno-41-44" name="__codelineno-41-44"></a><span class="w">        </span><span class="nx">embedderType</span><span class="w">    </span><span class="p">=</span><span class="w"> </span><span class="nx">flag</span><span class="p">.</span><span class="nx">String</span><span class="p">(</span><span class="s">&quot;embedder&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;openai&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;embedder type (openai, gemini, ollama, huggingface)&quot;</span><span class="p">)</span>
</span><span id="__span-41-45"><a id="__codelineno-41-45" name="__codelineno-41-45"></a><span class="w">        </span><span class="nx">vectorStoreType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">flag</span><span class="p">.</span><span class="nx">String</span><span class="p">(</span><span class="s">&quot;vectorstore&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;inmemory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;vector store type (inmemory, pgvector, tcvector, qdrant)&quot;</span><span class="p">)</span>
</span><span id="__span-41-46"><a id="__codelineno-41-46" name="__codelineno-41-46"></a><span class="w">        </span><span class="nx">modelName</span><span class="w">       </span><span class="p">=</span><span class="w"> </span><span class="nx">flag</span><span class="p">.</span><span class="nx">String</span><span class="p">(</span><span class="s">&quot;model&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;claude-4-sonnet-20250514&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Name of the model to use&quot;</span><span class="p">)</span>
</span><span id="__span-41-47"><a id="__codelineno-41-47" name="__codelineno-41-47"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-41-48"><a id="__codelineno-41-48" name="__codelineno-41-48"></a>
</span><span id="__span-41-49"><a id="__codelineno-41-49" name="__codelineno-41-49"></a><span class="w">    </span><span class="nx">flag</span><span class="p">.</span><span class="nx">Parse</span><span class="p">()</span>
</span><span id="__span-41-50"><a id="__codelineno-41-50" name="__codelineno-41-50"></a>
</span><span id="__span-41-51"><a id="__codelineno-41-51" name="__codelineno-41-51"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
</span><span id="__span-41-52"><a id="__codelineno-41-52" name="__codelineno-41-52"></a>
</span><span id="__span-41-53"><a id="__codelineno-41-53" name="__codelineno-41-53"></a><span class="w">    </span><span class="c1">// 1. Create embedder (select based on environment variables).</span>
</span><span id="__span-41-54"><a id="__codelineno-41-54" name="__codelineno-41-54"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">embedder</span><span class="w"> </span><span class="nx">embedder</span><span class="p">.</span><span class="nx">Embedder</span>
</span><span id="__span-41-55"><a id="__codelineno-41-55" name="__codelineno-41-55"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span>
</span><span id="__span-41-56"><a id="__codelineno-41-56" name="__codelineno-41-56"></a>
</span><span id="__span-41-57"><a id="__codelineno-41-57" name="__codelineno-41-57"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="o">*</span><span class="nx">embedderType</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-58"><a id="__codelineno-41-58" name="__codelineno-41-58"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;gemini&quot;</span><span class="p">:</span>
</span><span id="__span-41-59"><a id="__codelineno-41-59" name="__codelineno-41-59"></a><span class="w">        </span><span class="nx">embedder</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">geminiembedder</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">())</span>
</span><span id="__span-41-60"><a id="__codelineno-41-60" name="__codelineno-41-60"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-61"><a id="__codelineno-41-61" name="__codelineno-41-61"></a><span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;Failed to create gemini embedder: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-41-62"><a id="__codelineno-41-62" name="__codelineno-41-62"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-41-63"><a id="__codelineno-41-63" name="__codelineno-41-63"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;ollama&quot;</span><span class="p">:</span>
</span><span id="__span-41-64"><a id="__codelineno-41-64" name="__codelineno-41-64"></a><span class="w">        </span><span class="nx">embedder</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">ollamaembedder</span><span class="p">.</span><span class="nx">New</span><span class="p">()</span>
</span><span id="__span-41-65"><a id="__codelineno-41-65" name="__codelineno-41-65"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-66"><a id="__codelineno-41-66" name="__codelineno-41-66"></a><span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;Failed to create ollama embedder: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-41-67"><a id="__codelineno-41-67" name="__codelineno-41-67"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-41-68"><a id="__codelineno-41-68" name="__codelineno-41-68"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;huggingface&quot;</span><span class="p">:</span>
</span><span id="__span-41-69"><a id="__codelineno-41-69" name="__codelineno-41-69"></a><span class="w">        </span><span class="nx">embedder</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">huggingfaceembedder</span><span class="p">.</span><span class="nx">New</span><span class="p">()</span>
</span><span id="__span-41-70"><a id="__codelineno-41-70" name="__codelineno-41-70"></a><span class="w">    </span><span class="k">default</span><span class="p">:</span><span class="w"> </span><span class="c1">// openai.</span>
</span><span id="__span-41-71"><a id="__codelineno-41-71" name="__codelineno-41-71"></a><span class="w">        </span><span class="nx">embedder</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">openaiembedder</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-41-72"><a id="__codelineno-41-72" name="__codelineno-41-72"></a><span class="w">            </span><span class="nx">openaiembedder</span><span class="p">.</span><span class="nx">WithModel</span><span class="p">(</span><span class="nx">getEnvOrDefault</span><span class="p">(</span><span class="s">&quot;OPENAI_EMBEDDING_MODEL&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;text-embedding-3-small&quot;</span><span class="p">)),</span>
</span><span id="__span-41-73"><a id="__codelineno-41-73" name="__codelineno-41-73"></a><span class="w">        </span><span class="p">)</span>
</span><span id="__span-41-74"><a id="__codelineno-41-74" name="__codelineno-41-74"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-41-75"><a id="__codelineno-41-75" name="__codelineno-41-75"></a>
</span><span id="__span-41-76"><a id="__codelineno-41-76" name="__codelineno-41-76"></a><span class="w">    </span><span class="c1">// 2. Create vector store (select based on parameters).</span>
</span><span id="__span-41-77"><a id="__codelineno-41-77" name="__codelineno-41-77"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">vectorStore</span><span class="w"> </span><span class="nx">vectorstore</span><span class="p">.</span><span class="nx">VectorStore</span>
</span><span id="__span-41-78"><a id="__codelineno-41-78" name="__codelineno-41-78"></a>
</span><span id="__span-41-79"><a id="__codelineno-41-79" name="__codelineno-41-79"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="o">*</span><span class="nx">vectorStoreType</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-80"><a id="__codelineno-41-80" name="__codelineno-41-80"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;pgvector&quot;</span><span class="p">:</span>
</span><span id="__span-41-81"><a id="__codelineno-41-81" name="__codelineno-41-81"></a><span class="w">        </span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strconv</span><span class="p">.</span><span class="nx">Atoi</span><span class="p">(</span><span class="nx">getEnvOrDefault</span><span class="p">(</span><span class="s">&quot;PGVECTOR_PORT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;5432&quot;</span><span class="p">))</span>
</span><span id="__span-41-82"><a id="__codelineno-41-82" name="__codelineno-41-82"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-83"><a id="__codelineno-41-83" name="__codelineno-41-83"></a><span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;Failed to convert PGVECTOR_PORT to int: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-41-84"><a id="__codelineno-41-84" name="__codelineno-41-84"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-41-85"><a id="__codelineno-41-85" name="__codelineno-41-85"></a>
</span><span id="__span-41-86"><a id="__codelineno-41-86" name="__codelineno-41-86"></a><span class="w">        </span><span class="nx">vectorStore</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">vectorpgvector</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-41-87"><a id="__codelineno-41-87" name="__codelineno-41-87"></a><span class="w">            </span><span class="nx">vectorpgvector</span><span class="p">.</span><span class="nx">WithHost</span><span class="p">(</span><span class="nx">getEnvOrDefault</span><span class="p">(</span><span class="s">&quot;PGVECTOR_HOST&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">)),</span>
</span><span id="__span-41-88"><a id="__codelineno-41-88" name="__codelineno-41-88"></a><span class="w">            </span><span class="nx">vectorpgvector</span><span class="p">.</span><span class="nx">WithPort</span><span class="p">(</span><span class="nx">port</span><span class="p">),</span>
</span><span id="__span-41-89"><a id="__codelineno-41-89" name="__codelineno-41-89"></a><span class="w">            </span><span class="nx">vectorpgvector</span><span class="p">.</span><span class="nx">WithUser</span><span class="p">(</span><span class="nx">getEnvOrDefault</span><span class="p">(</span><span class="s">&quot;PGVECTOR_USER&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;postgres&quot;</span><span class="p">)),</span>
</span><span id="__span-41-90"><a id="__codelineno-41-90" name="__codelineno-41-90"></a><span class="w">            </span><span class="nx">vectorpgvector</span><span class="p">.</span><span class="nx">WithPassword</span><span class="p">(</span><span class="nx">getEnvOrDefault</span><span class="p">(</span><span class="s">&quot;PGVECTOR_PASSWORD&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)),</span>
</span><span id="__span-41-91"><a id="__codelineno-41-91" name="__codelineno-41-91"></a><span class="w">            </span><span class="nx">vectorpgvector</span><span class="p">.</span><span class="nx">WithDatabase</span><span class="p">(</span><span class="nx">getEnvOrDefault</span><span class="p">(</span><span class="s">&quot;PGVECTOR_DATABASE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;vectordb&quot;</span><span class="p">)),</span>
</span><span id="__span-41-92"><a id="__codelineno-41-92" name="__codelineno-41-92"></a><span class="w">            </span><span class="nx">vectorpgvector</span><span class="p">.</span><span class="nx">WithIndexDimension</span><span class="p">(</span><span class="mi">1536</span><span class="p">),</span>
</span><span id="__span-41-93"><a id="__codelineno-41-93" name="__codelineno-41-93"></a><span class="w">        </span><span class="p">)</span>
</span><span id="__span-41-94"><a id="__codelineno-41-94" name="__codelineno-41-94"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-95"><a id="__codelineno-41-95" name="__codelineno-41-95"></a><span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;Failed to create pgvector store: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-41-96"><a id="__codelineno-41-96" name="__codelineno-41-96"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-41-97"><a id="__codelineno-41-97" name="__codelineno-41-97"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;tcvector&quot;</span><span class="p">:</span>
</span><span id="__span-41-98"><a id="__codelineno-41-98" name="__codelineno-41-98"></a><span class="w">        </span><span class="nx">vectorStore</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-41-99"><a id="__codelineno-41-99" name="__codelineno-41-99"></a><span class="w">            </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">WithURL</span><span class="p">(</span><span class="nx">getEnvOrDefault</span><span class="p">(</span><span class="s">&quot;TCVECTOR_URL&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)),</span>
</span><span id="__span-41-100"><a id="__codelineno-41-100" name="__codelineno-41-100"></a><span class="w">            </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">WithUsername</span><span class="p">(</span><span class="nx">getEnvOrDefault</span><span class="p">(</span><span class="s">&quot;TCVECTOR_USERNAME&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)),</span>
</span><span id="__span-41-101"><a id="__codelineno-41-101" name="__codelineno-41-101"></a><span class="w">            </span><span class="nx">vectortcvector</span><span class="p">.</span><span class="nx">WithPassword</span><span class="p">(</span><span class="nx">getEnvOrDefault</span><span class="p">(</span><span class="s">&quot;TCVECTOR_PASSWORD&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)),</span>
</span><span id="__span-41-102"><a id="__codelineno-41-102" name="__codelineno-41-102"></a><span class="w">        </span><span class="p">)</span>
</span><span id="__span-41-103"><a id="__codelineno-41-103" name="__codelineno-41-103"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-104"><a id="__codelineno-41-104" name="__codelineno-41-104"></a><span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;Failed to create tcvector store: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-41-105"><a id="__codelineno-41-105" name="__codelineno-41-105"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-41-106"><a id="__codelineno-41-106" name="__codelineno-41-106"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;qdrant&quot;</span><span class="p">:</span>
</span><span id="__span-41-107"><a id="__codelineno-41-107" name="__codelineno-41-107"></a><span class="w">        </span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strconv</span><span class="p">.</span><span class="nx">Atoi</span><span class="p">(</span><span class="nx">getEnvOrDefault</span><span class="p">(</span><span class="s">&quot;QDRANT_PORT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;6334&quot;</span><span class="p">))</span>
</span><span id="__span-41-108"><a id="__codelineno-41-108" name="__codelineno-41-108"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-109"><a id="__codelineno-41-109" name="__codelineno-41-109"></a><span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;Failed to convert QDRANT_PORT to int: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-41-110"><a id="__codelineno-41-110" name="__codelineno-41-110"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-41-111"><a id="__codelineno-41-111" name="__codelineno-41-111"></a><span class="w">        </span><span class="nx">vectorStore</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span>
</span><span id="__span-41-112"><a id="__codelineno-41-112" name="__codelineno-41-112"></a><span class="w">            </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithHost</span><span class="p">(</span><span class="nx">getEnvOrDefault</span><span class="p">(</span><span class="s">&quot;QDRANT_HOST&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;localhost&quot;</span><span class="p">)),</span>
</span><span id="__span-41-113"><a id="__codelineno-41-113" name="__codelineno-41-113"></a><span class="w">            </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithPort</span><span class="p">(</span><span class="nx">port</span><span class="p">),</span>
</span><span id="__span-41-114"><a id="__codelineno-41-114" name="__codelineno-41-114"></a><span class="w">            </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithAPIKey</span><span class="p">(</span><span class="nx">getEnvOrDefault</span><span class="p">(</span><span class="s">&quot;QDRANT_API_KEY&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)),</span>
</span><span id="__span-41-115"><a id="__codelineno-41-115" name="__codelineno-41-115"></a><span class="w">            </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithTLS</span><span class="p">(</span><span class="nx">getEnvOrDefault</span><span class="p">(</span><span class="s">&quot;QDRANT_TLS&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">),</span>
</span><span id="__span-41-116"><a id="__codelineno-41-116" name="__codelineno-41-116"></a><span class="w">            </span><span class="nx">vectorqdrant</span><span class="p">.</span><span class="nx">WithDimension</span><span class="p">(</span><span class="mi">1536</span><span class="p">),</span>
</span><span id="__span-41-117"><a id="__codelineno-41-117" name="__codelineno-41-117"></a><span class="w">        </span><span class="p">)</span>
</span><span id="__span-41-118"><a id="__codelineno-41-118" name="__codelineno-41-118"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-119"><a id="__codelineno-41-119" name="__codelineno-41-119"></a><span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;Failed to create qdrant store: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-41-120"><a id="__codelineno-41-120" name="__codelineno-41-120"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-41-121"><a id="__codelineno-41-121" name="__codelineno-41-121"></a><span class="w">    </span><span class="k">default</span><span class="p">:</span><span class="w"> </span><span class="c1">// inmemory.</span>
</span><span id="__span-41-122"><a id="__codelineno-41-122" name="__codelineno-41-122"></a><span class="w">        </span><span class="nx">vectorStore</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">vectorinmemory</span><span class="p">.</span><span class="nx">New</span><span class="p">()</span>
</span><span id="__span-41-123"><a id="__codelineno-41-123" name="__codelineno-41-123"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-41-124"><a id="__codelineno-41-124" name="__codelineno-41-124"></a>
</span><span id="__span-41-125"><a id="__codelineno-41-125" name="__codelineno-41-125"></a><span class="w">    </span><span class="c1">// 3. Create knowledge sources.</span>
</span><span id="__span-41-126"><a id="__codelineno-41-126" name="__codelineno-41-126"></a><span class="w">    </span><span class="nx">sources</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">source</span><span class="p">.</span><span class="nx">Source</span><span class="p">{</span>
</span><span id="__span-41-127"><a id="__codelineno-41-127" name="__codelineno-41-127"></a><span class="w">        </span><span class="c1">// File source: Single file processing.</span>
</span><span id="__span-41-128"><a id="__codelineno-41-128" name="__codelineno-41-128"></a><span class="w">        </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-41-129"><a id="__codelineno-41-129" name="__codelineno-41-129"></a><span class="w">            </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;./data/llm.md&quot;</span><span class="p">},</span>
</span><span id="__span-41-130"><a id="__codelineno-41-130" name="__codelineno-41-130"></a><span class="w">            </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">WithChunkSize</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span>
</span><span id="__span-41-131"><a id="__codelineno-41-131" name="__codelineno-41-131"></a><span class="w">            </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">WithChunkOverlap</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span>
</span><span id="__span-41-132"><a id="__codelineno-41-132" name="__codelineno-41-132"></a><span class="w">            </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">WithName</span><span class="p">(</span><span class="s">&quot;LLM Documentation&quot;</span><span class="p">),</span>
</span><span id="__span-41-133"><a id="__codelineno-41-133" name="__codelineno-41-133"></a><span class="w">            </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;documentation&quot;</span><span class="p">),</span>
</span><span id="__span-41-134"><a id="__codelineno-41-134" name="__codelineno-41-134"></a><span class="w">            </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;category&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ai&quot;</span><span class="p">),</span>
</span><span id="__span-41-135"><a id="__codelineno-41-135" name="__codelineno-41-135"></a><span class="w">        </span><span class="p">),</span>
</span><span id="__span-41-136"><a id="__codelineno-41-136" name="__codelineno-41-136"></a>
</span><span id="__span-41-137"><a id="__codelineno-41-137" name="__codelineno-41-137"></a><span class="w">        </span><span class="c1">// Directory source: Batch directory processing.</span>
</span><span id="__span-41-138"><a id="__codelineno-41-138" name="__codelineno-41-138"></a><span class="w">        </span><span class="nx">dirsource</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-41-139"><a id="__codelineno-41-139" name="__codelineno-41-139"></a><span class="w">            </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;./dir&quot;</span><span class="p">},</span>
</span><span id="__span-41-140"><a id="__codelineno-41-140" name="__codelineno-41-140"></a><span class="w">            </span><span class="nx">dirsource</span><span class="p">.</span><span class="nx">WithRecursive</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
</span><span id="__span-41-141"><a id="__codelineno-41-141" name="__codelineno-41-141"></a><span class="w">            </span><span class="nx">dirsource</span><span class="p">.</span><span class="nx">WithFileExtensions</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;.md&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.txt&quot;</span><span class="p">}),</span>
</span><span id="__span-41-142"><a id="__codelineno-41-142" name="__codelineno-41-142"></a><span class="w">            </span><span class="nx">dirsource</span><span class="p">.</span><span class="nx">WithChunkSize</span><span class="p">(</span><span class="mi">800</span><span class="p">),</span>
</span><span id="__span-41-143"><a id="__codelineno-41-143" name="__codelineno-41-143"></a><span class="w">            </span><span class="nx">dirsource</span><span class="p">.</span><span class="nx">WithName</span><span class="p">(</span><span class="s">&quot;Documentation&quot;</span><span class="p">),</span>
</span><span id="__span-41-144"><a id="__codelineno-41-144" name="__codelineno-41-144"></a><span class="w">            </span><span class="nx">dirsource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;category&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;docs&quot;</span><span class="p">),</span>
</span><span id="__span-41-145"><a id="__codelineno-41-145" name="__codelineno-41-145"></a><span class="w">        </span><span class="p">),</span>
</span><span id="__span-41-146"><a id="__codelineno-41-146" name="__codelineno-41-146"></a>
</span><span id="__span-41-147"><a id="__codelineno-41-147" name="__codelineno-41-147"></a><span class="w">        </span><span class="c1">// URL source: Get content from web pages.</span>
</span><span id="__span-41-148"><a id="__codelineno-41-148" name="__codelineno-41-148"></a><span class="w">        </span><span class="nx">urlsource</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-41-149"><a id="__codelineno-41-149" name="__codelineno-41-149"></a><span class="w">            </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;https://en.wikipedia.org/wiki/Artificial_intelligence&quot;</span><span class="p">},</span>
</span><span id="__span-41-150"><a id="__codelineno-41-150" name="__codelineno-41-150"></a><span class="w">            </span><span class="nx">urlsource</span><span class="p">.</span><span class="nx">WithName</span><span class="p">(</span><span class="s">&quot;Web Documentation&quot;</span><span class="p">),</span>
</span><span id="__span-41-151"><a id="__codelineno-41-151" name="__codelineno-41-151"></a><span class="w">            </span><span class="nx">urlsource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;source&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;web&quot;</span><span class="p">),</span>
</span><span id="__span-41-152"><a id="__codelineno-41-152" name="__codelineno-41-152"></a><span class="w">            </span><span class="nx">urlsource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;category&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;wikipedia&quot;</span><span class="p">),</span>
</span><span id="__span-41-153"><a id="__codelineno-41-153" name="__codelineno-41-153"></a><span class="w">            </span><span class="nx">urlsource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;language&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;en&quot;</span><span class="p">),</span>
</span><span id="__span-41-154"><a id="__codelineno-41-154" name="__codelineno-41-154"></a><span class="w">        </span><span class="p">),</span>
</span><span id="__span-41-155"><a id="__codelineno-41-155" name="__codelineno-41-155"></a>
</span><span id="__span-41-156"><a id="__codelineno-41-156" name="__codelineno-41-156"></a><span class="w">        </span><span class="c1">// Auto source: Mixed content types.</span>
</span><span id="__span-41-157"><a id="__codelineno-41-157" name="__codelineno-41-157"></a><span class="w">        </span><span class="nx">autosource</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-41-158"><a id="__codelineno-41-158" name="__codelineno-41-158"></a><span class="w">            </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
</span><span id="__span-41-159"><a id="__codelineno-41-159" name="__codelineno-41-159"></a><span class="w">                </span><span class="s">&quot;Cloud computing is the delivery of computing services over the internet, including servers, storage, databases, networking, software, and analytics. It provides on-demand access to shared computing resources.&quot;</span><span class="p">,</span>
</span><span id="__span-41-160"><a id="__codelineno-41-160" name="__codelineno-41-160"></a><span class="w">                </span><span class="s">&quot;Machine learning is a subset of artificial intelligence that enables systems to learn and improve from experience without being explicitly programmed.&quot;</span><span class="p">,</span>
</span><span id="__span-41-161"><a id="__codelineno-41-161" name="__codelineno-41-161"></a><span class="w">                </span><span class="s">&quot;./README.md&quot;</span><span class="p">,</span>
</span><span id="__span-41-162"><a id="__codelineno-41-162" name="__codelineno-41-162"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-41-163"><a id="__codelineno-41-163" name="__codelineno-41-163"></a><span class="w">            </span><span class="nx">autosource</span><span class="p">.</span><span class="nx">WithName</span><span class="p">(</span><span class="s">&quot;Mixed Knowledge Sources&quot;</span><span class="p">),</span>
</span><span id="__span-41-164"><a id="__codelineno-41-164" name="__codelineno-41-164"></a><span class="w">            </span><span class="nx">autosource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;category&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mixed&quot;</span><span class="p">),</span>
</span><span id="__span-41-165"><a id="__codelineno-41-165" name="__codelineno-41-165"></a><span class="w">            </span><span class="nx">autosource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;custom&quot;</span><span class="p">),</span>
</span><span id="__span-41-166"><a id="__codelineno-41-166" name="__codelineno-41-166"></a><span class="w">            </span><span class="nx">autosource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;topics&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;cloud&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ml&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ai&quot;</span><span class="p">}),</span>
</span><span id="__span-41-167"><a id="__codelineno-41-167" name="__codelineno-41-167"></a><span class="w">        </span><span class="p">),</span>
</span><span id="__span-41-168"><a id="__codelineno-41-168" name="__codelineno-41-168"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-41-169"><a id="__codelineno-41-169" name="__codelineno-41-169"></a>
</span><span id="__span-41-170"><a id="__codelineno-41-170" name="__codelineno-41-170"></a><span class="w">    </span><span class="c1">// 4. Create Knowledge.</span>
</span><span id="__span-41-171"><a id="__codelineno-41-171" name="__codelineno-41-171"></a><span class="w">    </span><span class="nx">kb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-41-172"><a id="__codelineno-41-172" name="__codelineno-41-172"></a><span class="w">        </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithEmbedder</span><span class="p">(</span><span class="nx">embedder</span><span class="p">),</span>
</span><span id="__span-41-173"><a id="__codelineno-41-173" name="__codelineno-41-173"></a><span class="w">        </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithVectorStore</span><span class="p">(</span><span class="nx">vectorStore</span><span class="p">),</span>
</span><span id="__span-41-174"><a id="__codelineno-41-174" name="__codelineno-41-174"></a><span class="w">        </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithSources</span><span class="p">(</span><span class="nx">sources</span><span class="p">),</span>
</span><span id="__span-41-175"><a id="__codelineno-41-175" name="__codelineno-41-175"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-41-176"><a id="__codelineno-41-176" name="__codelineno-41-176"></a>
</span><span id="__span-41-177"><a id="__codelineno-41-177" name="__codelineno-41-177"></a><span class="w">    </span><span class="c1">// 5. Load documents (with progress and statistics).</span>
</span><span id="__span-41-178"><a id="__codelineno-41-178" name="__codelineno-41-178"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;🚀 Starting to load Knowledge ...&quot;</span><span class="p">)</span>
</span><span id="__span-41-179"><a id="__codelineno-41-179" name="__codelineno-41-179"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">kb</span><span class="p">.</span><span class="nx">Load</span><span class="p">(</span>
</span><span id="__span-41-180"><a id="__codelineno-41-180" name="__codelineno-41-180"></a><span class="w">        </span><span class="nx">ctx</span><span class="p">,</span>
</span><span id="__span-41-181"><a id="__codelineno-41-181" name="__codelineno-41-181"></a><span class="w">        </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithShowProgress</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
</span><span id="__span-41-182"><a id="__codelineno-41-182" name="__codelineno-41-182"></a><span class="w">        </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithProgressStepSize</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
</span><span id="__span-41-183"><a id="__codelineno-41-183" name="__codelineno-41-183"></a><span class="w">        </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithShowStats</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span>
</span><span id="__span-41-184"><a id="__codelineno-41-184" name="__codelineno-41-184"></a><span class="w">        </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithSourceConcurrency</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
</span><span id="__span-41-185"><a id="__codelineno-41-185" name="__codelineno-41-185"></a><span class="w">        </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithDocConcurrency</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span>
</span><span id="__span-41-186"><a id="__codelineno-41-186" name="__codelineno-41-186"></a><span class="w">    </span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-187"><a id="__codelineno-41-187" name="__codelineno-41-187"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;❌ Knowledge loading failed: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-41-188"><a id="__codelineno-41-188" name="__codelineno-41-188"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-41-189"><a id="__codelineno-41-189" name="__codelineno-41-189"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;✅ Knowledge loading completed!&quot;</span><span class="p">)</span>
</span><span id="__span-41-190"><a id="__codelineno-41-190" name="__codelineno-41-190"></a>
</span><span id="__span-41-191"><a id="__codelineno-41-191" name="__codelineno-41-191"></a><span class="w">    </span><span class="c1">// 6. Create LLM model.</span>
</span><span id="__span-41-192"><a id="__codelineno-41-192" name="__codelineno-41-192"></a><span class="w">    </span><span class="nx">modelInstance</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">openai</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="o">*</span><span class="nx">modelName</span><span class="p">)</span>
</span><span id="__span-41-193"><a id="__codelineno-41-193" name="__codelineno-41-193"></a>
</span><span id="__span-41-194"><a id="__codelineno-41-194" name="__codelineno-41-194"></a><span class="w">    </span><span class="c1">// Get metadata information from all sources (for intelligent filters).</span>
</span><span id="__span-41-195"><a id="__codelineno-41-195" name="__codelineno-41-195"></a><span class="w">    </span><span class="nx">sourcesMetadata</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">source</span><span class="p">.</span><span class="nx">GetAllMetadata</span><span class="p">(</span><span class="nx">sources</span><span class="p">)</span>
</span><span id="__span-41-196"><a id="__codelineno-41-196" name="__codelineno-41-196"></a>
</span><span id="__span-41-197"><a id="__codelineno-41-197" name="__codelineno-41-197"></a><span class="w">    </span><span class="c1">// 7. Create Agent and integrate Knowledge.</span>
</span><span id="__span-41-198"><a id="__codelineno-41-198" name="__codelineno-41-198"></a><span class="w">    </span><span class="nx">llmAgent</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-41-199"><a id="__codelineno-41-199" name="__codelineno-41-199"></a><span class="w">        </span><span class="s">&quot;knowledge-assistant&quot;</span><span class="p">,</span>
</span><span id="__span-41-200"><a id="__codelineno-41-200" name="__codelineno-41-200"></a><span class="w">        </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithModel</span><span class="p">(</span><span class="nx">modelInstance</span><span class="p">),</span>
</span><span id="__span-41-201"><a id="__codelineno-41-201" name="__codelineno-41-201"></a><span class="w">        </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithDescription</span><span class="p">(</span><span class="s">&quot;Intelligent assistant with Knowledge access capabilities&quot;</span><span class="p">),</span>
</span><span id="__span-41-202"><a id="__codelineno-41-202" name="__codelineno-41-202"></a><span class="w">        </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithInstruction</span><span class="p">(</span><span class="s">&quot;Use the knowledge_search or knowledge_search_with_filter tool to retrieve relevant information from Knowledge and answer questions based on retrieved content. Select appropriate filter conditions based on user queries.&quot;</span><span class="p">),</span>
</span><span id="__span-41-203"><a id="__codelineno-41-203" name="__codelineno-41-203"></a><span class="w">        </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithKnowledge</span><span class="p">(</span><span class="nx">kb</span><span class="p">),</span><span class="w"> </span><span class="c1">// Automatically add knowledge_search tool.</span>
</span><span id="__span-41-204"><a id="__codelineno-41-204" name="__codelineno-41-204"></a><span class="w">        </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithEnableKnowledgeAgenticFilter</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span><span class="w">           </span><span class="c1">// Enable intelligent filters</span>
</span><span id="__span-41-205"><a id="__codelineno-41-205" name="__codelineno-41-205"></a><span class="w">        </span><span class="nx">llmagent</span><span class="p">.</span><span class="nx">WithKnowledgeAgenticFilterInfo</span><span class="p">(</span><span class="nx">sourcesMetadata</span><span class="p">),</span><span class="w"> </span><span class="c1">// Provide available filter information</span>
</span><span id="__span-41-206"><a id="__codelineno-41-206" name="__codelineno-41-206"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-41-207"><a id="__codelineno-41-207" name="__codelineno-41-207"></a>
</span><span id="__span-41-208"><a id="__codelineno-41-208" name="__codelineno-41-208"></a><span class="w">    </span><span class="c1">// 8. Create Runner.</span>
</span><span id="__span-41-209"><a id="__codelineno-41-209" name="__codelineno-41-209"></a><span class="w">    </span><span class="nx">sessionService</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">inmemory</span><span class="p">.</span><span class="nx">NewSessionService</span><span class="p">()</span>
</span><span id="__span-41-210"><a id="__codelineno-41-210" name="__codelineno-41-210"></a><span class="w">    </span><span class="nx">appRunner</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">runner</span><span class="p">.</span><span class="nx">NewRunner</span><span class="p">(</span>
</span><span id="__span-41-211"><a id="__codelineno-41-211" name="__codelineno-41-211"></a><span class="w">        </span><span class="s">&quot;knowledge-chat&quot;</span><span class="p">,</span>
</span><span id="__span-41-212"><a id="__codelineno-41-212" name="__codelineno-41-212"></a><span class="w">        </span><span class="nx">llmAgent</span><span class="p">,</span>
</span><span id="__span-41-213"><a id="__codelineno-41-213" name="__codelineno-41-213"></a><span class="w">        </span><span class="nx">runner</span><span class="p">.</span><span class="nx">WithSessionService</span><span class="p">(</span><span class="nx">sessionService</span><span class="p">),</span>
</span><span id="__span-41-214"><a id="__codelineno-41-214" name="__codelineno-41-214"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-41-215"><a id="__codelineno-41-215" name="__codelineno-41-215"></a>
</span><span id="__span-41-216"><a id="__codelineno-41-216" name="__codelineno-41-216"></a><span class="w">    </span><span class="c1">// 9. Execute conversation (Agent will automatically use knowledge_search tool).</span>
</span><span id="__span-41-217"><a id="__codelineno-41-217" name="__codelineno-41-217"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;🔍 Starting to search knowledge base...&quot;</span><span class="p">)</span>
</span><span id="__span-41-218"><a id="__codelineno-41-218" name="__codelineno-41-218"></a><span class="w">    </span><span class="nx">message</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">model</span><span class="p">.</span><span class="nx">NewUserMessage</span><span class="p">(</span><span class="s">&quot;Please tell me about LLM information&quot;</span><span class="p">)</span>
</span><span id="__span-41-219"><a id="__codelineno-41-219" name="__codelineno-41-219"></a><span class="w">    </span><span class="nx">eventChan</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">appRunner</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user123&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;session456&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span>
</span><span id="__span-41-220"><a id="__codelineno-41-220" name="__codelineno-41-220"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-221"><a id="__codelineno-41-221" name="__codelineno-41-221"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;Failed to run agent: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-41-222"><a id="__codelineno-41-222" name="__codelineno-41-222"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-41-223"><a id="__codelineno-41-223" name="__codelineno-41-223"></a>
</span><span id="__span-41-224"><a id="__codelineno-41-224" name="__codelineno-41-224"></a><span class="w">    </span><span class="c1">// 10. Handle response ...</span>
</span><span id="__span-41-225"><a id="__codelineno-41-225" name="__codelineno-41-225"></a>
</span><span id="__span-41-226"><a id="__codelineno-41-226" name="__codelineno-41-226"></a><span class="w">    </span><span class="c1">// 11. Demonstrate knowledge base management functionality - view document metadata</span>
</span><span id="__span-41-227"><a id="__codelineno-41-227" name="__codelineno-41-227"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;📊 Displaying current knowledge base status...&quot;</span><span class="p">)</span>
</span><span id="__span-41-228"><a id="__codelineno-41-228" name="__codelineno-41-228"></a>
</span><span id="__span-41-229"><a id="__codelineno-41-229" name="__codelineno-41-229"></a><span class="w">    </span><span class="c1">// Query metadata information for all documents, also supports querying specific source or metadata data</span>
</span><span id="__span-41-230"><a id="__codelineno-41-230" name="__codelineno-41-230"></a><span class="w">    </span><span class="nx">docInfos</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">kb</span><span class="p">.</span><span class="nx">ShowDocumentInfo</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
</span><span id="__span-41-231"><a id="__codelineno-41-231" name="__codelineno-41-231"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-232"><a id="__codelineno-41-232" name="__codelineno-41-232"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Failed to show document info: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-41-233"><a id="__codelineno-41-233" name="__codelineno-41-233"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-234"><a id="__codelineno-41-234" name="__codelineno-41-234"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Knowledge base contains a total of %d document chunks&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">docInfos</span><span class="p">))</span>
</span><span id="__span-41-235"><a id="__codelineno-41-235" name="__codelineno-41-235"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-41-236"><a id="__codelineno-41-236" name="__codelineno-41-236"></a>
</span><span id="__span-41-237"><a id="__codelineno-41-237" name="__codelineno-41-237"></a>
</span><span id="__span-41-238"><a id="__codelineno-41-238" name="__codelineno-41-238"></a><span class="w">    </span><span class="c1">// 12. Demonstrate dynamic source addition - new data will automatically stay consistent with configuration</span>
</span><span id="__span-41-239"><a id="__codelineno-41-239" name="__codelineno-41-239"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Demonstrating dynamic source addition...&quot;</span><span class="p">)</span>
</span><span id="__span-41-240"><a id="__codelineno-41-240" name="__codelineno-41-240"></a><span class="w">    </span><span class="nx">newSource</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-41-241"><a id="__codelineno-41-241" name="__codelineno-41-241"></a><span class="w">        </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;./new-docs/changelog.md&quot;</span><span class="p">},</span>
</span><span id="__span-41-242"><a id="__codelineno-41-242" name="__codelineno-41-242"></a><span class="w">        </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">WithName</span><span class="p">(</span><span class="s">&quot;Changelog&quot;</span><span class="p">),</span>
</span><span id="__span-41-243"><a id="__codelineno-41-243" name="__codelineno-41-243"></a><span class="w">        </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;category&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;changelog&quot;</span><span class="p">),</span>
</span><span id="__span-41-244"><a id="__codelineno-41-244" name="__codelineno-41-244"></a><span class="w">        </span><span class="nx">filesource</span><span class="p">.</span><span class="nx">WithMetadataValue</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;updates&quot;</span><span class="p">),</span>
</span><span id="__span-41-245"><a id="__codelineno-41-245" name="__codelineno-41-245"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-41-246"><a id="__codelineno-41-246" name="__codelineno-41-246"></a>
</span><span id="__span-41-247"><a id="__codelineno-41-247" name="__codelineno-41-247"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">kb</span><span class="p">.</span><span class="nx">AddSource</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">newSource</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-248"><a id="__codelineno-41-248" name="__codelineno-41-248"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Failed to add new source: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-41-249"><a id="__codelineno-41-249" name="__codelineno-41-249"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-41-250"><a id="__codelineno-41-250" name="__codelineno-41-250"></a>
</span><span id="__span-41-251"><a id="__codelineno-41-251" name="__codelineno-41-251"></a><span class="w">    </span><span class="c1">// 13. Demonstrate source removal (optional, uncomment to test)</span>
</span><span id="__span-41-252"><a id="__codelineno-41-252" name="__codelineno-41-252"></a><span class="w">    </span><span class="c1">// if err := kb.RemoveSource(ctx, &quot;Changelog&quot;); err != nil {</span>
</span><span id="__span-41-253"><a id="__codelineno-41-253" name="__codelineno-41-253"></a><span class="w">    </span><span class="c1">//     log.Printf(&quot;Failed to remove source: %v&quot;, err)</span>
</span><span id="__span-41-254"><a id="__codelineno-41-254" name="__codelineno-41-254"></a><span class="w">    </span><span class="c1">// }</span>
</span><span id="__span-41-255"><a id="__codelineno-41-255" name="__codelineno-41-255"></a><span class="p">}</span>
</span><span id="__span-41-256"><a id="__codelineno-41-256" name="__codelineno-41-256"></a>
</span><span id="__span-41-257"><a id="__codelineno-41-257" name="__codelineno-41-257"></a><span class="c1">// getEnvOrDefault returns the environment variable value or a default value if not set.</span>
</span><span id="__span-41-258"><a id="__codelineno-41-258" name="__codelineno-41-258"></a><span class="kd">func</span><span class="w"> </span><span class="nx">getEnvOrDefault</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">defaultValue</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-259"><a id="__codelineno-41-259" name="__codelineno-41-259"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-260"><a id="__codelineno-41-260" name="__codelineno-41-260"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">value</span>
</span><span id="__span-41-261"><a id="__codelineno-41-261" name="__codelineno-41-261"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-41-262"><a id="__codelineno-41-262" name="__codelineno-41-262"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">defaultValue</span>
</span><span id="__span-41-263"><a id="__codelineno-41-263" name="__codelineno-41-263"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>The environment variable configuration is as follows:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-42-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-42-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-42-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-42-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-42-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-42-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-42-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-42-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-42-10">10</a></span>
<span class="normal"><a href="#__codelineno-42-11">11</a></span>
<span class="normal"><a href="#__codelineno-42-12">12</a></span>
<span class="normal"><a href="#__codelineno-42-13">13</a></span>
<span class="normal"><a href="#__codelineno-42-14">14</a></span>
<span class="normal"><a href="#__codelineno-42-15">15</a></span>
<span class="normal"><a href="#__codelineno-42-16">16</a></span>
<span class="normal"><a href="#__codelineno-42-17">17</a></span>
<span class="normal"><a href="#__codelineno-42-18">18</a></span>
<span class="normal"><a href="#__codelineno-42-19">19</a></span>
<span class="normal"><a href="#__codelineno-42-20">20</a></span>
<span class="normal"><a href="#__codelineno-42-21">21</a></span>
<span class="normal"><a href="#__codelineno-42-22">22</a></span>
<span class="normal"><a href="#__codelineno-42-23">23</a></span>
<span class="normal"><a href="#__codelineno-42-24">24</a></span>
<span class="normal"><a href="#__codelineno-42-25">25</a></span>
<span class="normal"><a href="#__codelineno-42-26">26</a></span>
<span class="normal"><a href="#__codelineno-42-27">27</a></span>
<span class="normal"><a href="#__codelineno-42-28">28</a></span>
<span class="normal"><a href="#__codelineno-42-29">29</a></span>
<span class="normal"><a href="#__codelineno-42-30">30</a></span>
<span class="normal"><a href="#__codelineno-42-31">31</a></span>
<span class="normal"><a href="#__codelineno-42-32">32</a></span>
<span class="normal"><a href="#__codelineno-42-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="c1"># OpenAI API configuration (required when using OpenAI embedder, automatically read by OpenAI SDK).</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OPENAI_API_KEY</span><span class="o">=</span><span class="s2">&quot;your-openai-api-key&quot;</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OPENAI_BASE_URL</span><span class="o">=</span><span class="s2">&quot;your-openai-base-url&quot;</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="c1"># OpenAI embedding model configuration (optional, needs manual reading in code).</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OPENAI_EMBEDDING_MODEL</span><span class="o">=</span><span class="s2">&quot;text-embedding-3-small&quot;</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6"></a>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7"></a><span class="c1"># Google Gemini API configuration (when using Gemini embedder).</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GOOGLE_API_KEY</span><span class="o">=</span><span class="s2">&quot;your-google-api-key&quot;</span>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9"></a>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10"></a><span class="c1"># PostgreSQL + pgvector configuration (required when using -vectorstore=pgvector)</span>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PGVECTOR_HOST</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span>
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PGVECTOR_PORT</span><span class="o">=</span><span class="s2">&quot;5432&quot;</span>
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PGVECTOR_USER</span><span class="o">=</span><span class="s2">&quot;postgres&quot;</span>
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PGVECTOR_PASSWORD</span><span class="o">=</span><span class="s2">&quot;your-password&quot;</span>
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PGVECTOR_DATABASE</span><span class="o">=</span><span class="s2">&quot;vectordb&quot;</span>
</span><span id="__span-42-16"><a id="__codelineno-42-16" name="__codelineno-42-16"></a>
</span><span id="__span-42-17"><a id="__codelineno-42-17" name="__codelineno-42-17"></a><span class="c1"># TcVector configuration (required when using -vectorstore=tcvector)</span>
</span><span id="__span-42-18"><a id="__codelineno-42-18" name="__codelineno-42-18"></a><span class="nb">export</span><span class="w"> </span><span class="nv">TCVECTOR_URL</span><span class="o">=</span><span class="s2">&quot;https://your-tcvector-endpoint&quot;</span>
</span><span id="__span-42-19"><a id="__codelineno-42-19" name="__codelineno-42-19"></a><span class="nb">export</span><span class="w"> </span><span class="nv">TCVECTOR_USERNAME</span><span class="o">=</span><span class="s2">&quot;your-username&quot;</span>
</span><span id="__span-42-20"><a id="__codelineno-42-20" name="__codelineno-42-20"></a><span class="nb">export</span><span class="w"> </span><span class="nv">TCVECTOR_PASSWORD</span><span class="o">=</span><span class="s2">&quot;your-password&quot;</span>
</span><span id="__span-42-21"><a id="__codelineno-42-21" name="__codelineno-42-21"></a>
</span><span id="__span-42-22"><a id="__codelineno-42-22" name="__codelineno-42-22"></a><span class="c1"># Elasticsearch configuration (required when using -vectorstore=elasticsearch)</span>
</span><span id="__span-42-23"><a id="__codelineno-42-23" name="__codelineno-42-23"></a><span class="nb">export</span><span class="w"> </span><span class="nv">ELASTICSEARCH_HOSTS</span><span class="o">=</span><span class="s2">&quot;http://localhost:9200&quot;</span>
</span><span id="__span-42-24"><a id="__codelineno-42-24" name="__codelineno-42-24"></a><span class="nb">export</span><span class="w"> </span><span class="nv">ELASTICSEARCH_USERNAME</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</span><span id="__span-42-25"><a id="__codelineno-42-25" name="__codelineno-42-25"></a><span class="nb">export</span><span class="w"> </span><span class="nv">ELASTICSEARCH_PASSWORD</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</span><span id="__span-42-26"><a id="__codelineno-42-26" name="__codelineno-42-26"></a><span class="nb">export</span><span class="w"> </span><span class="nv">ELASTICSEARCH_API_KEY</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</span><span id="__span-42-27"><a id="__codelineno-42-27" name="__codelineno-42-27"></a><span class="nb">export</span><span class="w"> </span><span class="nv">ELASTICSEARCH_INDEX_NAME</span><span class="o">=</span><span class="s2">&quot;trpc_agent_documents&quot;</span>
</span><span id="__span-42-28"><a id="__codelineno-42-28" name="__codelineno-42-28"></a>
</span><span id="__span-42-29"><a id="__codelineno-42-29" name="__codelineno-42-29"></a><span class="c1"># Qdrant configuration (required when using -vectorstore=qdrant)</span>
</span><span id="__span-42-30"><a id="__codelineno-42-30" name="__codelineno-42-30"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QDRANT_HOST</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="w">          </span><span class="c1"># or &quot;xyz-abc.cloud.qdrant.io&quot; for Qdrant Cloud</span>
</span><span id="__span-42-31"><a id="__codelineno-42-31" name="__codelineno-42-31"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QDRANT_PORT</span><span class="o">=</span><span class="s2">&quot;6334&quot;</span>
</span><span id="__span-42-32"><a id="__codelineno-42-32" name="__codelineno-42-32"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QDRANT_API_KEY</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="w">                </span><span class="c1"># Required for Qdrant Cloud</span>
</span><span id="__span-42-33"><a id="__codelineno-42-33" name="__codelineno-42-33"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QDRANT_TLS</span><span class="o">=</span><span class="s2">&quot;false&quot;</span><span class="w">               </span><span class="c1"># Set to &quot;true&quot; for Qdrant Cloud</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="command-line-parameters">Command Line Parameters</h3>
<div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-43-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-43-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-43-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-43-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-43-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-43-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-43-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-43-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-43-10">10</a></span>
<span class="normal"><a href="#__codelineno-43-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="c1"># When running examples, you can select component types through command line parameters.</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2"></a>go<span class="w"> </span>run<span class="w"> </span>main.go<span class="w"> </span>-embedder<span class="w"> </span>openai<span class="w"> </span>-vectorstore<span class="w"> </span>inmemory
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3"></a>go<span class="w"> </span>run<span class="w"> </span>main.go<span class="w"> </span>-embedder<span class="w"> </span>gemini<span class="w"> </span>-vectorstore<span class="w"> </span>pgvector
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4"></a>go<span class="w"> </span>run<span class="w"> </span>main.go<span class="w"> </span>-embedder<span class="w"> </span>openai<span class="w"> </span>-vectorstore<span class="w"> </span>tcvector
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5"></a>go<span class="w"> </span>run<span class="w"> </span>main.go<span class="w"> </span>-embedder<span class="w"> </span>openai<span class="w"> </span>-vectorstore<span class="w"> </span>elasticsearch<span class="w"> </span>-es-version<span class="w"> </span>v9
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6"></a>go<span class="w"> </span>run<span class="w"> </span>main.go<span class="w"> </span>-embedder<span class="w"> </span>openai<span class="w"> </span>-vectorstore<span class="w"> </span>qdrant
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7"></a>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8"></a><span class="c1"># Parameter description:</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9"></a><span class="c1"># -embedder: Select embedder type (openai, gemini, ollama, huggingface), default is openai.</span>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10"></a><span class="c1"># -vectorstore: Select vector store type (inmemory, pgvector, tcvector, elasticsearch, qdrant), default is inmemory.</span>
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11"></a><span class="c1"># -es-version: Elasticsearch version (v7, v8, v9), only when vectorstore=elasticsearch.</span>
</span></code></pre></div></td></tr></table></div>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="common-issues-and-handling-suggestions">Common Issues and Handling Suggestions</h3>
<ol>
<li>
<p><strong>Create embedding failed/HTTP 4xx/5xx</strong></p>
<ul>
<li>Possible causes: Invalid or missing API Key; Incorrect BaseURL configuration; Network access restrictions; Text too long; The configured BaseURL doesn't provide Embeddings interface or doesn't support the selected embedding model (e.g., returns 404 Not Found).</li>
<li>Troubleshooting steps:<ul>
<li>Confirm <code>OPENAI_API_KEY</code> is set and available;</li>
<li>If using compatible gateway, explicitly set <code>WithBaseURL(os.Getenv("OPENAI_BASE_URL"))</code>;</li>
<li>Confirm <code>WithModel("text-embedding-3-small")</code> or the actual embedding model name supported by your service;</li>
<li>Use minimal example to call embedding API once to verify connectivity;</li>
<li>Use curl to verify if target BaseURL implements <code>/v1/embeddings</code> and model exists:
   <div class="language-bash highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1">1</a></span>
<span class="normal"><a href="#__codelineno-44-2">2</a></span>
<span class="normal"><a href="#__codelineno-44-3">3</a></span>
<span class="normal"><a href="#__codelineno-44-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1"></a>curl<span class="w"> </span>-sS<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OPENAI_BASE_URL</span><span class="s2">/embeddings&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$OPENAI_API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;model&quot;:&quot;text-embedding-3-small&quot;,&quot;input&quot;:&quot;ping&quot;}&#39;</span>
</span></code></pre></div></td></tr></table></div>
   If returns 404/model doesn't exist, please switch to BaseURL that supports Embeddings or switch to valid embedding model name provided by that service.</li>
<li>Gradually shorten text to confirm it's not caused by overly long input.</li>
</ul>
</li>
<li>Reference code:
   <div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1">1</a></span>
<span class="normal"><a href="#__codelineno-45-2">2</a></span>
<span class="normal"><a href="#__codelineno-45-3">3</a></span>
<span class="normal"><a href="#__codelineno-45-4">4</a></span>
<span class="normal"><a href="#__codelineno-45-5">5</a></span>
<span class="normal"><a href="#__codelineno-45-6">6</a></span>
<span class="normal"><a href="#__codelineno-45-7">7</a></span>
<span class="normal"><a href="#__codelineno-45-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="nx">embedder</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">openaiembedder</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="w">    </span><span class="nx">openaiembedder</span><span class="p">.</span><span class="nx">WithModel</span><span class="p">(</span><span class="s">&quot;text-embedding-3-small&quot;</span><span class="p">),</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="w">    </span><span class="nx">openaiembedder</span><span class="p">.</span><span class="nx">WithAPIKey</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;OPENAI_API_KEY&quot;</span><span class="p">)),</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="w">    </span><span class="nx">openaiembedder</span><span class="p">.</span><span class="nx">WithBaseURL</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;OPENAI_BASE_URL&quot;</span><span class="p">)),</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5"></a><span class="p">)</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6"></a><span class="k">if</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">embedder</span><span class="p">.</span><span class="nx">GetEmbedding</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ping&quot;</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;embed check failed: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div></li>
</ul>
</li>
<li>
<p><strong>Slow loading speed or high CPU usage</strong></p>
<ul>
<li>Possible causes: Single-core sequential loading; Inappropriate concurrency settings; Unreasonable large file chunking strategy.</li>
<li>Troubleshooting steps:<ul>
<li>Set source-level/document-level concurrency: <code>WithSourceConcurrency(N)</code>, <code>WithDocConcurrency(M)</code>;</li>
<li>Adjust chunk size to avoid too many small chunks;</li>
<li>Temporarily disable statistics output to reduce log overhead: <code>WithShowStats(false)</code>.</li>
</ul>
</li>
<li>Reference code:
   <div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1">1</a></span>
<span class="normal"><a href="#__codelineno-46-2">2</a></span>
<span class="normal"><a href="#__codelineno-46-3">3</a></span>
<span class="normal"><a href="#__codelineno-46-4">4</a></span>
<span class="normal"><a href="#__codelineno-46-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">kb</span><span class="p">.</span><span class="nx">Load</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithSourceConcurrency</span><span class="p">(</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">NumCPU</span><span class="p">()),</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithDocConcurrency</span><span class="p">(</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">NumCPU</span><span class="p">()</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4"></a><span class="w">    </span><span class="nx">knowledge</span><span class="p">.</span><span class="nx">WithShowStats</span><span class="p">(</span><span class="kc">false</span><span class="p">),</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div></li>
</ul>
</li>
<li>
<p><strong>Storage connection failure (pgvector/TcVector)</strong></p>
<ul>
<li>Possible causes: Incorrect connection parameters; Network/authentication failure; Service not started or port not accessible.</li>
<li>Troubleshooting steps:<ul>
<li>Use native client to connect once first (psql/curl);</li>
<li>Explicitly print current configuration (host/port/user/db/url);</li>
<li>For minimal example, only insert/query one record to verify.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>High memory usage</strong></p>
<ul>
<li>Possible causes: Loading too many documents at once; Chunk size/overlap too large; Similarity filtering too wide.</li>
<li>Troubleshooting steps:<ul>
<li>Reduce concurrency and chunk overlap;</li>
<li>Load directories in batches.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Dimension/vector mismatch</strong></p>
<ul>
<li>Symptoms: Search phase errors or abnormal scores of 0.</li>
<li>Troubleshooting:<ul>
<li>Confirm embedding model dimension matches existing vectors (<code>text-embedding-3-small</code> is 1536);</li>
<li>After replacing embedding model, need to rebuild (clear and reload) vector database.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Path/format reading failure</strong></p>
<ul>
<li>Symptoms: Loading logs show 0 documents or specific source errors.</li>
<li>Troubleshooting:<ul>
<li>Confirm files exist and extensions are supported (.md/.txt/.pdf/.csv/.json/.docx, etc.);</li>
<li>Whether directory source needs <code>WithRecursive(true)</code>;</li>
<li>Use <code>WithFileExtensions</code> for whitelist filtering.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>PDF file reading support</strong></p>
<ul>
<li>Note: The PDF reader depends on third-party libraries. To avoid introducing unnecessary dependencies into the main module, the PDF reader uses a separate <code>go.mod</code>.</li>
<li>Usage: To support PDF file reading, manually import the PDF reader package for registration:
   <div class="language-go highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1">1</a></span>
<span class="normal"><a href="#__codelineno-47-2">2</a></span>
<span class="normal"><a href="#__codelineno-47-3">3</a></span>
<span class="normal"><a href="#__codelineno-47-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="w">    </span><span class="c1">// Import PDF reader to support .pdf file parsing.</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3"></a><span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;trpc.group/trpc-go/trpc-agent-go/knowledge/document/reader/pdf&quot;</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div></li>
<li>Note: Readers for other formats (.txt/.md/.csv/.json, etc.) are automatically registered and do not require manual import.</li>
</ul>
</li>
</ol>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime" title="January 5, 2026 06:36:28 UTC">2026-01-05 06:36:28</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime" title="August 25, 2025 07:06:16 UTC">2025-08-25 07:06:16</span>
  </span>

    
    
    
  </aside>


  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              
              
                
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              
              
                
                
              
              Thanks for your feedback!<br>Please help us improve by opening an <a href="https://github.com/trpc-group/trpc-agent-go/issues/new" target="_blank" rel="noopener">issue</a>.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../session/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Session">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Session
              </div>
            </div>
          </a>
        
        
          
          <a href="../planner/" class="md-footer__link md-footer__link--next" aria-label="Next: Planner">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Planner
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "navigation.footer", "navigation.tabs", "search.suggest", "search.share", "content.action.edit", "content.action.view"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>